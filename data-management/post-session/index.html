
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Templates and bootstrapping documentation for MRI standard operating procedures (SOPs)">
      
      
        <meta name="author" content="The AxonLab">
      
      
      
        <link rel="prev" href="../preliminary/">
      
      
        <link rel="next" href="../mriqc/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.5">
    
    
      
        <title>Post-session retrieval and BIDS - Standard Operating Procedures of the HCPh project</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6a10b989.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.356b1318.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--thanks:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8.048 2.241c.964-.709 2.079-1.238 3.325-1.241a4.616 4.616 0 0 1 3.282 1.355c.41.408.757.86.996 1.428.238.568.348 1.206.347 1.968 0 2.193-1.505 4.254-3.081 5.862-1.496 1.526-3.213 2.796-4.249 3.563l-.22.163a.749.749 0 0 1-.895 0l-.221-.163c-1.036-.767-2.753-2.037-4.249-3.563C1.51 10.008.007 7.952.002 5.762a4.614 4.614 0 0 1 1.353-3.407C3.123.585 6.223.537 8.048 2.24Zm-1.153.983c-1.25-1.033-3.321-.967-4.48.191a3.115 3.115 0 0 0-.913 2.335c0 1.556 1.109 3.24 2.652 4.813C5.463 11.898 6.96 13.032 8 13.805c.353-.262.758-.565 1.191-.905l-1.326-1.223a.75.75 0 0 1 1.018-1.102l1.48 1.366c.328-.281.659-.577.984-.887L9.99 9.802a.75.75 0 1 1 1.019-1.103l1.384 1.28c.295-.329.566-.661.81-.995L12.92 8.7l-1.167-1.168c-.674-.671-1.78-.664-2.474.03-.268.269-.538.537-.802.797-.893.882-2.319.843-3.185-.032-.346-.35-.693-.697-1.043-1.047a.75.75 0 0 1-.04-1.016c.162-.191.336-.401.52-.623.62-.748 1.356-1.637 2.166-2.417Zm7.112 4.442c.313-.65.491-1.293.491-1.916v-.001c0-.614-.088-1.045-.23-1.385-.143-.339-.357-.633-.673-.949a3.111 3.111 0 0 0-2.218-.915c-1.092.003-2.165.627-3.226 1.602-.823.755-1.554 1.637-2.228 2.45l-.127.154.562.566a.755.755 0 0 0 1.066.02l.794-.79c1.258-1.258 3.312-1.31 4.594-.032.396.394.792.791 1.173 1.173Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M256 448c141.4 0 256-93.1 256-208S397.4 32 256 32 0 125.1 0 240c0 45.1 17.7 86.8 47.7 120.9-1.9 24.5-11.4 46.3-21.4 62.9-5.5 9.2-11.1 16.6-15.2 21.6-2.1 2.5-3.7 4.4-4.9 5.7-.6.6-1 1.1-1.3 1.4l-.3.3c-4.6 4.6-5.9 11.4-3.4 17.4 2.5 6 8.3 9.9 14.8 9.9 28.7 0 57.6-8.9 81.6-19.3 22.9-10 42.4-21.9 54.3-30.6 31.8 11.5 67 17.9 104.1 17.9zM128 208a32 32 0 1 1 0 64 32 32 0 1 1 0-64zm128 0a32 32 0 1 1 0 64 32 32 0 1 1 0-64zm96 32a32 32 0 1 1 64 0 32 32 0 1 1-64 0z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M173.2 0c-1.8 0-3.5.7-4.8 2C138.5 32.3 120 74 120 120c0 26.2 6 50.9 16.6 73-22 2.4-43.8 9.1-64.2 20.5-34.5 19.3-59.1 48.9-72 82.5-.7 1.7-.5 3.7.5 5.2 2.2 3.7 7.4 4.3 10.6 1.3C64.2 254.3 158 245.1 205 324s-8.1 153.1-77.6 173.2c-4.2 1.2-6.3 5.9-4.1 9.6 1 1.6 2.6 2.7 4.5 3 36.5 5.9 75.2.1 109.7-19.2 20.4-11.4 37.4-26.5 50.5-43.8 13.1 17.3 30.1 32.4 50.5 43.8 34.5 19.3 73.3 25.2 109.7 19.2 1.9-.3 3.5-1.4 4.5-3 2.2-3.7.1-8.4-4.1-9.6C379.1 477.1 324 403 371 324s140.7-69.8 193.5-21.4c3.2 2.9 8.4 2.3 10.6-1.3 1-1.6 1.1-3.5.5-5.2-12.9-33.6-37.5-63.2-72.1-82.5a168.77 168.77 0 0 0-64.2-20.5C450 170.9 456 146.2 456 120c0-46-18.5-87.7-48.4-118-1.3-1.3-3-2-4.8-2-5 0-8.4 5.2-6.7 9.9C421.7 80.5 385.6 176 288 176S154.3 80.5 179.9 9.9c1.7-4.7-1.6-9.9-6.7-9.9zM240 272a48 48 0 1 1 96 0 48 48 0 1 1-96 0zm-58.3 145.6c6.3-11.8 9.8-25.1 8.6-39.8-19.5-18-34-41.4-41.2-67.8-12.5-8.1-26.2-11.8-40-12.4-9-.4-18.1.6-27.1 2.7 7.8 57.1 38.7 106.8 82.9 139.4 6.8-6.7 12.6-14.1 16.8-22.1zM288 64c-28.8 0-56.3 5.9-81.2 16.5 2 8.3 5 16.2 9 23.5 6.8 12.4 16.7 23.1 30.1 30.3 13.3-4.1 27.5-6.3 42.2-6.3s28.8 2.2 42.2 6.3c13.4-7.2 23.3-17.9 30.1-30.3 4-7.3 7-15.2 9-23.5C344.3 69.9 316.8 64 288 64zm138.9 246c-7.2 26.4-21.7 49.7-41.2 67.8-1.2 14.7 2.2 28.1 8.6 39.8 4.3 8 10 15.4 16.8 22.1 44.3-32.6 75.2-82.3 82.9-139.4-9-2.2-18.1-3.1-27.1-2.7-13.8.6-27.5 4.4-40 12.4z"/></svg>');--md-admonition-icon--important:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M256 512a256 256 0 1 0 0-512 256 256 0 1 0 0 512zm0-384c13.3 0 24 10.7 24 24v112c0 13.3-10.7 24-24 24s-24-10.7-24-24V152c0-13.3 10.7-24 24-24zm-32 224a32 32 0 1 1 64 0 32 32 0 1 1-64 0z"/></svg>');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#within-48h-after-the-first-session" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Standard Operating Procedures of the HCPh project" class="md-header__button md-logo" aria-label="Standard Operating Procedures of the HCPh project" data-md-component="logo">
      
  <img src="../../assets/images/chuv_logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Standard Operating Procedures of the HCPh project
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Post-session retrieval and BIDS
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Standard Operating Procedures of the HCPh project" class="md-nav__button md-logo" aria-label="Standard Operating Procedures of the HCPh project" data-md-component="logo">
      
  <img src="../../assets/images/chuv_logo.svg" alt="logo">

    </a>
    Standard Operating Procedures of the HCPh project
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../changes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Change History
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Recruitment, Scheduling, and Screening
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Recruitment, Scheduling, and Screening
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../recruitment-scheduling-screening/recruitment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Recruitment and screening
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../recruitment-scheduling-screening/scheduling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scheduling
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data collection
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Data collection
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../data-collection/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overall experimental settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../data-collection/preliminary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preliminary work
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../data-collection/pre-session/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Before each session
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../data-collection/participant-prep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preparing the participant
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../data-collection/scanning-notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Notes on the scanner's console and recording devices
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../data-collection/scanning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running the scanning session
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../data-collection/tear-down/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Session tear-down
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../data-collection/emergency-procedures/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Emergency procedures
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data management
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Data management
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../preliminary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Before data acquisition (storage preparation)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Post-session retrieval and BIDS
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Post-session retrieval and BIDS
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#within-48h-after-the-first-session" class="md-nav__link">
    Within 48h after the FIRST session
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#within-one-week-after-the-completed-session" class="md-nav__link">
    Within one week after the completed session
  </a>
  
    <nav class="md-nav" aria-label="Within one week after the completed session">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-the-data-from-the-pacs-with-pacsman-only-authorized-users" class="md-nav__link">
    Download the data from the PACS with PACSMAN (only authorized users)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieve-physiological-recordings-from" class="md-nav__link">
    Retrieve physiological recordings (from ████)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy-original-dicom-datasets-into-the-archive-of-stockage-horus" class="md-nav__link">
    Copy original DICOM datasets into the archive of Stockage hOrus
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#within-two-weeks-after-the-completed-session" class="md-nav__link">
    Within two weeks after the completed session
  </a>
  
    <nav class="md-nav" aria-label="Within two weeks after the completed session">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#convert-data-to-bids-with-heudiconv" class="md-nav__link">
    Convert data to BIDS with HeuDiConv
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#convert-physiological-recordings-and-eye-tracking-data-to-bids" class="md-nav__link">
    Convert physiological recordings and eye-tracking data to BIDS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-new-data-to-the-datalad-dataset" class="md-nav__link">
    Add new data to the DataLad dataset
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../mriqc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    QC of unprocessed data
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../preprocessing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preprocessing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../release/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Release of data
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#within-48h-after-the-first-session" class="md-nav__link">
    Within 48h after the FIRST session
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#within-one-week-after-the-completed-session" class="md-nav__link">
    Within one week after the completed session
  </a>
  
    <nav class="md-nav" aria-label="Within one week after the completed session">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-the-data-from-the-pacs-with-pacsman-only-authorized-users" class="md-nav__link">
    Download the data from the PACS with PACSMAN (only authorized users)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieve-physiological-recordings-from" class="md-nav__link">
    Retrieve physiological recordings (from ████)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy-original-dicom-datasets-into-the-archive-of-stockage-horus" class="md-nav__link">
    Copy original DICOM datasets into the archive of Stockage hOrus
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#within-two-weeks-after-the-completed-session" class="md-nav__link">
    Within two weeks after the completed session
  </a>
  
    <nav class="md-nav" aria-label="Within two weeks after the completed session">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#convert-data-to-bids-with-heudiconv" class="md-nav__link">
    Convert data to BIDS with HeuDiConv
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#convert-physiological-recordings-and-eye-tracking-data-to-bids" class="md-nav__link">
    Convert physiological recordings and eye-tracking data to BIDS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-new-data-to-the-datalad-dataset" class="md-nav__link">
    Add new data to the DataLad dataset
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset"><a class="md-content__button md-icon" download href="../../pdf/documentation.pdf" title="PDF Export"><svg style="height: 1.2rem; width: 1.2rem;" viewBox="0 0 384 512" xmlns="http://www.w3.org/2000/svg"><path d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm76.45 211.36l-96.42 95.7c-6.65 6.61-17.39 6.61-24.04 0l-96.42-95.7C73.42 337.29 80.54 320 94.82 320H160v-80c0-8.84 7.16-16 16-16h32c8.84 0 16 7.16 16 16v80h65.18c14.28 0 21.4 17.29 11.27 27.36zM377 105L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128v-6.1c0-6.3-2.5-12.4-7-16.9z"></path></svg></a>
                
                  


  <h1>Post-session retrieval and BIDS</h1>

<h2 id="within-48h-after-the-first-session">Within 48h after the FIRST session<a class="headerlink" href="#within-48h-after-the-first-session" title="Permanent link">&para;</a></h2>
<div class="admonition danger">
<p class="admonition-title">Anatomical images must be screened for incidental findings within 48h after the first session</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Send the T1-weighted and T2-weighted scan to ███ for screening and incidental findings.</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Indicate on <a href="/redacted.html">our recruits spreadsheet</a> that the participant's first session has been submitted for screening.</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Wait for response from ███ and note down the result of the screening in our <a href="/redacted.html">our recruits spreadsheet</a>.</li>
</ul>
</div>
<p>To do so, you'll need to first <a href="#download-the-data-from-the-pacs-with-pacsman-only-authorized-users">download the data from <abbr title="picture archiving and communication system">PACS</abbr></a> and then <a href="#convert-data-to-bids-with-heudiconv-and-phys2bids">convert the data into <abbr title="Brain Imaging Data Structure">BIDS</abbr></a>.</p>
<div class="admonition warning">
<p class="admonition-title">What to do when there are incidental findings</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Discuss with ███ how to proceed with the participant.</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Exclude the participant from the study if ███ evaluates they don't meet the participation (inclusion and exclusion) criteria.</li>
</ul>
</div>
<h2 id="within-one-week-after-the-completed-session">Within one week after the completed session<a class="headerlink" href="#within-one-week-after-the-completed-session" title="Permanent link">&para;</a></h2>
<h3 id="download-the-data-from-the-pacs-with-pacsman-only-authorized-users">Download the data from the <abbr title="picture archiving and communication system">PACS</abbr> with <em>PACSMAN</em> (only authorized users)<a class="headerlink" href="#download-the-data-from-the-pacs-with-pacsman-only-authorized-users" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Log-in into the <em>PACSMAN</em> computer  (**)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Mount a remote filesystem through sshfs:
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>sshfs<span class="w"> </span>&lt;hostname&gt;:/data/datasets/hcph-pilot-sourcedata<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">               </span><span class="nv">$HOME</span>/data/hcph-pilot<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">      </span>&lt;args&gt;
</span></code></pre></div></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Edit the query file <code>vim $HOME/queries/last-session.csv</code> (most likely, just update with the session's date)
<div class="language-text highlight"><span class="filename">mydata-onesession.csv</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>PatientID,StudyDate
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>2022_11_07*,20230503
</span></code></pre></div></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Prepare and run PACSMAN, pointing the output to the mounted directory.
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>pacsman<span class="w"> </span>--save<span class="w"> </span>-q<span class="w"> </span><span class="nv">$HOME</span>/queries/last-session.csv<span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">       </span>--out_directory<span class="w"> </span><span class="nv">$HOME</span>/data/hcph-pilot/<span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">       </span>--config<span class="w"> </span>/opt/PACSMAN/files/config.json
</span></code></pre></div></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Remove write permissions on the newly downloaded data:
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>chmod<span class="w"> </span>-R<span class="w"> </span>a-w<span class="w"> </span><span class="nv">$HOME</span>/data/hcph-pilot/sub-01/ses-*
</span></code></pre></div></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Unmount the remote filesystem:
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>sudo<span class="w"> </span>umount<span class="w"> </span><span class="nv">$HOME</span>/data/hcph-pilot
</span></code></pre></div></li>
</ul>
<h3 id="retrieve-physiological-recordings-from">Retrieve physiological recordings (from ████)<a class="headerlink" href="#retrieve-physiological-recordings-from" title="Permanent link">&para;</a></h3>
<h3 id="copy-original-dicom-datasets-into-the-archive-of-stockage-horus">Copy original <abbr title="Digital Imaging and Communications in Medicine">DICOM</abbr> datasets into the archive of Stockage <abbr title="HOspital Research Unified data and analytics Services">hOrus</abbr><a class="headerlink" href="#copy-original-dicom-datasets-into-the-archive-of-stockage-horus" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Setup a cron job to execute automatically the synchronization:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>crontab -e
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>[ within your file editor add the following line ]
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>0 2 * * * rsync -avurP /data/datasets/hcph-pilot-sourcedata* &lt;user&gt;@&lt;host&gt;:&lt;path&gt;/sourcedata-pilot &amp;&gt; $HOME/var/log/data-curnagl.log
</span></code></pre></div>
</li>
</ul>
<h2 id="within-two-weeks-after-the-completed-session">Within two weeks after the completed session<a class="headerlink" href="#within-two-weeks-after-the-completed-session" title="Permanent link">&para;</a></h2>
<h3 id="convert-data-to-bids-with-heudiconv">Convert data to <abbr title="Brain Imaging Data Structure">BIDS</abbr> with <em>HeuDiConv</em><a class="headerlink" href="#convert-data-to-bids-with-heudiconv" title="Permanent link">&para;</a></h3>
<p>We use <em>HeuDiConv</em> to convert from the <abbr title="Digital Imaging and Communications in Medicine">DICOM</abbr> format generated by the scanner.
In addition, starting from the piloting session five, we abide by <em>ReproIn conventions</em>.
To support backward compatibility (and some extra, currently unsupported features by the original heuristic file), we have our own heuristic file.</p>
<details class="info">
<summary>Our custom heuristic file</summary>
<p>Our heuristic file largely derives from <a href="https://github.com/nipy/heudiconv/blob/55524168b02519bbf0a3a1c94cafb29a419728a0/heudiconv/heuristics/reproin.py"><em>ReproIn</em>'s at the time of writing</a>.
The heuristic has a a <code class="language-python highlight"><span class="n">protocols2fix</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span></code> (<a href="#__codelineno-6-113">lines 113-148</a>), where replacement patterns to permit backward compatibility are written.</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">  1</a></span>
<span class="normal"><a href="#__codelineno-6-2">  2</a></span>
<span class="normal"><a href="#__codelineno-6-3">  3</a></span>
<span class="normal"><a href="#__codelineno-6-4">  4</a></span>
<span class="normal"><a href="#__codelineno-6-5">  5</a></span>
<span class="normal"><a href="#__codelineno-6-6">  6</a></span>
<span class="normal"><a href="#__codelineno-6-7">  7</a></span>
<span class="normal"><a href="#__codelineno-6-8">  8</a></span>
<span class="normal"><a href="#__codelineno-6-9">  9</a></span>
<span class="normal"><a href="#__codelineno-6-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-6-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-6-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-6-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-6-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-6-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-6-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-6-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-6-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-6-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-6-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-6-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-6-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-6-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-6-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-6-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-6-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-6-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-6-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-6-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-6-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-6-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-6-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-6-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-6-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-6-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-6-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-6-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-6-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-6-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-6-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-6-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-6-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-6-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-6-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-6-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-6-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-6-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-6-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-6-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-6-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-6-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-6-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-6-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-6-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-6-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-6-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-6-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-6-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-6-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-6-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-6-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-6-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-6-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-6-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-6-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-6-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-6-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-6-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-6-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-6-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-6-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-6-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-6-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-6-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-6-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-6-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-6-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-6-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-6-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-6-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-6-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-6-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-6-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-6-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-6-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-6-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-6-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-6-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-6-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-6-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-6-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-6-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-6-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-6-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-6-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-6-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-6-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-6-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-6-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-6-100">100</a></span>
<span class="normal"><a href="#__codelineno-6-101">101</a></span>
<span class="normal"><a href="#__codelineno-6-102">102</a></span>
<span class="normal"><a href="#__codelineno-6-103">103</a></span>
<span class="normal"><a href="#__codelineno-6-104">104</a></span>
<span class="normal"><a href="#__codelineno-6-105">105</a></span>
<span class="normal"><a href="#__codelineno-6-106">106</a></span>
<span class="normal"><a href="#__codelineno-6-107">107</a></span>
<span class="normal"><a href="#__codelineno-6-108">108</a></span>
<span class="normal"><a href="#__codelineno-6-109">109</a></span>
<span class="normal"><a href="#__codelineno-6-110">110</a></span>
<span class="normal"><a href="#__codelineno-6-111">111</a></span>
<span class="normal"><a href="#__codelineno-6-112">112</a></span>
<span class="normal"><a href="#__codelineno-6-113">113</a></span>
<span class="normal"><a href="#__codelineno-6-114">114</a></span>
<span class="normal"><a href="#__codelineno-6-115">115</a></span>
<span class="normal"><a href="#__codelineno-6-116">116</a></span>
<span class="normal"><a href="#__codelineno-6-117">117</a></span>
<span class="normal"><a href="#__codelineno-6-118">118</a></span>
<span class="normal"><a href="#__codelineno-6-119">119</a></span>
<span class="normal"><a href="#__codelineno-6-120">120</a></span>
<span class="normal"><a href="#__codelineno-6-121">121</a></span>
<span class="normal"><a href="#__codelineno-6-122">122</a></span>
<span class="normal"><a href="#__codelineno-6-123">123</a></span>
<span class="normal"><a href="#__codelineno-6-124">124</a></span>
<span class="normal"><a href="#__codelineno-6-125">125</a></span>
<span class="normal"><a href="#__codelineno-6-126">126</a></span>
<span class="normal"><a href="#__codelineno-6-127">127</a></span>
<span class="normal"><a href="#__codelineno-6-128">128</a></span>
<span class="normal"><a href="#__codelineno-6-129">129</a></span>
<span class="normal"><a href="#__codelineno-6-130">130</a></span>
<span class="normal"><a href="#__codelineno-6-131">131</a></span>
<span class="normal"><a href="#__codelineno-6-132">132</a></span>
<span class="normal"><a href="#__codelineno-6-133">133</a></span>
<span class="normal"><a href="#__codelineno-6-134">134</a></span>
<span class="normal"><a href="#__codelineno-6-135">135</a></span>
<span class="normal"><a href="#__codelineno-6-136">136</a></span>
<span class="normal"><a href="#__codelineno-6-137">137</a></span>
<span class="normal"><a href="#__codelineno-6-138">138</a></span>
<span class="normal"><a href="#__codelineno-6-139">139</a></span>
<span class="normal"><a href="#__codelineno-6-140">140</a></span>
<span class="normal"><a href="#__codelineno-6-141">141</a></span>
<span class="normal"><a href="#__codelineno-6-142">142</a></span>
<span class="normal"><a href="#__codelineno-6-143">143</a></span>
<span class="normal"><a href="#__codelineno-6-144">144</a></span>
<span class="normal"><a href="#__codelineno-6-145">145</a></span>
<span class="normal"><a href="#__codelineno-6-146">146</a></span>
<span class="normal"><a href="#__codelineno-6-147">147</a></span>
<span class="normal"><a href="#__codelineno-6-148">148</a></span>
<span class="normal"><a href="#__codelineno-6-149">149</a></span>
<span class="normal"><a href="#__codelineno-6-150">150</a></span>
<span class="normal"><a href="#__codelineno-6-151">151</a></span>
<span class="normal"><a href="#__codelineno-6-152">152</a></span>
<span class="normal"><a href="#__codelineno-6-153">153</a></span>
<span class="normal"><a href="#__codelineno-6-154">154</a></span>
<span class="normal"><a href="#__codelineno-6-155">155</a></span>
<span class="normal"><a href="#__codelineno-6-156">156</a></span>
<span class="normal"><a href="#__codelineno-6-157">157</a></span>
<span class="normal"><a href="#__codelineno-6-158">158</a></span>
<span class="normal"><a href="#__codelineno-6-159">159</a></span>
<span class="normal"><a href="#__codelineno-6-160">160</a></span>
<span class="normal"><a href="#__codelineno-6-161">161</a></span>
<span class="normal"><a href="#__codelineno-6-162">162</a></span>
<span class="normal"><a href="#__codelineno-6-163">163</a></span>
<span class="normal"><a href="#__codelineno-6-164">164</a></span>
<span class="normal"><a href="#__codelineno-6-165">165</a></span>
<span class="normal"><a href="#__codelineno-6-166">166</a></span>
<span class="normal"><a href="#__codelineno-6-167">167</a></span>
<span class="normal"><a href="#__codelineno-6-168">168</a></span>
<span class="normal"><a href="#__codelineno-6-169">169</a></span>
<span class="normal"><a href="#__codelineno-6-170">170</a></span>
<span class="normal"><a href="#__codelineno-6-171">171</a></span>
<span class="normal"><a href="#__codelineno-6-172">172</a></span>
<span class="normal"><a href="#__codelineno-6-173">173</a></span>
<span class="normal"><a href="#__codelineno-6-174">174</a></span>
<span class="normal"><a href="#__codelineno-6-175">175</a></span>
<span class="normal"><a href="#__codelineno-6-176">176</a></span>
<span class="normal"><a href="#__codelineno-6-177">177</a></span>
<span class="normal"><a href="#__codelineno-6-178">178</a></span>
<span class="normal"><a href="#__codelineno-6-179">179</a></span>
<span class="normal"><a href="#__codelineno-6-180">180</a></span>
<span class="normal"><a href="#__codelineno-6-181">181</a></span>
<span class="normal"><a href="#__codelineno-6-182">182</a></span>
<span class="normal"><a href="#__codelineno-6-183">183</a></span>
<span class="normal"><a href="#__codelineno-6-184">184</a></span>
<span class="normal"><a href="#__codelineno-6-185">185</a></span>
<span class="normal"><a href="#__codelineno-6-186">186</a></span>
<span class="normal"><a href="#__codelineno-6-187">187</a></span>
<span class="normal"><a href="#__codelineno-6-188">188</a></span>
<span class="normal"><a href="#__codelineno-6-189">189</a></span>
<span class="normal"><a href="#__codelineno-6-190">190</a></span>
<span class="normal"><a href="#__codelineno-6-191">191</a></span>
<span class="normal"><a href="#__codelineno-6-192">192</a></span>
<span class="normal"><a href="#__codelineno-6-193">193</a></span>
<span class="normal"><a href="#__codelineno-6-194">194</a></span>
<span class="normal"><a href="#__codelineno-6-195">195</a></span>
<span class="normal"><a href="#__codelineno-6-196">196</a></span>
<span class="normal"><a href="#__codelineno-6-197">197</a></span>
<span class="normal"><a href="#__codelineno-6-198">198</a></span>
<span class="normal"><a href="#__codelineno-6-199">199</a></span>
<span class="normal"><a href="#__codelineno-6-200">200</a></span>
<span class="normal"><a href="#__codelineno-6-201">201</a></span>
<span class="normal"><a href="#__codelineno-6-202">202</a></span>
<span class="normal"><a href="#__codelineno-6-203">203</a></span>
<span class="normal"><a href="#__codelineno-6-204">204</a></span>
<span class="normal"><a href="#__codelineno-6-205">205</a></span>
<span class="normal"><a href="#__codelineno-6-206">206</a></span>
<span class="normal"><a href="#__codelineno-6-207">207</a></span>
<span class="normal"><a href="#__codelineno-6-208">208</a></span>
<span class="normal"><a href="#__codelineno-6-209">209</a></span>
<span class="normal"><a href="#__codelineno-6-210">210</a></span>
<span class="normal"><a href="#__codelineno-6-211">211</a></span>
<span class="normal"><a href="#__codelineno-6-212">212</a></span>
<span class="normal"><a href="#__codelineno-6-213">213</a></span>
<span class="normal"><a href="#__codelineno-6-214">214</a></span>
<span class="normal"><a href="#__codelineno-6-215">215</a></span>
<span class="normal"><a href="#__codelineno-6-216">216</a></span>
<span class="normal"><a href="#__codelineno-6-217">217</a></span>
<span class="normal"><a href="#__codelineno-6-218">218</a></span>
<span class="normal"><a href="#__codelineno-6-219">219</a></span>
<span class="normal"><a href="#__codelineno-6-220">220</a></span>
<span class="normal"><a href="#__codelineno-6-221">221</a></span>
<span class="normal"><a href="#__codelineno-6-222">222</a></span>
<span class="normal"><a href="#__codelineno-6-223">223</a></span>
<span class="normal"><a href="#__codelineno-6-224">224</a></span>
<span class="normal"><a href="#__codelineno-6-225">225</a></span>
<span class="normal"><a href="#__codelineno-6-226">226</a></span>
<span class="normal"><a href="#__codelineno-6-227">227</a></span>
<span class="normal"><a href="#__codelineno-6-228">228</a></span>
<span class="normal"><a href="#__codelineno-6-229">229</a></span>
<span class="normal"><a href="#__codelineno-6-230">230</a></span>
<span class="normal"><a href="#__codelineno-6-231">231</a></span>
<span class="normal"><a href="#__codelineno-6-232">232</a></span>
<span class="normal"><a href="#__codelineno-6-233">233</a></span>
<span class="normal"><a href="#__codelineno-6-234">234</a></span>
<span class="normal"><a href="#__codelineno-6-235">235</a></span>
<span class="normal"><a href="#__codelineno-6-236">236</a></span>
<span class="normal"><a href="#__codelineno-6-237">237</a></span>
<span class="normal"><a href="#__codelineno-6-238">238</a></span>
<span class="normal"><a href="#__codelineno-6-239">239</a></span>
<span class="normal"><a href="#__codelineno-6-240">240</a></span>
<span class="normal"><a href="#__codelineno-6-241">241</a></span>
<span class="normal"><a href="#__codelineno-6-242">242</a></span>
<span class="normal"><a href="#__codelineno-6-243">243</a></span>
<span class="normal"><a href="#__codelineno-6-244">244</a></span>
<span class="normal"><a href="#__codelineno-6-245">245</a></span>
<span class="normal"><a href="#__codelineno-6-246">246</a></span>
<span class="normal"><a href="#__codelineno-6-247">247</a></span>
<span class="normal"><a href="#__codelineno-6-248">248</a></span>
<span class="normal"><a href="#__codelineno-6-249">249</a></span>
<span class="normal"><a href="#__codelineno-6-250">250</a></span>
<span class="normal"><a href="#__codelineno-6-251">251</a></span>
<span class="normal"><a href="#__codelineno-6-252">252</a></span>
<span class="normal"><a href="#__codelineno-6-253">253</a></span>
<span class="normal"><a href="#__codelineno-6-254">254</a></span>
<span class="normal"><a href="#__codelineno-6-255">255</a></span>
<span class="normal"><a href="#__codelineno-6-256">256</a></span>
<span class="normal"><a href="#__codelineno-6-257">257</a></span>
<span class="normal"><a href="#__codelineno-6-258">258</a></span>
<span class="normal"><a href="#__codelineno-6-259">259</a></span>
<span class="normal"><a href="#__codelineno-6-260">260</a></span>
<span class="normal"><a href="#__codelineno-6-261">261</a></span>
<span class="normal"><a href="#__codelineno-6-262">262</a></span>
<span class="normal"><a href="#__codelineno-6-263">263</a></span>
<span class="normal"><a href="#__codelineno-6-264">264</a></span>
<span class="normal"><a href="#__codelineno-6-265">265</a></span>
<span class="normal"><a href="#__codelineno-6-266">266</a></span>
<span class="normal"><a href="#__codelineno-6-267">267</a></span>
<span class="normal"><a href="#__codelineno-6-268">268</a></span>
<span class="normal"><a href="#__codelineno-6-269">269</a></span>
<span class="normal"><a href="#__codelineno-6-270">270</a></span>
<span class="normal"><a href="#__codelineno-6-271">271</a></span>
<span class="normal"><a href="#__codelineno-6-272">272</a></span>
<span class="normal"><a href="#__codelineno-6-273">273</a></span>
<span class="normal"><a href="#__codelineno-6-274">274</a></span>
<span class="normal"><a href="#__codelineno-6-275">275</a></span>
<span class="normal"><a href="#__codelineno-6-276">276</a></span>
<span class="normal"><a href="#__codelineno-6-277">277</a></span>
<span class="normal"><a href="#__codelineno-6-278">278</a></span>
<span class="normal"><a href="#__codelineno-6-279">279</a></span>
<span class="normal"><a href="#__codelineno-6-280">280</a></span>
<span class="normal"><a href="#__codelineno-6-281">281</a></span>
<span class="normal"><a href="#__codelineno-6-282">282</a></span>
<span class="normal"><a href="#__codelineno-6-283">283</a></span>
<span class="normal"><a href="#__codelineno-6-284">284</a></span>
<span class="normal"><a href="#__codelineno-6-285">285</a></span>
<span class="normal"><a href="#__codelineno-6-286">286</a></span>
<span class="normal"><a href="#__codelineno-6-287">287</a></span>
<span class="normal"><a href="#__codelineno-6-288">288</a></span>
<span class="normal"><a href="#__codelineno-6-289">289</a></span>
<span class="normal"><a href="#__codelineno-6-290">290</a></span>
<span class="normal"><a href="#__codelineno-6-291">291</a></span>
<span class="normal"><a href="#__codelineno-6-292">292</a></span>
<span class="normal"><a href="#__codelineno-6-293">293</a></span>
<span class="normal"><a href="#__codelineno-6-294">294</a></span>
<span class="normal"><a href="#__codelineno-6-295">295</a></span>
<span class="normal"><a href="#__codelineno-6-296">296</a></span>
<span class="normal"><a href="#__codelineno-6-297">297</a></span>
<span class="normal"><a href="#__codelineno-6-298">298</a></span>
<span class="normal"><a href="#__codelineno-6-299">299</a></span>
<span class="normal"><a href="#__codelineno-6-300">300</a></span>
<span class="normal"><a href="#__codelineno-6-301">301</a></span>
<span class="normal"><a href="#__codelineno-6-302">302</a></span>
<span class="normal"><a href="#__codelineno-6-303">303</a></span>
<span class="normal"><a href="#__codelineno-6-304">304</a></span>
<span class="normal"><a href="#__codelineno-6-305">305</a></span>
<span class="normal"><a href="#__codelineno-6-306">306</a></span>
<span class="normal"><a href="#__codelineno-6-307">307</a></span>
<span class="normal"><a href="#__codelineno-6-308">308</a></span>
<span class="normal"><a href="#__codelineno-6-309">309</a></span>
<span class="normal"><a href="#__codelineno-6-310">310</a></span>
<span class="normal"><a href="#__codelineno-6-311">311</a></span>
<span class="normal"><a href="#__codelineno-6-312">312</a></span>
<span class="normal"><a href="#__codelineno-6-313">313</a></span>
<span class="normal"><a href="#__codelineno-6-314">314</a></span>
<span class="normal"><a href="#__codelineno-6-315">315</a></span>
<span class="normal"><a href="#__codelineno-6-316">316</a></span>
<span class="normal"><a href="#__codelineno-6-317">317</a></span>
<span class="normal"><a href="#__codelineno-6-318">318</a></span>
<span class="normal"><a href="#__codelineno-6-319">319</a></span>
<span class="normal"><a href="#__codelineno-6-320">320</a></span>
<span class="normal"><a href="#__codelineno-6-321">321</a></span>
<span class="normal"><a href="#__codelineno-6-322">322</a></span>
<span class="normal"><a href="#__codelineno-6-323">323</a></span>
<span class="normal"><a href="#__codelineno-6-324">324</a></span>
<span class="normal"><a href="#__codelineno-6-325">325</a></span>
<span class="normal"><a href="#__codelineno-6-326">326</a></span>
<span class="normal"><a href="#__codelineno-6-327">327</a></span>
<span class="normal"><a href="#__codelineno-6-328">328</a></span>
<span class="normal"><a href="#__codelineno-6-329">329</a></span>
<span class="normal"><a href="#__codelineno-6-330">330</a></span>
<span class="normal"><a href="#__codelineno-6-331">331</a></span>
<span class="normal"><a href="#__codelineno-6-332">332</a></span>
<span class="normal"><a href="#__codelineno-6-333">333</a></span>
<span class="normal"><a href="#__codelineno-6-334">334</a></span>
<span class="normal"><a href="#__codelineno-6-335">335</a></span>
<span class="normal"><a href="#__codelineno-6-336">336</a></span>
<span class="normal"><a href="#__codelineno-6-337">337</a></span>
<span class="normal"><a href="#__codelineno-6-338">338</a></span>
<span class="normal"><a href="#__codelineno-6-339">339</a></span>
<span class="normal"><a href="#__codelineno-6-340">340</a></span>
<span class="normal"><a href="#__codelineno-6-341">341</a></span>
<span class="normal"><a href="#__codelineno-6-342">342</a></span>
<span class="normal"><a href="#__codelineno-6-343">343</a></span>
<span class="normal"><a href="#__codelineno-6-344">344</a></span>
<span class="normal"><a href="#__codelineno-6-345">345</a></span>
<span class="normal"><a href="#__codelineno-6-346">346</a></span>
<span class="normal"><a href="#__codelineno-6-347">347</a></span>
<span class="normal"><a href="#__codelineno-6-348">348</a></span>
<span class="normal"><a href="#__codelineno-6-349">349</a></span>
<span class="normal"><a href="#__codelineno-6-350">350</a></span>
<span class="normal"><a href="#__codelineno-6-351">351</a></span>
<span class="normal"><a href="#__codelineno-6-352">352</a></span>
<span class="normal"><a href="#__codelineno-6-353">353</a></span>
<span class="normal"><a href="#__codelineno-6-354">354</a></span>
<span class="normal"><a href="#__codelineno-6-355">355</a></span>
<span class="normal"><a href="#__codelineno-6-356">356</a></span>
<span class="normal"><a href="#__codelineno-6-357">357</a></span>
<span class="normal"><a href="#__codelineno-6-358">358</a></span>
<span class="normal"><a href="#__codelineno-6-359">359</a></span>
<span class="normal"><a href="#__codelineno-6-360">360</a></span>
<span class="normal"><a href="#__codelineno-6-361">361</a></span>
<span class="normal"><a href="#__codelineno-6-362">362</a></span>
<span class="normal"><a href="#__codelineno-6-363">363</a></span>
<span class="normal"><a href="#__codelineno-6-364">364</a></span>
<span class="normal"><a href="#__codelineno-6-365">365</a></span>
<span class="normal"><a href="#__codelineno-6-366">366</a></span>
<span class="normal"><a href="#__codelineno-6-367">367</a></span>
<span class="normal"><a href="#__codelineno-6-368">368</a></span>
<span class="normal"><a href="#__codelineno-6-369">369</a></span>
<span class="normal"><a href="#__codelineno-6-370">370</a></span>
<span class="normal"><a href="#__codelineno-6-371">371</a></span>
<span class="normal"><a href="#__codelineno-6-372">372</a></span>
<span class="normal"><a href="#__codelineno-6-373">373</a></span>
<span class="normal"><a href="#__codelineno-6-374">374</a></span>
<span class="normal"><a href="#__codelineno-6-375">375</a></span>
<span class="normal"><a href="#__codelineno-6-376">376</a></span>
<span class="normal"><a href="#__codelineno-6-377">377</a></span>
<span class="normal"><a href="#__codelineno-6-378">378</a></span>
<span class="normal"><a href="#__codelineno-6-379">379</a></span>
<span class="normal"><a href="#__codelineno-6-380">380</a></span>
<span class="normal"><a href="#__codelineno-6-381">381</a></span>
<span class="normal"><a href="#__codelineno-6-382">382</a></span>
<span class="normal"><a href="#__codelineno-6-383">383</a></span>
<span class="normal"><a href="#__codelineno-6-384">384</a></span>
<span class="normal"><a href="#__codelineno-6-385">385</a></span>
<span class="normal"><a href="#__codelineno-6-386">386</a></span>
<span class="normal"><a href="#__codelineno-6-387">387</a></span>
<span class="normal"><a href="#__codelineno-6-388">388</a></span>
<span class="normal"><a href="#__codelineno-6-389">389</a></span>
<span class="normal"><a href="#__codelineno-6-390">390</a></span>
<span class="normal"><a href="#__codelineno-6-391">391</a></span>
<span class="normal"><a href="#__codelineno-6-392">392</a></span>
<span class="normal"><a href="#__codelineno-6-393">393</a></span>
<span class="normal"><a href="#__codelineno-6-394">394</a></span>
<span class="normal"><a href="#__codelineno-6-395">395</a></span>
<span class="normal"><a href="#__codelineno-6-396">396</a></span>
<span class="normal"><a href="#__codelineno-6-397">397</a></span>
<span class="normal"><a href="#__codelineno-6-398">398</a></span>
<span class="normal"><a href="#__codelineno-6-399">399</a></span>
<span class="normal"><a href="#__codelineno-6-400">400</a></span>
<span class="normal"><a href="#__codelineno-6-401">401</a></span>
<span class="normal"><a href="#__codelineno-6-402">402</a></span>
<span class="normal"><a href="#__codelineno-6-403">403</a></span>
<span class="normal"><a href="#__codelineno-6-404">404</a></span>
<span class="normal"><a href="#__codelineno-6-405">405</a></span>
<span class="normal"><a href="#__codelineno-6-406">406</a></span>
<span class="normal"><a href="#__codelineno-6-407">407</a></span>
<span class="normal"><a href="#__codelineno-6-408">408</a></span>
<span class="normal"><a href="#__codelineno-6-409">409</a></span>
<span class="normal"><a href="#__codelineno-6-410">410</a></span>
<span class="normal"><a href="#__codelineno-6-411">411</a></span>
<span class="normal"><a href="#__codelineno-6-412">412</a></span>
<span class="normal"><a href="#__codelineno-6-413">413</a></span>
<span class="normal"><a href="#__codelineno-6-414">414</a></span>
<span class="normal"><a href="#__codelineno-6-415">415</a></span>
<span class="normal"><a href="#__codelineno-6-416">416</a></span>
<span class="normal"><a href="#__codelineno-6-417">417</a></span>
<span class="normal"><a href="#__codelineno-6-418">418</a></span>
<span class="normal"><a href="#__codelineno-6-419">419</a></span>
<span class="normal"><a href="#__codelineno-6-420">420</a></span>
<span class="normal"><a href="#__codelineno-6-421">421</a></span>
<span class="normal"><a href="#__codelineno-6-422">422</a></span>
<span class="normal"><a href="#__codelineno-6-423">423</a></span>
<span class="normal"><a href="#__codelineno-6-424">424</a></span>
<span class="normal"><a href="#__codelineno-6-425">425</a></span>
<span class="normal"><a href="#__codelineno-6-426">426</a></span>
<span class="normal"><a href="#__codelineno-6-427">427</a></span>
<span class="normal"><a href="#__codelineno-6-428">428</a></span>
<span class="normal"><a href="#__codelineno-6-429">429</a></span>
<span class="normal"><a href="#__codelineno-6-430">430</a></span>
<span class="normal"><a href="#__codelineno-6-431">431</a></span>
<span class="normal"><a href="#__codelineno-6-432">432</a></span>
<span class="normal"><a href="#__codelineno-6-433">433</a></span>
<span class="normal"><a href="#__codelineno-6-434">434</a></span>
<span class="normal"><a href="#__codelineno-6-435">435</a></span>
<span class="normal"><a href="#__codelineno-6-436">436</a></span>
<span class="normal"><a href="#__codelineno-6-437">437</a></span>
<span class="normal"><a href="#__codelineno-6-438">438</a></span>
<span class="normal"><a href="#__codelineno-6-439">439</a></span>
<span class="normal"><a href="#__codelineno-6-440">440</a></span>
<span class="normal"><a href="#__codelineno-6-441">441</a></span>
<span class="normal"><a href="#__codelineno-6-442">442</a></span>
<span class="normal"><a href="#__codelineno-6-443">443</a></span>
<span class="normal"><a href="#__codelineno-6-444">444</a></span>
<span class="normal"><a href="#__codelineno-6-445">445</a></span>
<span class="normal"><a href="#__codelineno-6-446">446</a></span>
<span class="normal"><a href="#__codelineno-6-447">447</a></span>
<span class="normal"><a href="#__codelineno-6-448">448</a></span>
<span class="normal"><a href="#__codelineno-6-449">449</a></span>
<span class="normal"><a href="#__codelineno-6-450">450</a></span>
<span class="normal"><a href="#__codelineno-6-451">451</a></span>
<span class="normal"><a href="#__codelineno-6-452">452</a></span>
<span class="normal"><a href="#__codelineno-6-453">453</a></span>
<span class="normal"><a href="#__codelineno-6-454">454</a></span>
<span class="normal"><a href="#__codelineno-6-455">455</a></span>
<span class="normal"><a href="#__codelineno-6-456">456</a></span>
<span class="normal"><a href="#__codelineno-6-457">457</a></span>
<span class="normal"><a href="#__codelineno-6-458">458</a></span>
<span class="normal"><a href="#__codelineno-6-459">459</a></span>
<span class="normal"><a href="#__codelineno-6-460">460</a></span>
<span class="normal"><a href="#__codelineno-6-461">461</a></span>
<span class="normal"><a href="#__codelineno-6-462">462</a></span>
<span class="normal"><a href="#__codelineno-6-463">463</a></span>
<span class="normal"><a href="#__codelineno-6-464">464</a></span>
<span class="normal"><a href="#__codelineno-6-465">465</a></span>
<span class="normal"><a href="#__codelineno-6-466">466</a></span>
<span class="normal"><a href="#__codelineno-6-467">467</a></span>
<span class="normal"><a href="#__codelineno-6-468">468</a></span>
<span class="normal"><a href="#__codelineno-6-469">469</a></span>
<span class="normal"><a href="#__codelineno-6-470">470</a></span>
<span class="normal"><a href="#__codelineno-6-471">471</a></span>
<span class="normal"><a href="#__codelineno-6-472">472</a></span>
<span class="normal"><a href="#__codelineno-6-473">473</a></span>
<span class="normal"><a href="#__codelineno-6-474">474</a></span>
<span class="normal"><a href="#__codelineno-6-475">475</a></span>
<span class="normal"><a href="#__codelineno-6-476">476</a></span>
<span class="normal"><a href="#__codelineno-6-477">477</a></span>
<span class="normal"><a href="#__codelineno-6-478">478</a></span>
<span class="normal"><a href="#__codelineno-6-479">479</a></span>
<span class="normal"><a href="#__codelineno-6-480">480</a></span>
<span class="normal"><a href="#__codelineno-6-481">481</a></span>
<span class="normal"><a href="#__codelineno-6-482">482</a></span>
<span class="normal"><a href="#__codelineno-6-483">483</a></span>
<span class="normal"><a href="#__codelineno-6-484">484</a></span>
<span class="normal"><a href="#__codelineno-6-485">485</a></span>
<span class="normal"><a href="#__codelineno-6-486">486</a></span>
<span class="normal"><a href="#__codelineno-6-487">487</a></span>
<span class="normal"><a href="#__codelineno-6-488">488</a></span>
<span class="normal"><a href="#__codelineno-6-489">489</a></span>
<span class="normal"><a href="#__codelineno-6-490">490</a></span>
<span class="normal"><a href="#__codelineno-6-491">491</a></span>
<span class="normal"><a href="#__codelineno-6-492">492</a></span>
<span class="normal"><a href="#__codelineno-6-493">493</a></span>
<span class="normal"><a href="#__codelineno-6-494">494</a></span>
<span class="normal"><a href="#__codelineno-6-495">495</a></span>
<span class="normal"><a href="#__codelineno-6-496">496</a></span>
<span class="normal"><a href="#__codelineno-6-497">497</a></span>
<span class="normal"><a href="#__codelineno-6-498">498</a></span>
<span class="normal"><a href="#__codelineno-6-499">499</a></span>
<span class="normal"><a href="#__codelineno-6-500">500</a></span>
<span class="normal"><a href="#__codelineno-6-501">501</a></span>
<span class="normal"><a href="#__codelineno-6-502">502</a></span>
<span class="normal"><a href="#__codelineno-6-503">503</a></span>
<span class="normal"><a href="#__codelineno-6-504">504</a></span>
<span class="normal"><a href="#__codelineno-6-505">505</a></span>
<span class="normal"><a href="#__codelineno-6-506">506</a></span>
<span class="normal"><a href="#__codelineno-6-507">507</a></span>
<span class="normal"><a href="#__codelineno-6-508">508</a></span>
<span class="normal"><a href="#__codelineno-6-509">509</a></span>
<span class="normal"><a href="#__codelineno-6-510">510</a></span>
<span class="normal"><a href="#__codelineno-6-511">511</a></span>
<span class="normal"><a href="#__codelineno-6-512">512</a></span>
<span class="normal"><a href="#__codelineno-6-513">513</a></span>
<span class="normal"><a href="#__codelineno-6-514">514</a></span>
<span class="normal"><a href="#__codelineno-6-515">515</a></span>
<span class="normal"><a href="#__codelineno-6-516">516</a></span>
<span class="normal"><a href="#__codelineno-6-517">517</a></span>
<span class="normal"><a href="#__codelineno-6-518">518</a></span>
<span class="normal"><a href="#__codelineno-6-519">519</a></span>
<span class="normal"><a href="#__codelineno-6-520">520</a></span>
<span class="normal"><a href="#__codelineno-6-521">521</a></span>
<span class="normal"><a href="#__codelineno-6-522">522</a></span>
<span class="normal"><a href="#__codelineno-6-523">523</a></span>
<span class="normal"><a href="#__codelineno-6-524">524</a></span>
<span class="normal"><a href="#__codelineno-6-525">525</a></span>
<span class="normal"><a href="#__codelineno-6-526">526</a></span>
<span class="normal"><a href="#__codelineno-6-527">527</a></span>
<span class="normal"><a href="#__codelineno-6-528">528</a></span>
<span class="normal"><a href="#__codelineno-6-529">529</a></span>
<span class="normal"><a href="#__codelineno-6-530">530</a></span>
<span class="normal"><a href="#__codelineno-6-531">531</a></span>
<span class="normal"><a href="#__codelineno-6-532">532</a></span>
<span class="normal"><a href="#__codelineno-6-533">533</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="c1"># emacs: -*- mode: python; py-indent-offset: 4; indent-tabs-mode: nil -*-</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="c1"># vi: set ft=python sts=4 ts=4 sw=4 et:</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="c1">#</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="c1"># Copyright 2023 The Axon Lab &lt;theaxonlab@gmail.com&gt;</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="c1">#</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="c1"># you may not use this file except in compliance with the License.</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="c1"># You may obtain a copy of the License at</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="c1">#</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="c1">#</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="c1"># See the License for the specific language governing permissions and</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="c1"># limitations under the License.</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="c1">#</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="c1"># We support and encourage derived works from this project, please read</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="c1"># about our expectations at</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="c1">#</span>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="c1">#     https://www.nipreps.org/community/licensing/</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="c1">#</span>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="c1"># STATEMENT OF CHANGES: This file is derived from sources licensed under the Apache-2.0 terms,</span>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="c1"># and this file has been changed.</span>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="c1"># The original file this work derives from is found at:</span>
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26"></a><span class="c1"># https://github.com/nipy/heudiconv/blob/55524168b02519bbf0a3a1c94cafb29a419728a0/heudiconv/heuristics/reproin.py</span>
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27"></a><span class="c1">#</span>
</span><span id="__span-6-28"><a id="__codelineno-6-28" name="__codelineno-6-28"></a><span class="c1"># ORIGINAL WORK&#39;S ATTRIBUTION NOTICE:</span>
</span><span id="__span-6-29"><a id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="c1">#</span>
</span><span id="__span-6-30"><a id="__codelineno-6-30" name="__codelineno-6-30"></a><span class="c1">#     Copyright [2014-2019] [Heudiconv developers]</span>
</span><span id="__span-6-31"><a id="__codelineno-6-31" name="__codelineno-6-31"></a><span class="c1">#</span>
</span><span id="__span-6-32"><a id="__codelineno-6-32" name="__codelineno-6-32"></a><span class="c1">#     Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
</span><span id="__span-6-33"><a id="__codelineno-6-33" name="__codelineno-6-33"></a><span class="c1">#     you may not use this file except in compliance with the License.</span>
</span><span id="__span-6-34"><a id="__codelineno-6-34" name="__codelineno-6-34"></a><span class="c1">#     You may obtain a copy of the License at</span>
</span><span id="__span-6-35"><a id="__codelineno-6-35" name="__codelineno-6-35"></a><span class="c1">#</span>
</span><span id="__span-6-36"><a id="__codelineno-6-36" name="__codelineno-6-36"></a><span class="c1">#         http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id="__span-6-37"><a id="__codelineno-6-37" name="__codelineno-6-37"></a><span class="c1">#</span>
</span><span id="__span-6-38"><a id="__codelineno-6-38" name="__codelineno-6-38"></a><span class="c1">#     Unless required by applicable law or agreed to in writing, software</span>
</span><span id="__span-6-39"><a id="__codelineno-6-39" name="__codelineno-6-39"></a><span class="c1">#     distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
</span><span id="__span-6-40"><a id="__codelineno-6-40" name="__codelineno-6-40"></a><span class="c1">#     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
</span><span id="__span-6-41"><a id="__codelineno-6-41" name="__codelineno-6-41"></a><span class="c1">#     See the License for the specific language governing permissions and</span>
</span><span id="__span-6-42"><a id="__codelineno-6-42" name="__codelineno-6-42"></a><span class="c1">#     limitations under the License.</span>
</span><span id="__span-6-43"><a id="__codelineno-6-43" name="__codelineno-6-43"></a><span class="sd">&quot;&quot;&quot;Reproin heuristic.&quot;&quot;&quot;</span>
</span><span id="__span-6-44"><a id="__codelineno-6-44" name="__codelineno-6-44"></a>
</span><span id="__span-6-45"><a id="__codelineno-6-45" name="__codelineno-6-45"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</span><span id="__span-6-46"><a id="__codelineno-6-46" name="__codelineno-6-46"></a>
</span><span id="__span-6-47"><a id="__codelineno-6-47" name="__codelineno-6-47"></a><span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>
</span><span id="__span-6-48"><a id="__codelineno-6-48" name="__codelineno-6-48"></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
</span><span id="__span-6-49"><a id="__codelineno-6-49" name="__codelineno-6-49"></a><span class="kn">import</span> <span class="nn">logging</span>
</span><span id="__span-6-50"><a id="__codelineno-6-50" name="__codelineno-6-50"></a><span class="kn">import</span> <span class="nn">re</span>
</span><span id="__span-6-51"><a id="__codelineno-6-51" name="__codelineno-6-51"></a>
</span><span id="__span-6-52"><a id="__codelineno-6-52" name="__codelineno-6-52"></a><span class="kn">import</span> <span class="nn">pydicom</span> <span class="k">as</span> <span class="nn">dcm</span>
</span><span id="__span-6-53"><a id="__codelineno-6-53" name="__codelineno-6-53"></a>
</span><span id="__span-6-54"><a id="__codelineno-6-54" name="__codelineno-6-54"></a><span class="kn">from</span> <span class="nn">heudiconv.utils</span> <span class="kn">import</span> <span class="n">SeqInfo</span>
</span><span id="__span-6-55"><a id="__codelineno-6-55" name="__codelineno-6-55"></a><span class="kn">from</span> <span class="nn">heudiconv.heuristics.reproin</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="__span-6-56"><a id="__codelineno-6-56" name="__codelineno-6-56"></a>    <span class="n">_apply_substitutions</span><span class="p">,</span>
</span><span id="__span-6-57"><a id="__codelineno-6-57" name="__codelineno-6-57"></a>    <span class="n">get_study_hash</span><span class="p">,</span>
</span><span id="__span-6-58"><a id="__codelineno-6-58" name="__codelineno-6-58"></a>    <span class="n">get_study_description</span><span class="p">,</span>
</span><span id="__span-6-59"><a id="__codelineno-6-59" name="__codelineno-6-59"></a><span class="p">)</span>
</span><span id="__span-6-60"><a id="__codelineno-6-60" name="__codelineno-6-60"></a>
</span><span id="__span-6-61"><a id="__codelineno-6-61" name="__codelineno-6-61"></a><span class="n">lgr</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;heudiconv&quot;</span><span class="p">)</span>
</span><span id="__span-6-62"><a id="__codelineno-6-62" name="__codelineno-6-62"></a>
</span><span id="__span-6-63"><a id="__codelineno-6-63" name="__codelineno-6-63"></a>
</span><span id="__span-6-64"><a id="__codelineno-6-64" name="__codelineno-6-64"></a><span class="n">DWI_RES</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-6-65"><a id="__codelineno-6-65" name="__codelineno-6-65"></a>    <span class="s2">&quot;1.6mm-iso&quot;</span><span class="p">:</span> <span class="s2">&quot;highres&quot;</span><span class="p">,</span>
</span><span id="__span-6-66"><a id="__codelineno-6-66" name="__codelineno-6-66"></a>    <span class="s2">&quot;2mm-iso&quot;</span><span class="p">:</span> <span class="s2">&quot;lowres&quot;</span><span class="p">,</span>
</span><span id="__span-6-67"><a id="__codelineno-6-67" name="__codelineno-6-67"></a><span class="p">}</span>
</span><span id="__span-6-68"><a id="__codelineno-6-68" name="__codelineno-6-68"></a>
</span><span id="__span-6-69"><a id="__codelineno-6-69" name="__codelineno-6-69"></a>
</span><span id="__span-6-70"><a id="__codelineno-6-70" name="__codelineno-6-70"></a><span class="n">IGNORE_PROTOCOLS</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-6-71"><a id="__codelineno-6-71" name="__codelineno-6-71"></a>    <span class="s2">&quot;DEV&quot;</span><span class="p">,</span>
</span><span id="__span-6-72"><a id="__codelineno-6-72" name="__codelineno-6-72"></a>    <span class="s2">&quot;LABEL&quot;</span><span class="p">,</span>
</span><span id="__span-6-73"><a id="__codelineno-6-73" name="__codelineno-6-73"></a>    <span class="s2">&quot;REPORT&quot;</span><span class="p">,</span>
</span><span id="__span-6-74"><a id="__codelineno-6-74" name="__codelineno-6-74"></a>    <span class="s2">&quot;ADC&quot;</span><span class="p">,</span>
</span><span id="__span-6-75"><a id="__codelineno-6-75" name="__codelineno-6-75"></a>    <span class="s2">&quot;TRACEW&quot;</span><span class="p">,</span>
</span><span id="__span-6-76"><a id="__codelineno-6-76" name="__codelineno-6-76"></a>    <span class="s2">&quot;FA&quot;</span><span class="p">,</span>
</span><span id="__span-6-77"><a id="__codelineno-6-77" name="__codelineno-6-77"></a>    <span class="s2">&quot;ColFA&quot;</span><span class="p">,</span>
</span><span id="__span-6-78"><a id="__codelineno-6-78" name="__codelineno-6-78"></a>    <span class="s2">&quot;B0&quot;</span><span class="p">,</span>
</span><span id="__span-6-79"><a id="__codelineno-6-79" name="__codelineno-6-79"></a>    <span class="s2">&quot;TENSOR&quot;</span><span class="p">,</span>
</span><span id="__span-6-80"><a id="__codelineno-6-80" name="__codelineno-6-80"></a>    <span class="s2">&quot;10meas&quot;</span><span class="p">,</span>  <span class="c1"># dismiss a trial of fmap acquisition</span>
</span><span id="__span-6-81"><a id="__codelineno-6-81" name="__codelineno-6-81"></a>    <span class="s2">&quot;testJB&quot;</span><span class="p">,</span>  <span class="c1"># dismiss a test trial of the cmrr sequence</span>
</span><span id="__span-6-82"><a id="__codelineno-6-82" name="__codelineno-6-82"></a><span class="p">)</span>
</span><span id="__span-6-83"><a id="__codelineno-6-83" name="__codelineno-6-83"></a>
</span><span id="__span-6-84"><a id="__codelineno-6-84" name="__codelineno-6-84"></a><span class="n">bids_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;_(?=(dir|acq|task|run)-([A-Za-z0-9]+))&quot;</span><span class="p">)</span>
</span><span id="__span-6-85"><a id="__codelineno-6-85" name="__codelineno-6-85"></a>
</span><span id="__span-6-86"><a id="__codelineno-6-86" name="__codelineno-6-86"></a>
</span><span id="__span-6-87"><a id="__codelineno-6-87" name="__codelineno-6-87"></a><span class="c1"># Terminology to harmonise and use to name variables etc</span>
</span><span id="__span-6-88"><a id="__codelineno-6-88" name="__codelineno-6-88"></a><span class="c1"># experiment</span>
</span><span id="__span-6-89"><a id="__codelineno-6-89" name="__codelineno-6-89"></a><span class="c1">#  subject</span>
</span><span id="__span-6-90"><a id="__codelineno-6-90" name="__codelineno-6-90"></a><span class="c1">#   [session]</span>
</span><span id="__span-6-91"><a id="__codelineno-6-91" name="__codelineno-6-91"></a><span class="c1">#    exam (AKA scanning session) - currently seqinfo, unless brought together from multiple</span>
</span><span id="__span-6-92"><a id="__codelineno-6-92" name="__codelineno-6-92"></a><span class="c1">#     series  (AKA protocol?)</span>
</span><span id="__span-6-93"><a id="__codelineno-6-93" name="__codelineno-6-93"></a><span class="c1">#      - series_spec - deduced from fields the spec (literal value)</span>
</span><span id="__span-6-94"><a id="__codelineno-6-94" name="__codelineno-6-94"></a><span class="c1">#      - series_info - the dictionary with fields parsed from series_spec</span>
</span><span id="__span-6-95"><a id="__codelineno-6-95" name="__codelineno-6-95"></a>
</span><span id="__span-6-96"><a id="__codelineno-6-96" name="__codelineno-6-96"></a><span class="c1"># Which fields in seqinfo (in this order) to check for the ReproIn spec</span>
</span><span id="__span-6-97"><a id="__codelineno-6-97" name="__codelineno-6-97"></a><span class="n">series_spec_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;protocol_name&quot;</span><span class="p">,</span> <span class="s2">&quot;series_description&quot;</span><span class="p">)</span>
</span><span id="__span-6-98"><a id="__codelineno-6-98" name="__codelineno-6-98"></a>
</span><span id="__span-6-99"><a id="__codelineno-6-99" name="__codelineno-6-99"></a><span class="c1"># dictionary from accession-number to runs that need to be marked as bad</span>
</span><span id="__span-6-100"><a id="__codelineno-6-100" name="__codelineno-6-100"></a><span class="c1"># NOTE: even if filename has number that is 0-padded, internally no padding</span>
</span><span id="__span-6-101"><a id="__codelineno-6-101" name="__codelineno-6-101"></a><span class="c1"># is done</span>
</span><span id="__span-6-102"><a id="__codelineno-6-102" name="__codelineno-6-102"></a><span class="n">fix_accession2run</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-6-103"><a id="__codelineno-6-103" name="__codelineno-6-103"></a>    <span class="c1"># e.g.:</span>
</span><span id="__span-6-104"><a id="__codelineno-6-104" name="__codelineno-6-104"></a>    <span class="c1"># &#39;A000035&#39;: [&#39;^8-&#39;, &#39;^9-&#39;],</span>
</span><span id="__span-6-105"><a id="__codelineno-6-105" name="__codelineno-6-105"></a><span class="p">}</span>
</span><span id="__span-6-106"><a id="__codelineno-6-106" name="__codelineno-6-106"></a>
</span><span id="__span-6-107"><a id="__codelineno-6-107" name="__codelineno-6-107"></a><span class="c1"># A dictionary containing fixes/remapping for sequence names per study.</span>
</span><span id="__span-6-108"><a id="__codelineno-6-108" name="__codelineno-6-108"></a><span class="c1"># Keys are md5sum of study_description from DICOMs, in the form of PI-Experimenter^protocolname</span>
</span><span id="__span-6-109"><a id="__codelineno-6-109" name="__codelineno-6-109"></a><span class="c1"># You can use `heudiconv -f reproin --command ls --files  PATH</span>
</span><span id="__span-6-110"><a id="__codelineno-6-110" name="__codelineno-6-110"></a><span class="c1"># to list the &quot;study hash&quot;.</span>
</span><span id="__span-6-111"><a id="__codelineno-6-111" name="__codelineno-6-111"></a><span class="c1"># Values are list of tuples in the form (regex_pattern, substitution).</span>
</span><span id="__span-6-112"><a id="__codelineno-6-112" name="__codelineno-6-112"></a><span class="c1"># If the  key is an empty string`&#39;&#39;&#39;&#39;`, it would apply to any study.</span>
</span><span id="__span-6-113"><a id="__codelineno-6-113" name="__codelineno-6-113"></a><span class="hll"><span class="n">protocols2fix</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span id="__span-6-114"><a id="__codelineno-6-114" name="__codelineno-6-114"></a><span class="hll">    <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span id="__span-6-115"><a id="__codelineno-6-115" name="__codelineno-6-115"></a><span class="hll">        <span class="p">(</span><span class="s2">&quot;t1_mprage_pre_Morpho&quot;</span><span class="p">,</span> <span class="s2">&quot;anat-T1w_acq-morphobox__mprage&quot;</span><span class="p">),</span>
</span></span><span id="__span-6-116"><a id="__codelineno-6-116" name="__codelineno-6-116"></a><span class="hll">        <span class="p">(</span>
</span></span><span id="__span-6-117"><a id="__codelineno-6-117" name="__codelineno-6-117"></a><span class="hll">            <span class="s2">&quot;micro_struct_137dir_BIPOLAR_b3000_1.6mm-iso&quot;</span><span class="p">,</span>
</span></span><span id="__span-6-118"><a id="__codelineno-6-118" name="__codelineno-6-118"></a><span class="hll">            <span class="s2">&quot;dwi-dwi_acq-highres_dir-unknown__137dir_bipolar&quot;</span><span class="p">,</span>
</span></span><span id="__span-6-119"><a id="__codelineno-6-119" name="__codelineno-6-119"></a><span class="hll">        <span class="p">),</span>
</span></span><span id="__span-6-120"><a id="__codelineno-6-120" name="__codelineno-6-120"></a><span class="hll">        <span class="p">(</span>
</span></span><span id="__span-6-121"><a id="__codelineno-6-121" name="__codelineno-6-121"></a><span class="hll">            <span class="s2">&quot;micro_struct_137dir_BIPOLAR_b3000_1.6mm-iso&quot;</span><span class="p">,</span>
</span></span><span id="__span-6-122"><a id="__codelineno-6-122" name="__codelineno-6-122"></a><span class="hll">            <span class="s2">&quot;dwi-dwi_acq-highres_dir-unknown__137dir_bipolar&quot;</span><span class="p">,</span>
</span></span><span id="__span-6-123"><a id="__codelineno-6-123" name="__codelineno-6-123"></a><span class="hll">        <span class="p">),</span>
</span></span><span id="__span-6-124"><a id="__codelineno-6-124" name="__codelineno-6-124"></a><span class="hll">        <span class="p">(</span>
</span></span><span id="__span-6-125"><a id="__codelineno-6-125" name="__codelineno-6-125"></a><span class="hll">            <span class="s2">&quot;micro_struct_137dir_BIPOLAR_b3000_2mm-iso&quot;</span><span class="p">,</span>
</span></span><span id="__span-6-126"><a id="__codelineno-6-126" name="__codelineno-6-126"></a><span class="hll">            <span class="s2">&quot;dwi-dwi_acq-lowres_dir-unknown__137dir_bipolar&quot;</span><span class="p">,</span>
</span></span><span id="__span-6-127"><a id="__codelineno-6-127" name="__codelineno-6-127"></a><span class="hll">        <span class="p">),</span>
</span></span><span id="__span-6-128"><a id="__codelineno-6-128" name="__codelineno-6-128"></a><span class="hll">        <span class="p">(</span><span class="s2">&quot;gre_field_mapping_1.6mmiso&quot;</span><span class="p">,</span> <span class="s2">&quot;fmap-phasediff__gre&quot;</span><span class="p">),</span>
</span></span><span id="__span-6-129"><a id="__codelineno-6-129" name="__codelineno-6-129"></a><span class="hll">        <span class="p">(</span>
</span></span><span id="__span-6-130"><a id="__codelineno-6-130" name="__codelineno-6-130"></a><span class="hll">            <span class="s2">&quot;cmrr_mbep2d_bold_me4_sms4_fa75_750meas&quot;</span><span class="p">,</span>
</span></span><span id="__span-6-131"><a id="__codelineno-6-131" name="__codelineno-6-131"></a><span class="hll">            <span class="s2">&quot;func-bold_task-rest__750meas&quot;</span><span class="p">,</span>
</span></span><span id="__span-6-132"><a id="__codelineno-6-132" name="__codelineno-6-132"></a><span class="hll">        <span class="p">),</span>
</span></span><span id="__span-6-133"><a id="__codelineno-6-133" name="__codelineno-6-133"></a><span class="hll">        <span class="p">(</span>
</span></span><span id="__span-6-134"><a id="__codelineno-6-134" name="__codelineno-6-134"></a><span class="hll">            <span class="s2">&quot;cmrr_mbep2d_bold_me4_sms4_fa80&quot;</span><span class="p">,</span>
</span></span><span id="__span-6-135"><a id="__codelineno-6-135" name="__codelineno-6-135"></a><span class="hll">            <span class="s2">&quot;func-bold_task-rest_acq-fa80__cmrr&quot;</span><span class="p">,</span>
</span></span><span id="__span-6-136"><a id="__codelineno-6-136" name="__codelineno-6-136"></a><span class="hll">        <span class="p">),</span>
</span></span><span id="__span-6-137"><a id="__codelineno-6-137" name="__codelineno-6-137"></a><span class="hll">        <span class="p">(</span>
</span></span><span id="__span-6-138"><a id="__codelineno-6-138" name="__codelineno-6-138"></a><span class="hll">            <span class="s2">&quot;cmrr_mbep2d_bold_me4_testJB&quot;</span><span class="p">,</span>
</span></span><span id="__span-6-139"><a id="__codelineno-6-139" name="__codelineno-6-139"></a><span class="hll">            <span class="s2">&quot;func-bold_task-rest_acq-testJB__cmrr&quot;</span><span class="p">,</span>
</span></span><span id="__span-6-140"><a id="__codelineno-6-140" name="__codelineno-6-140"></a><span class="hll">        <span class="p">),</span>
</span></span><span id="__span-6-141"><a id="__codelineno-6-141" name="__codelineno-6-141"></a><span class="hll">        <span class="p">(</span>
</span></span><span id="__span-6-142"><a id="__codelineno-6-142" name="__codelineno-6-142"></a><span class="hll">            <span class="s2">&quot;cmrr_mbep2d_bold_fmap_fa80&quot;</span><span class="p">,</span>
</span></span><span id="__span-6-143"><a id="__codelineno-6-143" name="__codelineno-6-143"></a><span class="hll">            <span class="s2">&quot;fmap-epi_acq-bold_dir-unknown__cmrr_mbepd2d_fa80&quot;</span><span class="p">,</span>
</span></span><span id="__span-6-144"><a id="__codelineno-6-144" name="__codelineno-6-144"></a><span class="hll">        <span class="p">),</span>
</span></span><span id="__span-6-145"><a id="__codelineno-6-145" name="__codelineno-6-145"></a><span class="hll">        <span class="p">(</span><span class="s2">&quot;cmrr_mbep2d_bold_me4_sms4&quot;</span><span class="p">,</span> <span class="s2">&quot;func-bold_task-qct__cmrr&quot;</span><span class="p">),</span>
</span></span><span id="__span-6-146"><a id="__codelineno-6-146" name="__codelineno-6-146"></a><span class="hll">        <span class="p">(</span><span class="s2">&quot;_task-qc_&quot;</span><span class="p">,</span> <span class="s2">&quot;_task-qct_&quot;</span><span class="p">),</span>
</span></span><span id="__span-6-147"><a id="__codelineno-6-147" name="__codelineno-6-147"></a><span class="hll">        <span class="p">(</span><span class="s2">&quot;anat-T2w__flair&quot;</span><span class="p">,</span> <span class="s2">&quot;anat-FLAIR__spcir&quot;</span><span class="p">),</span>
</span></span><span id="__span-6-148"><a id="__codelineno-6-148" name="__codelineno-6-148"></a><span class="hll">        <span class="p">(</span><span class="s2">&quot;AAHead_Scout_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;anat-scout&quot;</span><span class="p">),</span>
</span></span><span id="__span-6-149"><a id="__codelineno-6-149" name="__codelineno-6-149"></a>    <span class="p">]</span>
</span><span id="__span-6-150"><a id="__codelineno-6-150" name="__codelineno-6-150"></a>    <span class="c1"># e.g., QA:</span>
</span><span id="__span-6-151"><a id="__codelineno-6-151" name="__codelineno-6-151"></a>    <span class="c1"># &#39;43b67d9139e8c7274578b7451ab21123&#39;:</span>
</span><span id="__span-6-152"><a id="__codelineno-6-152" name="__codelineno-6-152"></a>    <span class="c1">#     [</span>
</span><span id="__span-6-153"><a id="__codelineno-6-153" name="__codelineno-6-153"></a>    <span class="c1">#      (&#39;BOLD_p2_s4_3\.5mm&#39;, &#39;func_task-rest_acq-p2-s4-3.5mm&#39;),</span>
</span><span id="__span-6-154"><a id="__codelineno-6-154" name="__codelineno-6-154"></a>    <span class="c1">#      (&#39;BOLD_&#39;, &#39;func_task-rest&#39;),</span>
</span><span id="__span-6-155"><a id="__codelineno-6-155" name="__codelineno-6-155"></a>    <span class="c1">#      (&#39;_p2_s4&#39;,        &#39;_acq-p2-s4&#39;),</span>
</span><span id="__span-6-156"><a id="__codelineno-6-156" name="__codelineno-6-156"></a>    <span class="c1">#      (&#39;_p2&#39;, &#39;_acq-p2&#39;),</span>
</span><span id="__span-6-157"><a id="__codelineno-6-157" name="__codelineno-6-157"></a>    <span class="c1">#     ],</span>
</span><span id="__span-6-158"><a id="__codelineno-6-158" name="__codelineno-6-158"></a>    <span class="c1"># &#39;&#39;:  # for any study example with regexes used</span>
</span><span id="__span-6-159"><a id="__codelineno-6-159" name="__codelineno-6-159"></a>    <span class="c1">#     [</span>
</span><span id="__span-6-160"><a id="__codelineno-6-160" name="__codelineno-6-160"></a>    <span class="c1">#         (&#39;AAHead_Scout_.*&#39;, &#39;anat-scout&#39;),</span>
</span><span id="__span-6-161"><a id="__codelineno-6-161" name="__codelineno-6-161"></a>    <span class="c1">#         (&#39;^dti_.*&#39;, &#39;dwi&#39;),</span>
</span><span id="__span-6-162"><a id="__codelineno-6-162" name="__codelineno-6-162"></a>    <span class="c1">#         (&#39;^.*_distortion_corr.*_([ap]+)_([12])&#39;, r&#39;fmap-epi_dir-\1_run-\2&#39;),</span>
</span><span id="__span-6-163"><a id="__codelineno-6-163" name="__codelineno-6-163"></a>    <span class="c1">#         (&#39;^(.+)_ap.*_r(0[0-9])&#39;, r&#39;func_task-\1_run-\2&#39;),</span>
</span><span id="__span-6-164"><a id="__codelineno-6-164" name="__codelineno-6-164"></a>    <span class="c1">#         (&#39;^t1w_.*&#39;, &#39;anat-T1w&#39;),</span>
</span><span id="__span-6-165"><a id="__codelineno-6-165" name="__codelineno-6-165"></a>    <span class="c1">#         # problematic case -- multiple identically named pepolar fieldmap runs</span>
</span><span id="__span-6-166"><a id="__codelineno-6-166" name="__codelineno-6-166"></a>    <span class="c1">#         # I guess we will just sacrifice ability to detect canceled runs here.</span>
</span><span id="__span-6-167"><a id="__codelineno-6-167" name="__codelineno-6-167"></a>    <span class="c1">#         # And we cannot just use _run+ since it would increment independently</span>
</span><span id="__span-6-168"><a id="__codelineno-6-168" name="__codelineno-6-168"></a>    <span class="c1">#         # for ap and then for pa.  We will rely on having ap preceding pa.</span>
</span><span id="__span-6-169"><a id="__codelineno-6-169" name="__codelineno-6-169"></a>    <span class="c1">#         # Added  _acq-mb8  so they match the one in funcs</span>
</span><span id="__span-6-170"><a id="__codelineno-6-170" name="__codelineno-6-170"></a>    <span class="c1">#         (&#39;func_task-discorr_acq-ap&#39;, r&#39;fmap-epi_dir-ap_acq-mb8_run+&#39;),</span>
</span><span id="__span-6-171"><a id="__codelineno-6-171" name="__codelineno-6-171"></a>    <span class="c1">#         (&#39;func_task-discorr_acq-pa&#39;, r&#39;fmap-epi_dir-pa_acq-mb8_run=&#39;),</span>
</span><span id="__span-6-172"><a id="__codelineno-6-172" name="__codelineno-6-172"></a>    <span class="c1"># ]</span>
</span><span id="__span-6-173"><a id="__codelineno-6-173" name="__codelineno-6-173"></a><span class="p">}</span>
</span><span id="__span-6-174"><a id="__codelineno-6-174" name="__codelineno-6-174"></a>
</span><span id="__span-6-175"><a id="__codelineno-6-175" name="__codelineno-6-175"></a><span class="c1"># list containing StudyInstanceUID to skip -- hopefully doesn&#39;t happen too often</span>
</span><span id="__span-6-176"><a id="__codelineno-6-176" name="__codelineno-6-176"></a><span class="n">dicoms2skip</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-6-177"><a id="__codelineno-6-177" name="__codelineno-6-177"></a>    <span class="c1"># e.g.</span>
</span><span id="__span-6-178"><a id="__codelineno-6-178" name="__codelineno-6-178"></a>    <span class="c1"># &#39;1.3.12.2.1107.5.2.43.66112.30000016110117002435700000001&#39;,</span>
</span><span id="__span-6-179"><a id="__codelineno-6-179" name="__codelineno-6-179"></a><span class="p">]</span>
</span><span id="__span-6-180"><a id="__codelineno-6-180" name="__codelineno-6-180"></a>
</span><span id="__span-6-181"><a id="__codelineno-6-181" name="__codelineno-6-181"></a><span class="n">DEFAULT_FIELDS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-6-182"><a id="__codelineno-6-182" name="__codelineno-6-182"></a>    <span class="c1"># Let it just be in each json file extracted</span>
</span><span id="__span-6-183"><a id="__codelineno-6-183" name="__codelineno-6-183"></a>    <span class="s2">&quot;Acknowledgements&quot;</span><span class="p">:</span> <span class="s2">&quot;See README.md.&quot;</span><span class="p">,</span>
</span><span id="__span-6-184"><a id="__codelineno-6-184" name="__codelineno-6-184"></a><span class="p">}</span>
</span><span id="__span-6-185"><a id="__codelineno-6-185" name="__codelineno-6-185"></a>
</span><span id="__span-6-186"><a id="__codelineno-6-186" name="__codelineno-6-186"></a><span class="n">POPULATE_INTENDED_FOR_OPTS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-6-187"><a id="__codelineno-6-187" name="__codelineno-6-187"></a>    <span class="s2">&quot;matching_parameters&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ImagingVolume&quot;</span><span class="p">,</span> <span class="s2">&quot;Shims&quot;</span><span class="p">],</span>
</span><span id="__span-6-188"><a id="__codelineno-6-188" name="__codelineno-6-188"></a>    <span class="s2">&quot;criterion&quot;</span><span class="p">:</span> <span class="s2">&quot;Closest&quot;</span><span class="p">,</span>
</span><span id="__span-6-189"><a id="__codelineno-6-189" name="__codelineno-6-189"></a><span class="p">}</span>
</span><span id="__span-6-190"><a id="__codelineno-6-190" name="__codelineno-6-190"></a>
</span><span id="__span-6-191"><a id="__codelineno-6-191" name="__codelineno-6-191"></a>
</span><span id="__span-6-192"><a id="__codelineno-6-192" name="__codelineno-6-192"></a><span class="k">def</span> <span class="nf">filter_dicom</span><span class="p">(</span><span class="n">dcmdata</span><span class="p">:</span> <span class="n">dcm</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-6-193"><a id="__codelineno-6-193" name="__codelineno-6-193"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if a DICOM dataset should be filtered out, else False&quot;&quot;&quot;</span>
</span><span id="__span-6-194"><a id="__codelineno-6-194" name="__codelineno-6-194"></a>    <span class="k">return</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">dcmdata</span><span class="o">.</span><span class="n">StudyInstanceUID</span> <span class="ow">in</span> <span class="n">dicoms2skip</span> <span class="k">else</span> <span class="kc">False</span>
</span><span id="__span-6-195"><a id="__codelineno-6-195" name="__codelineno-6-195"></a>
</span><span id="__span-6-196"><a id="__codelineno-6-196" name="__codelineno-6-196"></a>
</span><span id="__span-6-197"><a id="__codelineno-6-197" name="__codelineno-6-197"></a><span class="k">def</span> <span class="nf">filter_files</span><span class="p">(</span><span class="n">_fn</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-6-198"><a id="__codelineno-6-198" name="__codelineno-6-198"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if a file should be kept, else False.</span>
</span><span id="__span-6-199"><a id="__codelineno-6-199" name="__codelineno-6-199"></a>
</span><span id="__span-6-200"><a id="__codelineno-6-200" name="__codelineno-6-200"></a><span class="sd">    ATM reproin does not do any filtering. Override if you need to add some</span>
</span><span id="__span-6-201"><a id="__codelineno-6-201" name="__codelineno-6-201"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-6-202"><a id="__codelineno-6-202" name="__codelineno-6-202"></a>    <span class="k">return</span> <span class="ow">not</span> <span class="n">_fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;.dvs&quot;</span><span class="p">))</span>
</span><span id="__span-6-203"><a id="__codelineno-6-203" name="__codelineno-6-203"></a>
</span><span id="__span-6-204"><a id="__codelineno-6-204" name="__codelineno-6-204"></a>
</span><span id="__span-6-205"><a id="__codelineno-6-205" name="__codelineno-6-205"></a><span class="k">def</span> <span class="nf">fix_canceled_runs</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SeqInfo</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SeqInfo</span><span class="p">]:</span>
</span><span id="__span-6-206"><a id="__codelineno-6-206" name="__codelineno-6-206"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Function that adds cancelme_ to known bad runs which were forgotten&quot;&quot;&quot;</span>
</span><span id="__span-6-207"><a id="__codelineno-6-207" name="__codelineno-6-207"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">fix_accession2run</span><span class="p">:</span>
</span><span id="__span-6-208"><a id="__codelineno-6-208" name="__codelineno-6-208"></a>        <span class="k">return</span> <span class="n">seqinfo</span>  <span class="c1"># nothing to do</span>
</span><span id="__span-6-209"><a id="__codelineno-6-209" name="__codelineno-6-209"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">):</span>
</span><span id="__span-6-210"><a id="__codelineno-6-210" name="__codelineno-6-210"></a>        <span class="n">accession_number</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">accession_number</span>
</span><span id="__span-6-211"><a id="__codelineno-6-211" name="__codelineno-6-211"></a>        <span class="k">if</span> <span class="n">accession_number</span> <span class="ow">and</span> <span class="n">accession_number</span> <span class="ow">in</span> <span class="n">fix_accession2run</span><span class="p">:</span>
</span><span id="__span-6-212"><a id="__codelineno-6-212" name="__codelineno-6-212"></a>            <span class="n">lgr</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="__span-6-213"><a id="__codelineno-6-213" name="__codelineno-6-213"></a>                <span class="s2">&quot;Considering some runs possibly marked to be &quot;</span>
</span><span id="__span-6-214"><a id="__codelineno-6-214" name="__codelineno-6-214"></a>                <span class="s2">&quot;canceled for accession </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-6-215"><a id="__codelineno-6-215" name="__codelineno-6-215"></a>                <span class="n">accession_number</span><span class="p">,</span>
</span><span id="__span-6-216"><a id="__codelineno-6-216" name="__codelineno-6-216"></a>            <span class="p">)</span>
</span><span id="__span-6-217"><a id="__codelineno-6-217" name="__codelineno-6-217"></a>            <span class="c1"># This code is reminiscent of prior logic when operating on</span>
</span><span id="__span-6-218"><a id="__codelineno-6-218" name="__codelineno-6-218"></a>            <span class="c1"># a single accession, but left as is for now</span>
</span><span id="__span-6-219"><a id="__codelineno-6-219" name="__codelineno-6-219"></a>            <span class="n">badruns</span> <span class="o">=</span> <span class="n">fix_accession2run</span><span class="p">[</span><span class="n">accession_number</span><span class="p">]</span>
</span><span id="__span-6-220"><a id="__codelineno-6-220" name="__codelineno-6-220"></a>            <span class="n">badruns_pattern</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">badruns</span><span class="p">)</span>
</span><span id="__span-6-221"><a id="__codelineno-6-221" name="__codelineno-6-221"></a>            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">badruns_pattern</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="p">):</span>
</span><span id="__span-6-222"><a id="__codelineno-6-222" name="__codelineno-6-222"></a>                <span class="n">lgr</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fixing bad run </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="p">))</span>
</span><span id="__span-6-223"><a id="__codelineno-6-223" name="__codelineno-6-223"></a>                <span class="n">fixedkwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="__span-6-224"><a id="__codelineno-6-224" name="__codelineno-6-224"></a>                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">series_spec_fields</span><span class="p">:</span>
</span><span id="__span-6-225"><a id="__codelineno-6-225" name="__codelineno-6-225"></a>                    <span class="n">fixedkwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cancelme_&quot;</span> <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="__span-6-226"><a id="__codelineno-6-226" name="__codelineno-6-226"></a>                <span class="n">seqinfo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="o">**</span><span class="n">fixedkwargs</span><span class="p">)</span>
</span><span id="__span-6-227"><a id="__codelineno-6-227" name="__codelineno-6-227"></a>    <span class="k">return</span> <span class="n">seqinfo</span>
</span><span id="__span-6-228"><a id="__codelineno-6-228" name="__codelineno-6-228"></a>
</span><span id="__span-6-229"><a id="__codelineno-6-229" name="__codelineno-6-229"></a>
</span><span id="__span-6-230"><a id="__codelineno-6-230" name="__codelineno-6-230"></a><span class="k">def</span> <span class="nf">fix_dbic_protocol</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SeqInfo</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SeqInfo</span><span class="p">]:</span>
</span><span id="__span-6-231"><a id="__codelineno-6-231" name="__codelineno-6-231"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Ad-hoc fixup for existing protocols.</span>
</span><span id="__span-6-232"><a id="__codelineno-6-232" name="__codelineno-6-232"></a>
</span><span id="__span-6-233"><a id="__codelineno-6-233" name="__codelineno-6-233"></a><span class="sd">    It will operate in 3 stages on `protocols2fix` records.</span>
</span><span id="__span-6-234"><a id="__codelineno-6-234" name="__codelineno-6-234"></a><span class="sd">    1. consider a record which has md5sum of study_description</span>
</span><span id="__span-6-235"><a id="__codelineno-6-235" name="__codelineno-6-235"></a><span class="sd">    2. apply all substitutions, where key is a regular expression which</span>
</span><span id="__span-6-236"><a id="__codelineno-6-236" name="__codelineno-6-236"></a><span class="sd">       successfully searches (not necessarily matches, so anchor appropriately)</span>
</span><span id="__span-6-237"><a id="__codelineno-6-237" name="__codelineno-6-237"></a><span class="sd">       study_description</span>
</span><span id="__span-6-238"><a id="__codelineno-6-238" name="__codelineno-6-238"></a><span class="sd">    3. apply &quot;catch all&quot; substitutions in the key containing an empty string</span>
</span><span id="__span-6-239"><a id="__codelineno-6-239" name="__codelineno-6-239"></a>
</span><span id="__span-6-240"><a id="__codelineno-6-240" name="__codelineno-6-240"></a><span class="sd">    3. is somewhat redundant since `re.compile(&#39;.*&#39;)` could match any, but is</span>
</span><span id="__span-6-241"><a id="__codelineno-6-241" name="__codelineno-6-241"></a><span class="sd">    kept for simplicity of its specification.</span>
</span><span id="__span-6-242"><a id="__codelineno-6-242" name="__codelineno-6-242"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-6-243"><a id="__codelineno-6-243" name="__codelineno-6-243"></a>
</span><span id="__span-6-244"><a id="__codelineno-6-244" name="__codelineno-6-244"></a>    <span class="n">study_hash</span> <span class="o">=</span> <span class="n">get_study_hash</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">)</span>
</span><span id="__span-6-245"><a id="__codelineno-6-245" name="__codelineno-6-245"></a>    <span class="n">study_description</span> <span class="o">=</span> <span class="n">get_study_description</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">)</span>
</span><span id="__span-6-246"><a id="__codelineno-6-246" name="__codelineno-6-246"></a>
</span><span id="__span-6-247"><a id="__codelineno-6-247" name="__codelineno-6-247"></a>    <span class="c1"># We will consider first study specific (based on hash)</span>
</span><span id="__span-6-248"><a id="__codelineno-6-248" name="__codelineno-6-248"></a>    <span class="k">if</span> <span class="n">study_hash</span> <span class="ow">in</span> <span class="n">protocols2fix</span><span class="p">:</span>
</span><span id="__span-6-249"><a id="__codelineno-6-249" name="__codelineno-6-249"></a>        <span class="n">_apply_substitutions</span><span class="p">(</span>
</span><span id="__span-6-250"><a id="__codelineno-6-250" name="__codelineno-6-250"></a>            <span class="n">seqinfo</span><span class="p">,</span> <span class="n">protocols2fix</span><span class="p">[</span><span class="n">study_hash</span><span class="p">],</span> <span class="s2">&quot;study (</span><span class="si">%s</span><span class="s2">) specific&quot;</span> <span class="o">%</span> <span class="n">study_hash</span>
</span><span id="__span-6-251"><a id="__codelineno-6-251" name="__codelineno-6-251"></a>        <span class="p">)</span>
</span><span id="__span-6-252"><a id="__codelineno-6-252" name="__codelineno-6-252"></a>    <span class="c1"># Then go through all regexps returning regex &quot;search&quot; result</span>
</span><span id="__span-6-253"><a id="__codelineno-6-253" name="__codelineno-6-253"></a>    <span class="c1"># on study_description</span>
</span><span id="__span-6-254"><a id="__codelineno-6-254" name="__codelineno-6-254"></a>    <span class="k">for</span> <span class="n">sub</span><span class="p">,</span> <span class="n">substitutions</span> <span class="ow">in</span> <span class="n">protocols2fix</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-6-255"><a id="__codelineno-6-255" name="__codelineno-6-255"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sub</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">study_description</span><span class="p">):</span>
</span><span id="__span-6-256"><a id="__codelineno-6-256" name="__codelineno-6-256"></a>            <span class="n">_apply_substitutions</span><span class="p">(</span>
</span><span id="__span-6-257"><a id="__codelineno-6-257" name="__codelineno-6-257"></a>                <span class="n">seqinfo</span><span class="p">,</span> <span class="n">substitutions</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%r</span><span class="s2"> regex matching&quot;</span> <span class="o">%</span> <span class="n">sub</span><span class="o">.</span><span class="n">pattern</span>
</span><span id="__span-6-258"><a id="__codelineno-6-258" name="__codelineno-6-258"></a>            <span class="p">)</span>
</span><span id="__span-6-259"><a id="__codelineno-6-259" name="__codelineno-6-259"></a>    <span class="c1"># and at the end - global</span>
</span><span id="__span-6-260"><a id="__codelineno-6-260" name="__codelineno-6-260"></a>    <span class="k">if</span> <span class="s2">&quot;&quot;</span> <span class="ow">in</span> <span class="n">protocols2fix</span><span class="p">:</span>
</span><span id="__span-6-261"><a id="__codelineno-6-261" name="__codelineno-6-261"></a>        <span class="n">_apply_substitutions</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">,</span> <span class="n">protocols2fix</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">],</span> <span class="s2">&quot;global&quot;</span><span class="p">)</span>
</span><span id="__span-6-262"><a id="__codelineno-6-262" name="__codelineno-6-262"></a>
</span><span id="__span-6-263"><a id="__codelineno-6-263" name="__codelineno-6-263"></a>    <span class="k">return</span> <span class="n">seqinfo</span>
</span><span id="__span-6-264"><a id="__codelineno-6-264" name="__codelineno-6-264"></a>
</span><span id="__span-6-265"><a id="__codelineno-6-265" name="__codelineno-6-265"></a>
</span><span id="__span-6-266"><a id="__codelineno-6-266" name="__codelineno-6-266"></a><span class="k">def</span> <span class="nf">fix_seqinfo</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SeqInfo</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SeqInfo</span><span class="p">]:</span>
</span><span id="__span-6-267"><a id="__codelineno-6-267" name="__codelineno-6-267"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Just a helper on top of both fixers&quot;&quot;&quot;</span>
</span><span id="__span-6-268"><a id="__codelineno-6-268" name="__codelineno-6-268"></a>    <span class="c1"># add cancelme to known bad runs</span>
</span><span id="__span-6-269"><a id="__codelineno-6-269" name="__codelineno-6-269"></a>    <span class="n">seqinfo</span> <span class="o">=</span> <span class="n">fix_canceled_runs</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">)</span>
</span><span id="__span-6-270"><a id="__codelineno-6-270" name="__codelineno-6-270"></a>    <span class="n">seqinfo</span> <span class="o">=</span> <span class="n">fix_dbic_protocol</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">)</span>
</span><span id="__span-6-271"><a id="__codelineno-6-271" name="__codelineno-6-271"></a>    <span class="k">return</span> <span class="n">seqinfo</span>
</span><span id="__span-6-272"><a id="__codelineno-6-272" name="__codelineno-6-272"></a>
</span><span id="__span-6-273"><a id="__codelineno-6-273" name="__codelineno-6-273"></a>
</span><span id="__span-6-274"><a id="__codelineno-6-274" name="__codelineno-6-274"></a><span class="k">def</span> <span class="nf">create_key</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">outtype</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;nii.gz&quot;</span><span class="p">,),</span> <span class="n">annotation_classes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-6-275"><a id="__codelineno-6-275" name="__codelineno-6-275"></a>    <span class="k">if</span> <span class="n">template</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">template</span><span class="p">:</span>
</span><span id="__span-6-276"><a id="__codelineno-6-276" name="__codelineno-6-276"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Template must be a valid format string&quot;</span><span class="p">)</span>
</span><span id="__span-6-277"><a id="__codelineno-6-277" name="__codelineno-6-277"></a>    <span class="k">return</span> <span class="n">template</span><span class="p">,</span> <span class="n">outtype</span><span class="p">,</span> <span class="n">annotation_classes</span>
</span><span id="__span-6-278"><a id="__codelineno-6-278" name="__codelineno-6-278"></a>
</span><span id="__span-6-279"><a id="__codelineno-6-279" name="__codelineno-6-279"></a>
</span><span id="__span-6-280"><a id="__codelineno-6-280" name="__codelineno-6-280"></a><span class="k">def</span> <span class="nf">infotodict</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">):</span>
</span><span id="__span-6-281"><a id="__codelineno-6-281" name="__codelineno-6-281"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Heuristic evaluator for determining which runs belong where</span>
</span><span id="__span-6-282"><a id="__codelineno-6-282" name="__codelineno-6-282"></a>
</span><span id="__span-6-283"><a id="__codelineno-6-283" name="__codelineno-6-283"></a><span class="sd">    allowed template fields - follow python string module:</span>
</span><span id="__span-6-284"><a id="__codelineno-6-284" name="__codelineno-6-284"></a>
</span><span id="__span-6-285"><a id="__codelineno-6-285" name="__codelineno-6-285"></a><span class="sd">    item: index within category</span>
</span><span id="__span-6-286"><a id="__codelineno-6-286" name="__codelineno-6-286"></a><span class="sd">    subject: participant id</span>
</span><span id="__span-6-287"><a id="__codelineno-6-287" name="__codelineno-6-287"></a><span class="sd">    seqitem: run number during scanning</span>
</span><span id="__span-6-288"><a id="__codelineno-6-288" name="__codelineno-6-288"></a><span class="sd">    subindex: sub index within group</span>
</span><span id="__span-6-289"><a id="__codelineno-6-289" name="__codelineno-6-289"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-6-290"><a id="__codelineno-6-290" name="__codelineno-6-290"></a>    <span class="n">seqinfo</span> <span class="o">=</span> <span class="n">fix_seqinfo</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">)</span>
</span><span id="__span-6-291"><a id="__codelineno-6-291" name="__codelineno-6-291"></a>    <span class="n">lgr</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing </span><span class="si">%d</span><span class="s2"> seqinfo entries&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">))</span>
</span><span id="__span-6-292"><a id="__codelineno-6-292" name="__codelineno-6-292"></a>
</span><span id="__span-6-293"><a id="__codelineno-6-293" name="__codelineno-6-293"></a>    <span class="n">t1w</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span>
</span><span id="__span-6-294"><a id="__codelineno-6-294" name="__codelineno-6-294"></a>        <span class="s2">&quot;sub-</span><span class="si">{subject}</span><span class="s2">/</span><span class="si">{session}</span><span class="s2">/anat/sub-</span><span class="si">{subject}</span><span class="s2">_</span><span class="si">{session}</span><span class="s2">_acq-</span><span class="si">{acquisition}{run_entity}</span><span class="s2">_T1w&quot;</span>
</span><span id="__span-6-295"><a id="__codelineno-6-295" name="__codelineno-6-295"></a>    <span class="p">)</span>
</span><span id="__span-6-296"><a id="__codelineno-6-296" name="__codelineno-6-296"></a>    <span class="n">t2w</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span>
</span><span id="__span-6-297"><a id="__codelineno-6-297" name="__codelineno-6-297"></a>        <span class="s2">&quot;sub-</span><span class="si">{subject}</span><span class="s2">/</span><span class="si">{session}</span><span class="s2">/anat/sub-</span><span class="si">{subject}</span><span class="s2">_</span><span class="si">{session}{run_entity}</span><span class="s2">_T2w&quot;</span>
</span><span id="__span-6-298"><a id="__codelineno-6-298" name="__codelineno-6-298"></a>    <span class="p">)</span>
</span><span id="__span-6-299"><a id="__codelineno-6-299" name="__codelineno-6-299"></a>    <span class="n">t2_flair</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span>
</span><span id="__span-6-300"><a id="__codelineno-6-300" name="__codelineno-6-300"></a>        <span class="s2">&quot;sub-</span><span class="si">{subject}</span><span class="s2">/</span><span class="si">{session}</span><span class="s2">/anat/sub-</span><span class="si">{subject}</span><span class="s2">_</span><span class="si">{session}{run_entity}</span><span class="s2">_FLAIR&quot;</span>
</span><span id="__span-6-301"><a id="__codelineno-6-301" name="__codelineno-6-301"></a>    <span class="p">)</span>
</span><span id="__span-6-302"><a id="__codelineno-6-302" name="__codelineno-6-302"></a>    <span class="n">dwi</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span>
</span><span id="__span-6-303"><a id="__codelineno-6-303" name="__codelineno-6-303"></a>        <span class="s2">&quot;sub-</span><span class="si">{subject}</span><span class="s2">/</span><span class="si">{session}</span><span class="s2">/dwi/sub-</span><span class="si">{subject}</span><span class="s2">_</span><span class="si">{session}</span><span class="s2">_acq-</span><span class="si">{acq}</span><span class="s2">_dir-</span><span class="si">{dir}{run_entity}</span><span class="s2">_dwi&quot;</span>
</span><span id="__span-6-304"><a id="__codelineno-6-304" name="__codelineno-6-304"></a>    <span class="p">)</span>
</span><span id="__span-6-305"><a id="__codelineno-6-305" name="__codelineno-6-305"></a>    <span class="n">mag</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span>
</span><span id="__span-6-306"><a id="__codelineno-6-306" name="__codelineno-6-306"></a>        <span class="s2">&quot;sub-</span><span class="si">{subject}</span><span class="s2">/</span><span class="si">{session}</span><span class="s2">/fmap/sub-</span><span class="si">{subject}</span><span class="s2">_</span><span class="si">{session}{run_entity}</span><span class="s2">_magnitude&quot;</span>
</span><span id="__span-6-307"><a id="__codelineno-6-307" name="__codelineno-6-307"></a>    <span class="p">)</span>
</span><span id="__span-6-308"><a id="__codelineno-6-308" name="__codelineno-6-308"></a>    <span class="n">phdiff</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span>
</span><span id="__span-6-309"><a id="__codelineno-6-309" name="__codelineno-6-309"></a>        <span class="s2">&quot;sub-</span><span class="si">{subject}</span><span class="s2">/</span><span class="si">{session}</span><span class="s2">/fmap/sub-</span><span class="si">{subject}</span><span class="s2">_</span><span class="si">{session}{run_entity}</span><span class="s2">_phasediff&quot;</span>
</span><span id="__span-6-310"><a id="__codelineno-6-310" name="__codelineno-6-310"></a>    <span class="p">)</span>
</span><span id="__span-6-311"><a id="__codelineno-6-311" name="__codelineno-6-311"></a>    <span class="n">epi</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span>
</span><span id="__span-6-312"><a id="__codelineno-6-312" name="__codelineno-6-312"></a>        <span class="s2">&quot;sub-</span><span class="si">{subject}</span><span class="s2">/</span><span class="si">{session}</span><span class="s2">/fmap/sub-</span><span class="si">{subject}</span><span class="s2">_</span><span class="si">{session}</span><span class="s2">&quot;</span>
</span><span id="__span-6-313"><a id="__codelineno-6-313" name="__codelineno-6-313"></a>        <span class="s2">&quot;_acq-</span><span class="si">{acquisition}</span><span class="s2">_dir-</span><span class="si">{dir}{run_entity}{part_entity}</span><span class="s2">_epi&quot;</span>
</span><span id="__span-6-314"><a id="__codelineno-6-314" name="__codelineno-6-314"></a>    <span class="p">)</span>
</span><span id="__span-6-315"><a id="__codelineno-6-315" name="__codelineno-6-315"></a>    <span class="n">func</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span>
</span><span id="__span-6-316"><a id="__codelineno-6-316" name="__codelineno-6-316"></a>        <span class="s2">&quot;sub-</span><span class="si">{subject}</span><span class="s2">/</span><span class="si">{session}</span><span class="s2">/func/sub-</span><span class="si">{subject}</span><span class="s2">_</span><span class="si">{session}</span><span class="s2">&quot;</span>
</span><span id="__span-6-317"><a id="__codelineno-6-317" name="__codelineno-6-317"></a>        <span class="s2">&quot;_task-</span><span class="si">{task}{acq_entity}{dir_entity}{run_entity}{part_entity}</span><span class="s2">_bold&quot;</span>
</span><span id="__span-6-318"><a id="__codelineno-6-318" name="__codelineno-6-318"></a>    <span class="p">)</span>
</span><span id="__span-6-319"><a id="__codelineno-6-319" name="__codelineno-6-319"></a>    <span class="n">sbref</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span>
</span><span id="__span-6-320"><a id="__codelineno-6-320" name="__codelineno-6-320"></a>        <span class="s2">&quot;sub-</span><span class="si">{subject}</span><span class="s2">/</span><span class="si">{session}</span><span class="s2">/func/sub-</span><span class="si">{subject}</span><span class="s2">_</span><span class="si">{session}</span><span class="s2">_task-</span><span class="si">{task}{run_entity}</span><span class="s2">_sbref&quot;</span>
</span><span id="__span-6-321"><a id="__codelineno-6-321" name="__codelineno-6-321"></a>    <span class="p">)</span>
</span><span id="__span-6-322"><a id="__codelineno-6-322" name="__codelineno-6-322"></a>
</span><span id="__span-6-323"><a id="__codelineno-6-323" name="__codelineno-6-323"></a>    <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-6-324"><a id="__codelineno-6-324" name="__codelineno-6-324"></a>        <span class="n">t1w</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="__span-6-325"><a id="__codelineno-6-325" name="__codelineno-6-325"></a>        <span class="n">t2w</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="__span-6-326"><a id="__codelineno-6-326" name="__codelineno-6-326"></a>        <span class="n">t2_flair</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="__span-6-327"><a id="__codelineno-6-327" name="__codelineno-6-327"></a>        <span class="n">dwi</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="__span-6-328"><a id="__codelineno-6-328" name="__codelineno-6-328"></a>        <span class="n">mag</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="__span-6-329"><a id="__codelineno-6-329" name="__codelineno-6-329"></a>        <span class="n">phdiff</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="__span-6-330"><a id="__codelineno-6-330" name="__codelineno-6-330"></a>        <span class="n">epi</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="__span-6-331"><a id="__codelineno-6-331" name="__codelineno-6-331"></a>        <span class="n">func</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="__span-6-332"><a id="__codelineno-6-332" name="__codelineno-6-332"></a>        <span class="n">sbref</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="__span-6-333"><a id="__codelineno-6-333" name="__codelineno-6-333"></a>    <span class="p">}</span>
</span><span id="__span-6-334"><a id="__codelineno-6-334" name="__codelineno-6-334"></a>    <span class="n">epi_mags</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-6-335"><a id="__codelineno-6-335" name="__codelineno-6-335"></a>    <span class="n">bold_mags</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-6-336"><a id="__codelineno-6-336" name="__codelineno-6-336"></a>
</span><span id="__span-6-337"><a id="__codelineno-6-337" name="__codelineno-6-337"></a>    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">seqinfo</span><span class="p">:</span>
</span><span id="__span-6-338"><a id="__codelineno-6-338" name="__codelineno-6-338"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-6-339"><a id="__codelineno-6-339" name="__codelineno-6-339"></a><span class="sd">        The namedtuple `s` contains the following fields:</span>
</span><span id="__span-6-340"><a id="__codelineno-6-340" name="__codelineno-6-340"></a>
</span><span id="__span-6-341"><a id="__codelineno-6-341" name="__codelineno-6-341"></a><span class="sd">        * total_files_till_now</span>
</span><span id="__span-6-342"><a id="__codelineno-6-342" name="__codelineno-6-342"></a><span class="sd">        * example_dcm_file</span>
</span><span id="__span-6-343"><a id="__codelineno-6-343" name="__codelineno-6-343"></a><span class="sd">        * series_id</span>
</span><span id="__span-6-344"><a id="__codelineno-6-344" name="__codelineno-6-344"></a><span class="sd">        * dcm_dir_name</span>
</span><span id="__span-6-345"><a id="__codelineno-6-345" name="__codelineno-6-345"></a><span class="sd">        * unspecified2</span>
</span><span id="__span-6-346"><a id="__codelineno-6-346" name="__codelineno-6-346"></a><span class="sd">        * unspecified3</span>
</span><span id="__span-6-347"><a id="__codelineno-6-347" name="__codelineno-6-347"></a><span class="sd">        * dim1</span>
</span><span id="__span-6-348"><a id="__codelineno-6-348" name="__codelineno-6-348"></a><span class="sd">        * dim2</span>
</span><span id="__span-6-349"><a id="__codelineno-6-349" name="__codelineno-6-349"></a><span class="sd">        * dim3</span>
</span><span id="__span-6-350"><a id="__codelineno-6-350" name="__codelineno-6-350"></a><span class="sd">        * dim4</span>
</span><span id="__span-6-351"><a id="__codelineno-6-351" name="__codelineno-6-351"></a><span class="sd">        * TR</span>
</span><span id="__span-6-352"><a id="__codelineno-6-352" name="__codelineno-6-352"></a><span class="sd">        * TE</span>
</span><span id="__span-6-353"><a id="__codelineno-6-353" name="__codelineno-6-353"></a><span class="sd">        * protocol_name</span>
</span><span id="__span-6-354"><a id="__codelineno-6-354" name="__codelineno-6-354"></a><span class="sd">        * is_motion_corrected</span>
</span><span id="__span-6-355"><a id="__codelineno-6-355" name="__codelineno-6-355"></a><span class="sd">        * is_derived</span>
</span><span id="__span-6-356"><a id="__codelineno-6-356" name="__codelineno-6-356"></a><span class="sd">        * patient_id</span>
</span><span id="__span-6-357"><a id="__codelineno-6-357" name="__codelineno-6-357"></a><span class="sd">        * study_description</span>
</span><span id="__span-6-358"><a id="__codelineno-6-358" name="__codelineno-6-358"></a><span class="sd">        * referring_physician_name</span>
</span><span id="__span-6-359"><a id="__codelineno-6-359" name="__codelineno-6-359"></a><span class="sd">        * series_description</span>
</span><span id="__span-6-360"><a id="__codelineno-6-360" name="__codelineno-6-360"></a><span class="sd">        * image_type</span>
</span><span id="__span-6-361"><a id="__codelineno-6-361" name="__codelineno-6-361"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-6-362"><a id="__codelineno-6-362" name="__codelineno-6-362"></a>
</span><span id="__span-6-363"><a id="__codelineno-6-363" name="__codelineno-6-363"></a>        <span class="c1"># Ignore derived data and reports</span>
</span><span id="__span-6-364"><a id="__codelineno-6-364" name="__codelineno-6-364"></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="__span-6-365"><a id="__codelineno-6-365" name="__codelineno-6-365"></a>            <span class="n">s</span><span class="o">.</span><span class="n">is_derived</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span>
</span><span id="__span-6-366"><a id="__codelineno-6-366" name="__codelineno-6-366"></a>            <span class="ow">or</span> <span class="n">s</span><span class="o">.</span><span class="n">is_derived</span> <span class="ow">is</span> <span class="kc">True</span>
</span><span id="__span-6-367"><a id="__codelineno-6-367" name="__codelineno-6-367"></a>            <span class="ow">or</span> <span class="n">s</span><span class="o">.</span><span class="n">dcm_dir_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">IGNORE_PROTOCOLS</span>
</span><span id="__span-6-368"><a id="__codelineno-6-368" name="__codelineno-6-368"></a>        <span class="p">):</span>
</span><span id="__span-6-369"><a id="__codelineno-6-369" name="__codelineno-6-369"></a>            <span class="k">continue</span>
</span><span id="__span-6-370"><a id="__codelineno-6-370" name="__codelineno-6-370"></a>
</span><span id="__span-6-371"><a id="__codelineno-6-371" name="__codelineno-6-371"></a>        <span class="n">thisitem</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-6-372"><a id="__codelineno-6-372" name="__codelineno-6-372"></a>            <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="p">,</span>
</span><span id="__span-6-373"><a id="__codelineno-6-373" name="__codelineno-6-373"></a>        <span class="p">}</span>
</span><span id="__span-6-374"><a id="__codelineno-6-374" name="__codelineno-6-374"></a>        <span class="n">thiskey</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-6-375"><a id="__codelineno-6-375" name="__codelineno-6-375"></a>        <span class="n">thisitem</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">bids_regex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">)})</span>
</span><span id="__span-6-376"><a id="__codelineno-6-376" name="__codelineno-6-376"></a>        <span class="n">thisitem</span><span class="p">[</span><span class="s2">&quot;run_entity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">thisitem</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;run&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-6-377"><a id="__codelineno-6-377" name="__codelineno-6-377"></a>
</span><span id="__span-6-378"><a id="__codelineno-6-378" name="__codelineno-6-378"></a>        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;anat-t1w&quot;</span><span class="p">):</span>
</span><span id="__span-6-379"><a id="__codelineno-6-379" name="__codelineno-6-379"></a>            <span class="n">thiskey</span> <span class="o">=</span> <span class="n">t1w</span>
</span><span id="__span-6-380"><a id="__codelineno-6-380" name="__codelineno-6-380"></a>            <span class="n">acquisition_present</span> <span class="o">=</span> <span class="n">thisitem</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;acq&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-6-381"><a id="__codelineno-6-381" name="__codelineno-6-381"></a>            <span class="n">thisitem</span><span class="p">[</span><span class="s2">&quot;acquisition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-6-382"><a id="__codelineno-6-382" name="__codelineno-6-382"></a>                <span class="p">(</span><span class="s2">&quot;original&quot;</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">dcm_dir_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_ND&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;undistorted&quot;</span><span class="p">)</span>
</span><span id="__span-6-383"><a id="__codelineno-6-383" name="__codelineno-6-383"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">acquisition_present</span>
</span><span id="__span-6-384"><a id="__codelineno-6-384" name="__codelineno-6-384"></a>                <span class="k">else</span> <span class="n">acquisition_present</span>
</span><span id="__span-6-385"><a id="__codelineno-6-385" name="__codelineno-6-385"></a>            <span class="p">)</span>
</span><span id="__span-6-386"><a id="__codelineno-6-386" name="__codelineno-6-386"></a>        <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;anat-t2w&quot;</span><span class="p">):</span>
</span><span id="__span-6-387"><a id="__codelineno-6-387" name="__codelineno-6-387"></a>            <span class="n">thiskey</span> <span class="o">=</span> <span class="n">t2w</span>
</span><span id="__span-6-388"><a id="__codelineno-6-388" name="__codelineno-6-388"></a>        <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;anat-flair&quot;</span><span class="p">):</span>
</span><span id="__span-6-389"><a id="__codelineno-6-389" name="__codelineno-6-389"></a>            <span class="n">thiskey</span> <span class="o">=</span> <span class="n">t2_flair</span>
</span><span id="__span-6-390"><a id="__codelineno-6-390" name="__codelineno-6-390"></a>        <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;dwi-dwi&quot;</span><span class="p">):</span>
</span><span id="__span-6-391"><a id="__codelineno-6-391" name="__codelineno-6-391"></a>            <span class="n">thiskey</span> <span class="o">=</span> <span class="n">dwi</span>
</span><span id="__span-6-392"><a id="__codelineno-6-392" name="__codelineno-6-392"></a>        <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;fmap-phasediff&quot;</span><span class="p">):</span>
</span><span id="__span-6-393"><a id="__codelineno-6-393" name="__codelineno-6-393"></a>            <span class="n">thiskey</span> <span class="o">=</span> <span class="n">phdiff</span> <span class="k">if</span> <span class="s2">&quot;P&quot;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">image_type</span> <span class="k">else</span> <span class="n">mag</span>
</span><span id="__span-6-394"><a id="__codelineno-6-394" name="__codelineno-6-394"></a>        <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;fmap-epi&quot;</span><span class="p">):</span>
</span><span id="__span-6-395"><a id="__codelineno-6-395" name="__codelineno-6-395"></a>            <span class="n">thiskey</span> <span class="o">=</span> <span class="n">epi</span>
</span><span id="__span-6-396"><a id="__codelineno-6-396" name="__codelineno-6-396"></a>            <span class="n">thisitem</span><span class="p">[</span><span class="s2">&quot;part_entity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-6-397"><a id="__codelineno-6-397" name="__codelineno-6-397"></a>            <span class="n">thisitem</span><span class="p">[</span><span class="s2">&quot;acquisition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-6-398"><a id="__codelineno-6-398" name="__codelineno-6-398"></a>                <span class="s2">&quot;b0&quot;</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">sequence_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;ep_b0&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;bold&quot;</span>
</span><span id="__span-6-399"><a id="__codelineno-6-399" name="__codelineno-6-399"></a>            <span class="p">)</span>
</span><span id="__span-6-400"><a id="__codelineno-6-400" name="__codelineno-6-400"></a>
</span><span id="__span-6-401"><a id="__codelineno-6-401" name="__codelineno-6-401"></a>            <span class="c1"># Check whether phase was written out:</span>
</span><span id="__span-6-402"><a id="__codelineno-6-402" name="__codelineno-6-402"></a>            <span class="c1"># 1. A magnitude needs to exist immediately before in the dicom info</span>
</span><span id="__span-6-403"><a id="__codelineno-6-403" name="__codelineno-6-403"></a>            <span class="c1"># 2. Magnitude and phase must have the same number of volumes</span>
</span><span id="__span-6-404"><a id="__codelineno-6-404" name="__codelineno-6-404"></a>            <span class="n">series_id_idx</span><span class="p">,</span> <span class="n">series_id_name</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-6-405"><a id="__codelineno-6-405" name="__codelineno-6-405"></a>            <span class="n">prev_series_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">series_id_idx</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">series_id_name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">series_files</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-6-406"><a id="__codelineno-6-406" name="__codelineno-6-406"></a>            <span class="k">if</span> <span class="n">prev_series_id</span> <span class="ow">in</span> <span class="n">epi_mags</span><span class="p">:</span>
</span><span id="__span-6-407"><a id="__codelineno-6-407" name="__codelineno-6-407"></a>                <span class="n">thisitem</span><span class="p">[</span><span class="s2">&quot;part_entity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;_part-phase&quot;</span>
</span><span id="__span-6-408"><a id="__codelineno-6-408" name="__codelineno-6-408"></a>                <span class="n">info</span><span class="p">[</span><span class="n">thiskey</span><span class="p">][</span><span class="n">epi_mags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">prev_series_id</span><span class="p">)][</span><span class="s2">&quot;part_entity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;_part-mag&quot;</span>
</span><span id="__span-6-409"><a id="__codelineno-6-409" name="__codelineno-6-409"></a>
</span><span id="__span-6-410"><a id="__codelineno-6-410" name="__codelineno-6-410"></a>            <span class="n">epi_mags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">series_files</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-6-411"><a id="__codelineno-6-411" name="__codelineno-6-411"></a>
</span><span id="__span-6-412"><a id="__codelineno-6-412" name="__codelineno-6-412"></a>        <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;func-bold&quot;</span><span class="p">):</span>
</span><span id="__span-6-413"><a id="__codelineno-6-413" name="__codelineno-6-413"></a>            <span class="c1"># Likely an error</span>
</span><span id="__span-6-414"><a id="__codelineno-6-414" name="__codelineno-6-414"></a>            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">series_files</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="__span-6-415"><a id="__codelineno-6-415" name="__codelineno-6-415"></a>                <span class="n">warn</span><span class="p">(</span>
</span><span id="__span-6-416"><a id="__codelineno-6-416" name="__codelineno-6-416"></a>                    <span class="sa">f</span><span class="s2">&quot;Dropping exceedingly short BOLD file with </span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">series_files</span><span class="si">}</span><span class="s2"> time points.&quot;</span>
</span><span id="__span-6-417"><a id="__codelineno-6-417" name="__codelineno-6-417"></a>                <span class="p">)</span>
</span><span id="__span-6-418"><a id="__codelineno-6-418" name="__codelineno-6-418"></a>                <span class="k">continue</span>
</span><span id="__span-6-419"><a id="__codelineno-6-419" name="__codelineno-6-419"></a>
</span><span id="__span-6-420"><a id="__codelineno-6-420" name="__codelineno-6-420"></a>            <span class="n">thiskey</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="__span-6-421"><a id="__codelineno-6-421" name="__codelineno-6-421"></a>
</span><span id="__span-6-422"><a id="__codelineno-6-422" name="__codelineno-6-422"></a>            <span class="n">thisitem</span><span class="p">[</span><span class="s2">&quot;part_entity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-6-423"><a id="__codelineno-6-423" name="__codelineno-6-423"></a>            <span class="c1"># Some functional runs may come with acq</span>
</span><span id="__span-6-424"><a id="__codelineno-6-424" name="__codelineno-6-424"></a>            <span class="n">func_acq</span> <span class="o">=</span> <span class="n">thisitem</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;acq&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-6-425"><a id="__codelineno-6-425" name="__codelineno-6-425"></a>            <span class="n">thisitem</span><span class="p">[</span><span class="s2">&quot;acq_entity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">func_acq</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;_acq-</span><span class="si">{</span><span class="n">func_acq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-6-426"><a id="__codelineno-6-426" name="__codelineno-6-426"></a>
</span><span id="__span-6-427"><a id="__codelineno-6-427" name="__codelineno-6-427"></a>            <span class="c1"># Some functional runs may come with dir</span>
</span><span id="__span-6-428"><a id="__codelineno-6-428" name="__codelineno-6-428"></a>            <span class="n">func_dir</span> <span class="o">=</span> <span class="n">thisitem</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;dir&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-6-429"><a id="__codelineno-6-429" name="__codelineno-6-429"></a>            <span class="n">thisitem</span><span class="p">[</span><span class="s2">&quot;dir_entity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">func_dir</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;_dir-</span><span class="si">{</span><span class="n">func_dir</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-6-430"><a id="__codelineno-6-430" name="__codelineno-6-430"></a>
</span><span id="__span-6-431"><a id="__codelineno-6-431" name="__codelineno-6-431"></a>            <span class="c1"># Check whether phase was written out:</span>
</span><span id="__span-6-432"><a id="__codelineno-6-432" name="__codelineno-6-432"></a>            <span class="c1"># 1. A magnitude needs to exist immediately before in the dicom info</span>
</span><span id="__span-6-433"><a id="__codelineno-6-433" name="__codelineno-6-433"></a>            <span class="c1"># 2. Magnitude and phase must have the same number of volumes</span>
</span><span id="__span-6-434"><a id="__codelineno-6-434" name="__codelineno-6-434"></a>            <span class="n">series_id_idx</span><span class="p">,</span> <span class="n">series_id_name</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-6-435"><a id="__codelineno-6-435" name="__codelineno-6-435"></a>            <span class="n">prev_series_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">series_id_idx</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">series_id_name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">series_files</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-6-436"><a id="__codelineno-6-436" name="__codelineno-6-436"></a>            <span class="k">if</span> <span class="n">prev_series_id</span> <span class="ow">in</span> <span class="n">bold_mags</span><span class="p">:</span>
</span><span id="__span-6-437"><a id="__codelineno-6-437" name="__codelineno-6-437"></a>                <span class="n">thisitem</span><span class="p">[</span><span class="s2">&quot;part_entity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;_part-phase&quot;</span>
</span><span id="__span-6-438"><a id="__codelineno-6-438" name="__codelineno-6-438"></a>                <span class="n">info</span><span class="p">[</span><span class="n">thiskey</span><span class="p">][</span><span class="n">bold_mags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">prev_series_id</span><span class="p">)][</span><span class="s2">&quot;part_entity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;_part-mag&quot;</span>
</span><span id="__span-6-439"><a id="__codelineno-6-439" name="__codelineno-6-439"></a>
</span><span id="__span-6-440"><a id="__codelineno-6-440" name="__codelineno-6-440"></a>            <span class="n">bold_mags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">series_files</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-6-441"><a id="__codelineno-6-441" name="__codelineno-6-441"></a>
</span><span id="__span-6-442"><a id="__codelineno-6-442" name="__codelineno-6-442"></a>        <span class="k">if</span> <span class="n">thiskey</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-6-443"><a id="__codelineno-6-443" name="__codelineno-6-443"></a>            <span class="n">info</span><span class="p">[</span><span class="n">thiskey</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisitem</span><span class="p">)</span>
</span><span id="__span-6-444"><a id="__codelineno-6-444" name="__codelineno-6-444"></a>
</span><span id="__span-6-445"><a id="__codelineno-6-445" name="__codelineno-6-445"></a>    <span class="k">for</span> <span class="n">mod</span><span class="p">,</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-6-446"><a id="__codelineno-6-446" name="__codelineno-6-446"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-6-447"><a id="__codelineno-6-447" name="__codelineno-6-447"></a>            <span class="k">continue</span>
</span><span id="__span-6-448"><a id="__codelineno-6-448" name="__codelineno-6-448"></a>
</span><span id="__span-6-449"><a id="__codelineno-6-449" name="__codelineno-6-449"></a>        <span class="n">info</span><span class="p">[</span><span class="n">mod</span><span class="p">]</span> <span class="o">=</span> <span class="n">_assign_run_on_repeat</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</span><span id="__span-6-450"><a id="__codelineno-6-450" name="__codelineno-6-450"></a>
</span><span id="__span-6-451"><a id="__codelineno-6-451" name="__codelineno-6-451"></a>    <span class="k">return</span> <span class="n">info</span>
</span><span id="__span-6-452"><a id="__codelineno-6-452" name="__codelineno-6-452"></a>
</span><span id="__span-6-453"><a id="__codelineno-6-453" name="__codelineno-6-453"></a>
</span><span id="__span-6-454"><a id="__codelineno-6-454" name="__codelineno-6-454"></a><span class="k">def</span> <span class="nf">_assign_run_on_repeat</span><span class="p">(</span><span class="n">modality_items</span><span class="p">):</span>
</span><span id="__span-6-455"><a id="__codelineno-6-455" name="__codelineno-6-455"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-6-456"><a id="__codelineno-6-456" name="__codelineno-6-456"></a><span class="sd">    Assign run IDs for repeated inputs for a given modality.</span>
</span><span id="__span-6-457"><a id="__codelineno-6-457" name="__codelineno-6-457"></a>
</span><span id="__span-6-458"><a id="__codelineno-6-458" name="__codelineno-6-458"></a><span class="sd">    Examples</span>
</span><span id="__span-6-459"><a id="__codelineno-6-459" name="__codelineno-6-459"></a><span class="sd">    --------</span>
</span><span id="__span-6-460"><a id="__codelineno-6-460" name="__codelineno-6-460"></a><span class="sd">    &gt;&gt;&gt; _assign_run_on_repeat([</span>
</span><span id="__span-6-461"><a id="__codelineno-6-461" name="__codelineno-6-461"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard1&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;PA&quot;},</span>
</span><span id="__span-6-462"><a id="__codelineno-6-462" name="__codelineno-6-462"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard2&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;AP&quot;},</span>
</span><span id="__span-6-463"><a id="__codelineno-6-463" name="__codelineno-6-463"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard3&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;PA&quot;},</span>
</span><span id="__span-6-464"><a id="__codelineno-6-464" name="__codelineno-6-464"></a><span class="sd">    ... ])  # doctest: +NORMALIZE_WHITESPACE</span>
</span><span id="__span-6-465"><a id="__codelineno-6-465" name="__codelineno-6-465"></a><span class="sd">    [{&#39;item&#39;: &#39;discard1&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;PA&#39;, &#39;run_entity&#39;: &#39;_run-1&#39;},</span>
</span><span id="__span-6-466"><a id="__codelineno-6-466" name="__codelineno-6-466"></a><span class="sd">     {&#39;item&#39;: &#39;discard2&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;AP&#39;},</span>
</span><span id="__span-6-467"><a id="__codelineno-6-467" name="__codelineno-6-467"></a><span class="sd">     {&#39;item&#39;: &#39;discard3&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;PA&#39;, &#39;run_entity&#39;: &#39;_run-2&#39;}]</span>
</span><span id="__span-6-468"><a id="__codelineno-6-468" name="__codelineno-6-468"></a>
</span><span id="__span-6-469"><a id="__codelineno-6-469" name="__codelineno-6-469"></a><span class="sd">    &gt;&gt;&gt; _assign_run_on_repeat([</span>
</span><span id="__span-6-470"><a id="__codelineno-6-470" name="__codelineno-6-470"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard1&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;PA&quot;},</span>
</span><span id="__span-6-471"><a id="__codelineno-6-471" name="__codelineno-6-471"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard2&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;AP&quot;},</span>
</span><span id="__span-6-472"><a id="__codelineno-6-472" name="__codelineno-6-472"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard3&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;PA&quot;},</span>
</span><span id="__span-6-473"><a id="__codelineno-6-473" name="__codelineno-6-473"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard4&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;AP&quot;},</span>
</span><span id="__span-6-474"><a id="__codelineno-6-474" name="__codelineno-6-474"></a><span class="sd">    ... ])  # doctest: +NORMALIZE_WHITESPACE</span>
</span><span id="__span-6-475"><a id="__codelineno-6-475" name="__codelineno-6-475"></a><span class="sd">    [{&#39;item&#39;: &#39;discard1&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;PA&#39;, &#39;run_entity&#39;: &#39;_run-1&#39;},</span>
</span><span id="__span-6-476"><a id="__codelineno-6-476" name="__codelineno-6-476"></a><span class="sd">     {&#39;item&#39;: &#39;discard2&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;AP&#39;, &#39;run_entity&#39;: &#39;_run-1&#39;},</span>
</span><span id="__span-6-477"><a id="__codelineno-6-477" name="__codelineno-6-477"></a><span class="sd">     {&#39;item&#39;: &#39;discard3&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;PA&#39;, &#39;run_entity&#39;: &#39;_run-2&#39;},</span>
</span><span id="__span-6-478"><a id="__codelineno-6-478" name="__codelineno-6-478"></a><span class="sd">     {&#39;item&#39;: &#39;discard4&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;AP&#39;, &#39;run_entity&#39;: &#39;_run-2&#39;}]</span>
</span><span id="__span-6-479"><a id="__codelineno-6-479" name="__codelineno-6-479"></a>
</span><span id="__span-6-480"><a id="__codelineno-6-480" name="__codelineno-6-480"></a><span class="sd">    &gt;&gt;&gt; _assign_run_on_repeat([</span>
</span><span id="__span-6-481"><a id="__codelineno-6-481" name="__codelineno-6-481"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard1&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;PA&quot;, &quot;run&quot;: &quot;1&quot;},</span>
</span><span id="__span-6-482"><a id="__codelineno-6-482" name="__codelineno-6-482"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard2&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;AP&quot;},</span>
</span><span id="__span-6-483"><a id="__codelineno-6-483" name="__codelineno-6-483"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard3&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;PA&quot;, &quot;run&quot;: &quot;2&quot;},</span>
</span><span id="__span-6-484"><a id="__codelineno-6-484" name="__codelineno-6-484"></a><span class="sd">    ... ])  # doctest: +NORMALIZE_WHITESPACE</span>
</span><span id="__span-6-485"><a id="__codelineno-6-485" name="__codelineno-6-485"></a><span class="sd">    [{&#39;item&#39;: &#39;discard1&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;PA&#39;, &#39;run&#39;: &#39;1&#39;},</span>
</span><span id="__span-6-486"><a id="__codelineno-6-486" name="__codelineno-6-486"></a><span class="sd">     {&#39;item&#39;: &#39;discard2&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;AP&#39;},</span>
</span><span id="__span-6-487"><a id="__codelineno-6-487" name="__codelineno-6-487"></a><span class="sd">     {&#39;item&#39;: &#39;discard3&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;PA&#39;, &#39;run&#39;: &#39;2&#39;}]</span>
</span><span id="__span-6-488"><a id="__codelineno-6-488" name="__codelineno-6-488"></a>
</span><span id="__span-6-489"><a id="__codelineno-6-489" name="__codelineno-6-489"></a><span class="sd">    &gt;&gt;&gt; _assign_run_on_repeat([</span>
</span><span id="__span-6-490"><a id="__codelineno-6-490" name="__codelineno-6-490"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard1&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;PA&quot;, &quot;run_entity&quot;: &quot;_run-1&quot;},</span>
</span><span id="__span-6-491"><a id="__codelineno-6-491" name="__codelineno-6-491"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard2&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;AP&quot;},</span>
</span><span id="__span-6-492"><a id="__codelineno-6-492" name="__codelineno-6-492"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard3&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;PA&quot;, &quot;run_entity&quot;: &quot;_run-2&quot;},</span>
</span><span id="__span-6-493"><a id="__codelineno-6-493" name="__codelineno-6-493"></a><span class="sd">    ... ])  # doctest: +NORMALIZE_WHITESPACE</span>
</span><span id="__span-6-494"><a id="__codelineno-6-494" name="__codelineno-6-494"></a><span class="sd">    [{&#39;item&#39;: &#39;discard1&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;PA&#39;, &#39;run_entity&#39;: &#39;_run-1&#39;},</span>
</span><span id="__span-6-495"><a id="__codelineno-6-495" name="__codelineno-6-495"></a><span class="sd">     {&#39;item&#39;: &#39;discard2&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;AP&#39;},</span>
</span><span id="__span-6-496"><a id="__codelineno-6-496" name="__codelineno-6-496"></a><span class="sd">     {&#39;item&#39;: &#39;discard3&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;PA&#39;, &#39;run_entity&#39;: &#39;_run-2&#39;}]</span>
</span><span id="__span-6-497"><a id="__codelineno-6-497" name="__codelineno-6-497"></a>
</span><span id="__span-6-498"><a id="__codelineno-6-498" name="__codelineno-6-498"></a><span class="sd">    &gt;&gt;&gt; _assign_run_on_repeat([</span>
</span><span id="__span-6-499"><a id="__codelineno-6-499" name="__codelineno-6-499"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard1&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;PA&quot;, &quot;part_entity&quot;: &quot;_part-mag&quot;},</span>
</span><span id="__span-6-500"><a id="__codelineno-6-500" name="__codelineno-6-500"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard2&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;PA&quot;, &quot;part_entity&quot;: &quot;_part-phase&quot;},</span>
</span><span id="__span-6-501"><a id="__codelineno-6-501" name="__codelineno-6-501"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard3&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;AP&quot;, &quot;part_entity&quot;: &quot;_part-mag&quot;},</span>
</span><span id="__span-6-502"><a id="__codelineno-6-502" name="__codelineno-6-502"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard4&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;AP&quot;, &quot;part_entity&quot;: &quot;_part-phase&quot;},</span>
</span><span id="__span-6-503"><a id="__codelineno-6-503" name="__codelineno-6-503"></a><span class="sd">    ... ])  # doctest: +NORMALIZE_WHITESPACE</span>
</span><span id="__span-6-504"><a id="__codelineno-6-504" name="__codelineno-6-504"></a><span class="sd">    [{&#39;item&#39;: &#39;discard1&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;PA&#39;, &#39;part_entity&#39;: &#39;_part-mag&#39;},</span>
</span><span id="__span-6-505"><a id="__codelineno-6-505" name="__codelineno-6-505"></a><span class="sd">     {&#39;item&#39;: &#39;discard2&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;PA&#39;, &#39;part_entity&#39;: &#39;_part-phase&#39;},</span>
</span><span id="__span-6-506"><a id="__codelineno-6-506" name="__codelineno-6-506"></a><span class="sd">     {&#39;item&#39;: &#39;discard3&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;AP&#39;, &#39;part_entity&#39;: &#39;_part-mag&#39;},</span>
</span><span id="__span-6-507"><a id="__codelineno-6-507" name="__codelineno-6-507"></a><span class="sd">     {&#39;item&#39;: &#39;discard4&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;AP&#39;, &#39;part_entity&#39;: &#39;_part-phase&#39;}]</span>
</span><span id="__span-6-508"><a id="__codelineno-6-508" name="__codelineno-6-508"></a>
</span><span id="__span-6-509"><a id="__codelineno-6-509" name="__codelineno-6-509"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-6-510"><a id="__codelineno-6-510" name="__codelineno-6-510"></a>    <span class="n">modality_items</span> <span class="o">=</span> <span class="n">modality_items</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-6-511"><a id="__codelineno-6-511" name="__codelineno-6-511"></a>
</span><span id="__span-6-512"><a id="__codelineno-6-512" name="__codelineno-6-512"></a>    <span class="n">str_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-6-513"><a id="__codelineno-6-513" name="__codelineno-6-513"></a>        <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;item&quot;</span><span class="p">])</span>
</span><span id="__span-6-514"><a id="__codelineno-6-514" name="__codelineno-6-514"></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">modality_items</span>
</span><span id="__span-6-515"><a id="__codelineno-6-515" name="__codelineno-6-515"></a>    <span class="p">]</span>
</span><span id="__span-6-516"><a id="__codelineno-6-516" name="__codelineno-6-516"></a>    <span class="n">strcount</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">str_patterns</span><span class="p">)</span>
</span><span id="__span-6-517"><a id="__codelineno-6-517" name="__codelineno-6-517"></a>
</span><span id="__span-6-518"><a id="__codelineno-6-518" name="__codelineno-6-518"></a>    <span class="k">for</span> <span class="n">string</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">strcount</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-6-519"><a id="__codelineno-6-519" name="__codelineno-6-519"></a>        <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-6-520"><a id="__codelineno-6-520" name="__codelineno-6-520"></a>            <span class="k">continue</span>
</span><span id="__span-6-521"><a id="__codelineno-6-521" name="__codelineno-6-521"></a>
</span><span id="__span-6-522"><a id="__codelineno-6-522" name="__codelineno-6-522"></a>        <span class="n">runid</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-6-523"><a id="__codelineno-6-523" name="__codelineno-6-523"></a>
</span><span id="__span-6-524"><a id="__codelineno-6-524" name="__codelineno-6-524"></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item_string</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">str_patterns</span><span class="p">):</span>
</span><span id="__span-6-525"><a id="__codelineno-6-525" name="__codelineno-6-525"></a>            <span class="k">if</span> <span class="n">string</span> <span class="o">==</span> <span class="n">item_string</span><span class="p">:</span>
</span><span id="__span-6-526"><a id="__codelineno-6-526" name="__codelineno-6-526"></a>                <span class="n">modality_items</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="__span-6-527"><a id="__codelineno-6-527" name="__codelineno-6-527"></a>                    <span class="p">{</span>
</span><span id="__span-6-528"><a id="__codelineno-6-528" name="__codelineno-6-528"></a>                        <span class="s2">&quot;run_entity&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;_run-</span><span class="si">{</span><span class="n">runid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-6-529"><a id="__codelineno-6-529" name="__codelineno-6-529"></a>                    <span class="p">}</span>
</span><span id="__span-6-530"><a id="__codelineno-6-530" name="__codelineno-6-530"></a>                <span class="p">)</span>
</span><span id="__span-6-531"><a id="__codelineno-6-531" name="__codelineno-6-531"></a>                <span class="n">runid</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-6-532"><a id="__codelineno-6-532" name="__codelineno-6-532"></a>
</span><span id="__span-6-533"><a id="__codelineno-6-533" name="__codelineno-6-533"></a>    <span class="k">return</span> <span class="n">modality_items</span>
</span></code></pre></div></td></tr></table></div>
</details>
<div class="admonition warning">
<p class="admonition-title">During piloting, we changed a number of settings</p>
<p>For example, the first four sessions did not follow <em>Reproin</em> conventions and filenames
varied substantially.
Please note the <code>protocols2fix</code> variable in our heuristic file, where the compatibility is implemented.</p>
</div>
<ul class="task-list">
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Run <em>HeuDiConv</em> with our heuristic file <code>&lt;path&gt;/code/heudiconv/heuristic_reproin.py</code>:</p>
<div class="language-bash highlight"><span class="filename">Executing HeuDiConv</span><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>heudiconv<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;001&quot;</span><span class="w"> </span>-ss<span class="w"> </span><span class="s2">&quot;pilot001&quot;</span><span class="w"> </span>-b<span class="w"> </span>-l<span class="w"> </span>.<span class="w"> </span>-o<span class="w"> </span>/data/datasets/hcph/<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">          </span>-f<span class="w"> </span>&lt;sops_clone_path&gt;/code/heudiconv/heuristic_reproin.py<span class="w"> </span>-b<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">          </span>--files<span class="w"> </span>/data/datasets/hcph-pilot-sourcedata/<span class="se">\</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">                  </span>sub-01/<span class="se">\</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">                  </span>ses-18950702/
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Session number MUST be updated manually</p>
</div>
<details class="important">
<summary>Example of the dataset organization</summary>
<p>Piloting sessions 15 and 16 look like this:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>├── ses-pilot015
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>│   ├── anat
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>│   │   ├── sub-001_ses-pilot015_acq-original_T1w.json
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>│   │   ├── sub-001_ses-pilot015_acq-original_T1w.nii.gz
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>│   │   ├── sub-001_ses-pilot015_acq-undistorted_T1w.json
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>│   │   ├── sub-001_ses-pilot015_acq-undistorted_T1w.nii.gz
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>│   │   ├── sub-001_ses-pilot015_T2w.json
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>│   │   └── sub-001_ses-pilot015_T2w.nii.gz
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>│   ├── dwi
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>│   │   ├── sub-001_ses-pilot015_acq-highres_dir-LR_dwi.bval
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>│   │   ├── sub-001_ses-pilot015_acq-highres_dir-LR_dwi.bvec
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>│   │   ├── sub-001_ses-pilot015_acq-highres_dir-LR_dwi.json
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>│   │   └── sub-001_ses-pilot015_acq-highres_dir-LR_dwi.nii.gz
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>│   ├── fmap
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>│   │   ├── sub-001_ses-pilot015_acq-b0_dir-RL_epi.json
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>│   │   ├── sub-001_ses-pilot015_acq-b0_dir-RL_epi.nii.gz
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>│   │   ├── sub-001_ses-pilot015_acq-bold_dir-RL_part-mag_epi.json
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>│   │   ├── sub-001_ses-pilot015_acq-bold_dir-RL_part-mag_epi.nii.gz
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>│   │   ├── sub-001_ses-pilot015_acq-bold_dir-RL_part-phase_epi.json
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>│   │   ├── sub-001_ses-pilot015_acq-bold_dir-RL_part-phase_epi.nii.gz
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>│   │   ├── sub-001_ses-pilot015_magnitude1.json
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>│   │   ├── sub-001_ses-pilot015_magnitude1.nii.gz
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>│   │   ├── sub-001_ses-pilot015_magnitude2.json
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>│   │   ├── sub-001_ses-pilot015_magnitude2.nii.gz
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>│   │   ├── sub-001_ses-pilot015_phasediff.json
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>│   │   └── sub-001_ses-pilot015_phasediff.nii.gz
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>│   ├── func
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-1_part-mag_bold.json
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-1_part-mag_bold.nii.gz
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-1_part-phase_bold.json
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-1_part-phase_bold.nii.gz
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-2_part-mag_bold.json
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-2_part-mag_bold.nii.gz
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-2_part-phase_bold.json
</span><span id="__span-8-35"><a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-2_part-phase_bold.nii.gz
</span><span id="__span-8-36"><a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-3_part-mag_bold.json
</span><span id="__span-8-37"><a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-3_part-mag_bold.nii.gz
</span><span id="__span-8-38"><a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-3_part-phase_bold.json
</span><span id="__span-8-39"><a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-3_part-phase_bold.nii.gz
</span><span id="__span-8-40"><a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-4_part-mag_bold.json
</span><span id="__span-8-41"><a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-4_part-mag_bold.nii.gz
</span><span id="__span-8-42"><a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-4_part-phase_bold.json
</span><span id="__span-8-43"><a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-4_part-phase_bold.nii.gz
</span><span id="__span-8-44"><a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a>│   │   ├── sub-001_ses-pilot015_task-bht_part-mag_events.tsv
</span><span id="__span-8-45"><a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a>│   │   ├── sub-001_ses-pilot015_task-bht_part-phase_events.tsv
</span><span id="__span-8-46"><a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-1_part-mag_bold.json
</span><span id="__span-8-47"><a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-1_part-mag_bold.nii.gz
</span><span id="__span-8-48"><a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-1_part-phase_bold.json
</span><span id="__span-8-49"><a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-1_part-phase_bold.nii.gz
</span><span id="__span-8-50"><a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-2_part-mag_bold.json
</span><span id="__span-8-51"><a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-2_part-mag_bold.nii.gz
</span><span id="__span-8-52"><a id="__codelineno-8-52" name="__codelineno-8-52" href="#__codelineno-8-52"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-2_part-phase_bold.json
</span><span id="__span-8-53"><a id="__codelineno-8-53" name="__codelineno-8-53" href="#__codelineno-8-53"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-2_part-phase_bold.nii.gz
</span><span id="__span-8-54"><a id="__codelineno-8-54" name="__codelineno-8-54" href="#__codelineno-8-54"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-3_part-mag_bold.json
</span><span id="__span-8-55"><a id="__codelineno-8-55" name="__codelineno-8-55" href="#__codelineno-8-55"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-3_part-mag_bold.nii.gz
</span><span id="__span-8-56"><a id="__codelineno-8-56" name="__codelineno-8-56" href="#__codelineno-8-56"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-3_part-phase_bold.json
</span><span id="__span-8-57"><a id="__codelineno-8-57" name="__codelineno-8-57" href="#__codelineno-8-57"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-3_part-phase_bold.nii.gz
</span><span id="__span-8-58"><a id="__codelineno-8-58" name="__codelineno-8-58" href="#__codelineno-8-58"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-4_part-mag_bold.json
</span><span id="__span-8-59"><a id="__codelineno-8-59" name="__codelineno-8-59" href="#__codelineno-8-59"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-4_part-mag_bold.nii.gz
</span><span id="__span-8-60"><a id="__codelineno-8-60" name="__codelineno-8-60" href="#__codelineno-8-60"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-4_part-phase_bold.json
</span><span id="__span-8-61"><a id="__codelineno-8-61" name="__codelineno-8-61" href="#__codelineno-8-61"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-4_part-phase_bold.nii.gz
</span><span id="__span-8-62"><a id="__codelineno-8-62" name="__codelineno-8-62" href="#__codelineno-8-62"></a>│   │   ├── sub-001_ses-pilot015_task-qct_part-mag_events.tsv
</span><span id="__span-8-63"><a id="__codelineno-8-63" name="__codelineno-8-63" href="#__codelineno-8-63"></a>│   │   ├── sub-001_ses-pilot015_task-qct_part-phase_events.tsv
</span><span id="__span-8-64"><a id="__codelineno-8-64" name="__codelineno-8-64" href="#__codelineno-8-64"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-1_part-mag_bold.json
</span><span id="__span-8-65"><a id="__codelineno-8-65" name="__codelineno-8-65" href="#__codelineno-8-65"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-1_part-mag_bold.nii.gz
</span><span id="__span-8-66"><a id="__codelineno-8-66" name="__codelineno-8-66" href="#__codelineno-8-66"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-1_part-phase_bold.json
</span><span id="__span-8-67"><a id="__codelineno-8-67" name="__codelineno-8-67" href="#__codelineno-8-67"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-1_part-phase_bold.nii.gz
</span><span id="__span-8-68"><a id="__codelineno-8-68" name="__codelineno-8-68" href="#__codelineno-8-68"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-2_part-mag_bold.json
</span><span id="__span-8-69"><a id="__codelineno-8-69" name="__codelineno-8-69" href="#__codelineno-8-69"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-2_part-mag_bold.nii.gz
</span><span id="__span-8-70"><a id="__codelineno-8-70" name="__codelineno-8-70" href="#__codelineno-8-70"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-2_part-phase_bold.json
</span><span id="__span-8-71"><a id="__codelineno-8-71" name="__codelineno-8-71" href="#__codelineno-8-71"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-2_part-phase_bold.nii.gz
</span><span id="__span-8-72"><a id="__codelineno-8-72" name="__codelineno-8-72" href="#__codelineno-8-72"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-3_part-mag_bold.json
</span><span id="__span-8-73"><a id="__codelineno-8-73" name="__codelineno-8-73" href="#__codelineno-8-73"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-3_part-mag_bold.nii.gz
</span><span id="__span-8-74"><a id="__codelineno-8-74" name="__codelineno-8-74" href="#__codelineno-8-74"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-3_part-phase_bold.json
</span><span id="__span-8-75"><a id="__codelineno-8-75" name="__codelineno-8-75" href="#__codelineno-8-75"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-3_part-phase_bold.nii.gz
</span><span id="__span-8-76"><a id="__codelineno-8-76" name="__codelineno-8-76" href="#__codelineno-8-76"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-4_part-mag_bold.json
</span><span id="__span-8-77"><a id="__codelineno-8-77" name="__codelineno-8-77" href="#__codelineno-8-77"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-4_part-mag_bold.nii.gz
</span><span id="__span-8-78"><a id="__codelineno-8-78" name="__codelineno-8-78" href="#__codelineno-8-78"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-4_part-phase_bold.json
</span><span id="__span-8-79"><a id="__codelineno-8-79" name="__codelineno-8-79" href="#__codelineno-8-79"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-4_part-phase_bold.nii.gz
</span><span id="__span-8-80"><a id="__codelineno-8-80" name="__codelineno-8-80" href="#__codelineno-8-80"></a>│   │   ├── sub-001_ses-pilot015_task-rest_part-mag_events.tsv
</span><span id="__span-8-81"><a id="__codelineno-8-81" name="__codelineno-8-81" href="#__codelineno-8-81"></a>│   │   └── sub-001_ses-pilot015_task-rest_part-phase_events.tsv
</span><span id="__span-8-82"><a id="__codelineno-8-82" name="__codelineno-8-82" href="#__codelineno-8-82"></a>│   └── sub-001_ses-pilot015_scans.tsv
</span><span id="__span-8-83"><a id="__codelineno-8-83" name="__codelineno-8-83" href="#__codelineno-8-83"></a>└── ses-pilot016
</span><span id="__span-8-84"><a id="__codelineno-8-84" name="__codelineno-8-84" href="#__codelineno-8-84"></a>    ├── anat
</span><span id="__span-8-85"><a id="__codelineno-8-85" name="__codelineno-8-85" href="#__codelineno-8-85"></a>    │   ├── sub-001_ses-pilot016_acq-original_T1w.json
</span><span id="__span-8-86"><a id="__codelineno-8-86" name="__codelineno-8-86" href="#__codelineno-8-86"></a>    │   ├── sub-001_ses-pilot016_acq-original_T1w.nii.gz
</span><span id="__span-8-87"><a id="__codelineno-8-87" name="__codelineno-8-87" href="#__codelineno-8-87"></a>    │   ├── sub-001_ses-pilot016_acq-undistorted_T1w.json
</span><span id="__span-8-88"><a id="__codelineno-8-88" name="__codelineno-8-88" href="#__codelineno-8-88"></a>    │   ├── sub-001_ses-pilot016_acq-undistorted_T1w.nii.gz
</span><span id="__span-8-89"><a id="__codelineno-8-89" name="__codelineno-8-89" href="#__codelineno-8-89"></a>    │   ├── sub-001_ses-pilot016_T2w.json
</span><span id="__span-8-90"><a id="__codelineno-8-90" name="__codelineno-8-90" href="#__codelineno-8-90"></a>    │   └── sub-001_ses-pilot016_T2w.nii.gz
</span><span id="__span-8-91"><a id="__codelineno-8-91" name="__codelineno-8-91" href="#__codelineno-8-91"></a>    ├── dwi
</span><span id="__span-8-92"><a id="__codelineno-8-92" name="__codelineno-8-92" href="#__codelineno-8-92"></a>    │   ├── sub-001_ses-pilot016_acq-highres_dir-RL_dwi.bval
</span><span id="__span-8-93"><a id="__codelineno-8-93" name="__codelineno-8-93" href="#__codelineno-8-93"></a>    │   ├── sub-001_ses-pilot016_acq-highres_dir-RL_dwi.bvec
</span><span id="__span-8-94"><a id="__codelineno-8-94" name="__codelineno-8-94" href="#__codelineno-8-94"></a>    │   ├── sub-001_ses-pilot016_acq-highres_dir-RL_dwi.json
</span><span id="__span-8-95"><a id="__codelineno-8-95" name="__codelineno-8-95" href="#__codelineno-8-95"></a>    │   └── sub-001_ses-pilot016_acq-highres_dir-RL_dwi.nii.gz
</span><span id="__span-8-96"><a id="__codelineno-8-96" name="__codelineno-8-96" href="#__codelineno-8-96"></a>    ├── fmap
</span><span id="__span-8-97"><a id="__codelineno-8-97" name="__codelineno-8-97" href="#__codelineno-8-97"></a>    │   ├── sub-001_ses-pilot016_acq-b0_dir-AP_epi.json
</span><span id="__span-8-98"><a id="__codelineno-8-98" name="__codelineno-8-98" href="#__codelineno-8-98"></a>    │   ├── sub-001_ses-pilot016_acq-b0_dir-AP_epi.nii.gz
</span><span id="__span-8-99"><a id="__codelineno-8-99" name="__codelineno-8-99" href="#__codelineno-8-99"></a>    │   ├── sub-001_ses-pilot016_acq-b0_dir-LR_epi.json
</span><span id="__span-8-100"><a id="__codelineno-8-100" name="__codelineno-8-100" href="#__codelineno-8-100"></a>    │   ├── sub-001_ses-pilot016_acq-b0_dir-LR_epi.nii.gz
</span><span id="__span-8-101"><a id="__codelineno-8-101" name="__codelineno-8-101" href="#__codelineno-8-101"></a>    │   ├── sub-001_ses-pilot016_acq-b0_dir-PA_epi.json
</span><span id="__span-8-102"><a id="__codelineno-8-102" name="__codelineno-8-102" href="#__codelineno-8-102"></a>    │   ├── sub-001_ses-pilot016_acq-b0_dir-PA_epi.nii.gz
</span><span id="__span-8-103"><a id="__codelineno-8-103" name="__codelineno-8-103" href="#__codelineno-8-103"></a>    │   ├── sub-001_ses-pilot016_acq-b0_dir-RL_epi.json
</span><span id="__span-8-104"><a id="__codelineno-8-104" name="__codelineno-8-104" href="#__codelineno-8-104"></a>    │   ├── sub-001_ses-pilot016_acq-b0_dir-RL_epi.nii.gz
</span><span id="__span-8-105"><a id="__codelineno-8-105" name="__codelineno-8-105" href="#__codelineno-8-105"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-AP_part-mag_epi.json
</span><span id="__span-8-106"><a id="__codelineno-8-106" name="__codelineno-8-106" href="#__codelineno-8-106"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-AP_part-mag_epi.nii.gz
</span><span id="__span-8-107"><a id="__codelineno-8-107" name="__codelineno-8-107" href="#__codelineno-8-107"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-AP_part-phase_epi.json
</span><span id="__span-8-108"><a id="__codelineno-8-108" name="__codelineno-8-108" href="#__codelineno-8-108"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-AP_part-phase_epi.nii.gz
</span><span id="__span-8-109"><a id="__codelineno-8-109" name="__codelineno-8-109" href="#__codelineno-8-109"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-LR_part-mag_epi.json
</span><span id="__span-8-110"><a id="__codelineno-8-110" name="__codelineno-8-110" href="#__codelineno-8-110"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-LR_part-mag_epi.nii.gz
</span><span id="__span-8-111"><a id="__codelineno-8-111" name="__codelineno-8-111" href="#__codelineno-8-111"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-LR_part-phase_epi.json
</span><span id="__span-8-112"><a id="__codelineno-8-112" name="__codelineno-8-112" href="#__codelineno-8-112"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-LR_part-phase_epi.nii.gz
</span><span id="__span-8-113"><a id="__codelineno-8-113" name="__codelineno-8-113" href="#__codelineno-8-113"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-PA_part-mag_epi.json
</span><span id="__span-8-114"><a id="__codelineno-8-114" name="__codelineno-8-114" href="#__codelineno-8-114"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-PA_part-mag_epi.nii.gz
</span><span id="__span-8-115"><a id="__codelineno-8-115" name="__codelineno-8-115" href="#__codelineno-8-115"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-PA_part-phase_epi.json
</span><span id="__span-8-116"><a id="__codelineno-8-116" name="__codelineno-8-116" href="#__codelineno-8-116"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-PA_part-phase_epi.nii.gz
</span><span id="__span-8-117"><a id="__codelineno-8-117" name="__codelineno-8-117" href="#__codelineno-8-117"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-RL_part-mag_epi.json
</span><span id="__span-8-118"><a id="__codelineno-8-118" name="__codelineno-8-118" href="#__codelineno-8-118"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-RL_part-mag_epi.nii.gz
</span><span id="__span-8-119"><a id="__codelineno-8-119" name="__codelineno-8-119" href="#__codelineno-8-119"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-RL_part-phase_epi.json
</span><span id="__span-8-120"><a id="__codelineno-8-120" name="__codelineno-8-120" href="#__codelineno-8-120"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-RL_part-phase_epi.nii.gz
</span><span id="__span-8-121"><a id="__codelineno-8-121" name="__codelineno-8-121" href="#__codelineno-8-121"></a>    │   ├── sub-001_ses-pilot016_magnitude1.json
</span><span id="__span-8-122"><a id="__codelineno-8-122" name="__codelineno-8-122" href="#__codelineno-8-122"></a>    │   ├── sub-001_ses-pilot016_magnitude1.nii.gz
</span><span id="__span-8-123"><a id="__codelineno-8-123" name="__codelineno-8-123" href="#__codelineno-8-123"></a>    │   ├── sub-001_ses-pilot016_magnitude2.json
</span><span id="__span-8-124"><a id="__codelineno-8-124" name="__codelineno-8-124" href="#__codelineno-8-124"></a>    │   ├── sub-001_ses-pilot016_magnitude2.nii.gz
</span><span id="__span-8-125"><a id="__codelineno-8-125" name="__codelineno-8-125" href="#__codelineno-8-125"></a>    │   ├── sub-001_ses-pilot016_phasediff.json
</span><span id="__span-8-126"><a id="__codelineno-8-126" name="__codelineno-8-126" href="#__codelineno-8-126"></a>    │   └── sub-001_ses-pilot016_phasediff.nii.gz
</span><span id="__span-8-127"><a id="__codelineno-8-127" name="__codelineno-8-127" href="#__codelineno-8-127"></a>    ├── func
</span><span id="__span-8-128"><a id="__codelineno-8-128" name="__codelineno-8-128" href="#__codelineno-8-128"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-1_part-mag_bold.json
</span><span id="__span-8-129"><a id="__codelineno-8-129" name="__codelineno-8-129" href="#__codelineno-8-129"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-1_part-mag_bold.nii.gz
</span><span id="__span-8-130"><a id="__codelineno-8-130" name="__codelineno-8-130" href="#__codelineno-8-130"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-1_part-phase_bold.json
</span><span id="__span-8-131"><a id="__codelineno-8-131" name="__codelineno-8-131" href="#__codelineno-8-131"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-1_part-phase_bold.nii.gz
</span><span id="__span-8-132"><a id="__codelineno-8-132" name="__codelineno-8-132" href="#__codelineno-8-132"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-2_part-mag_bold.json
</span><span id="__span-8-133"><a id="__codelineno-8-133" name="__codelineno-8-133" href="#__codelineno-8-133"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-2_part-mag_bold.nii.gz
</span><span id="__span-8-134"><a id="__codelineno-8-134" name="__codelineno-8-134" href="#__codelineno-8-134"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-2_part-phase_bold.json
</span><span id="__span-8-135"><a id="__codelineno-8-135" name="__codelineno-8-135" href="#__codelineno-8-135"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-2_part-phase_bold.nii.gz
</span><span id="__span-8-136"><a id="__codelineno-8-136" name="__codelineno-8-136" href="#__codelineno-8-136"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-3_part-mag_bold.json
</span><span id="__span-8-137"><a id="__codelineno-8-137" name="__codelineno-8-137" href="#__codelineno-8-137"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-3_part-mag_bold.nii.gz
</span><span id="__span-8-138"><a id="__codelineno-8-138" name="__codelineno-8-138" href="#__codelineno-8-138"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-3_part-phase_bold.json
</span><span id="__span-8-139"><a id="__codelineno-8-139" name="__codelineno-8-139" href="#__codelineno-8-139"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-3_part-phase_bold.nii.gz
</span><span id="__span-8-140"><a id="__codelineno-8-140" name="__codelineno-8-140" href="#__codelineno-8-140"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-4_part-mag_bold.json
</span><span id="__span-8-141"><a id="__codelineno-8-141" name="__codelineno-8-141" href="#__codelineno-8-141"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-4_part-mag_bold.nii.gz
</span><span id="__span-8-142"><a id="__codelineno-8-142" name="__codelineno-8-142" href="#__codelineno-8-142"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-4_part-phase_bold.json
</span><span id="__span-8-143"><a id="__codelineno-8-143" name="__codelineno-8-143" href="#__codelineno-8-143"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-4_part-phase_bold.nii.gz
</span><span id="__span-8-144"><a id="__codelineno-8-144" name="__codelineno-8-144" href="#__codelineno-8-144"></a>    │   ├── sub-001_ses-pilot016_task-bht_part-mag_events.tsv
</span><span id="__span-8-145"><a id="__codelineno-8-145" name="__codelineno-8-145" href="#__codelineno-8-145"></a>    │   ├── sub-001_ses-pilot016_task-bht_part-phase_events.tsv
</span><span id="__span-8-146"><a id="__codelineno-8-146" name="__codelineno-8-146" href="#__codelineno-8-146"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-1_part-mag_bold.json
</span><span id="__span-8-147"><a id="__codelineno-8-147" name="__codelineno-8-147" href="#__codelineno-8-147"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-1_part-mag_bold.nii.gz
</span><span id="__span-8-148"><a id="__codelineno-8-148" name="__codelineno-8-148" href="#__codelineno-8-148"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-1_part-phase_bold.json
</span><span id="__span-8-149"><a id="__codelineno-8-149" name="__codelineno-8-149" href="#__codelineno-8-149"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-1_part-phase_bold.nii.gz
</span><span id="__span-8-150"><a id="__codelineno-8-150" name="__codelineno-8-150" href="#__codelineno-8-150"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-2_part-mag_bold.json
</span><span id="__span-8-151"><a id="__codelineno-8-151" name="__codelineno-8-151" href="#__codelineno-8-151"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-2_part-mag_bold.nii.gz
</span><span id="__span-8-152"><a id="__codelineno-8-152" name="__codelineno-8-152" href="#__codelineno-8-152"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-2_part-phase_bold.json
</span><span id="__span-8-153"><a id="__codelineno-8-153" name="__codelineno-8-153" href="#__codelineno-8-153"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-2_part-phase_bold.nii.gz
</span><span id="__span-8-154"><a id="__codelineno-8-154" name="__codelineno-8-154" href="#__codelineno-8-154"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-3_part-mag_bold.json
</span><span id="__span-8-155"><a id="__codelineno-8-155" name="__codelineno-8-155" href="#__codelineno-8-155"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-3_part-mag_bold.nii.gz
</span><span id="__span-8-156"><a id="__codelineno-8-156" name="__codelineno-8-156" href="#__codelineno-8-156"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-3_part-phase_bold.json
</span><span id="__span-8-157"><a id="__codelineno-8-157" name="__codelineno-8-157" href="#__codelineno-8-157"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-3_part-phase_bold.nii.gz
</span><span id="__span-8-158"><a id="__codelineno-8-158" name="__codelineno-8-158" href="#__codelineno-8-158"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-4_part-mag_bold.json
</span><span id="__span-8-159"><a id="__codelineno-8-159" name="__codelineno-8-159" href="#__codelineno-8-159"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-4_part-mag_bold.nii.gz
</span><span id="__span-8-160"><a id="__codelineno-8-160" name="__codelineno-8-160" href="#__codelineno-8-160"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-4_part-phase_bold.json
</span><span id="__span-8-161"><a id="__codelineno-8-161" name="__codelineno-8-161" href="#__codelineno-8-161"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-4_part-phase_bold.nii.gz
</span><span id="__span-8-162"><a id="__codelineno-8-162" name="__codelineno-8-162" href="#__codelineno-8-162"></a>    │   ├── sub-001_ses-pilot016_task-qct_part-mag_events.tsv
</span><span id="__span-8-163"><a id="__codelineno-8-163" name="__codelineno-8-163" href="#__codelineno-8-163"></a>    │   ├── sub-001_ses-pilot016_task-qct_part-phase_events.tsv
</span><span id="__span-8-164"><a id="__codelineno-8-164" name="__codelineno-8-164" href="#__codelineno-8-164"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-1_part-mag_bold.json
</span><span id="__span-8-165"><a id="__codelineno-8-165" name="__codelineno-8-165" href="#__codelineno-8-165"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-1_part-mag_bold.nii.gz
</span><span id="__span-8-166"><a id="__codelineno-8-166" name="__codelineno-8-166" href="#__codelineno-8-166"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-1_part-phase_bold.json
</span><span id="__span-8-167"><a id="__codelineno-8-167" name="__codelineno-8-167" href="#__codelineno-8-167"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-1_part-phase_bold.nii.gz
</span><span id="__span-8-168"><a id="__codelineno-8-168" name="__codelineno-8-168" href="#__codelineno-8-168"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-2_part-mag_bold.json
</span><span id="__span-8-169"><a id="__codelineno-8-169" name="__codelineno-8-169" href="#__codelineno-8-169"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-2_part-mag_bold.nii.gz
</span><span id="__span-8-170"><a id="__codelineno-8-170" name="__codelineno-8-170" href="#__codelineno-8-170"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-2_part-phase_bold.json
</span><span id="__span-8-171"><a id="__codelineno-8-171" name="__codelineno-8-171" href="#__codelineno-8-171"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-2_part-phase_bold.nii.gz
</span><span id="__span-8-172"><a id="__codelineno-8-172" name="__codelineno-8-172" href="#__codelineno-8-172"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-3_part-mag_bold.json
</span><span id="__span-8-173"><a id="__codelineno-8-173" name="__codelineno-8-173" href="#__codelineno-8-173"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-3_part-mag_bold.nii.gz
</span><span id="__span-8-174"><a id="__codelineno-8-174" name="__codelineno-8-174" href="#__codelineno-8-174"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-3_part-phase_bold.json
</span><span id="__span-8-175"><a id="__codelineno-8-175" name="__codelineno-8-175" href="#__codelineno-8-175"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-3_part-phase_bold.nii.gz
</span><span id="__span-8-176"><a id="__codelineno-8-176" name="__codelineno-8-176" href="#__codelineno-8-176"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-4_part-mag_bold.json
</span><span id="__span-8-177"><a id="__codelineno-8-177" name="__codelineno-8-177" href="#__codelineno-8-177"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-4_part-mag_bold.nii.gz
</span><span id="__span-8-178"><a id="__codelineno-8-178" name="__codelineno-8-178" href="#__codelineno-8-178"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-4_part-phase_bold.json
</span><span id="__span-8-179"><a id="__codelineno-8-179" name="__codelineno-8-179" href="#__codelineno-8-179"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-4_part-phase_bold.nii.gz
</span><span id="__span-8-180"><a id="__codelineno-8-180" name="__codelineno-8-180" href="#__codelineno-8-180"></a>    │   ├── sub-001_ses-pilot016_task-rest_part-mag_events.tsv
</span><span id="__span-8-181"><a id="__codelineno-8-181" name="__codelineno-8-181" href="#__codelineno-8-181"></a>    │   └── sub-001_ses-pilot016_task-rest_part-phase_events.tsv
</span><span id="__span-8-182"><a id="__codelineno-8-182" name="__codelineno-8-182" href="#__codelineno-8-182"></a>    └── sub-001_ses-pilot016_scans.tsv
</span></code></pre></div>
</details>
<details class="warning">
<summary>We started to generate phase and magnitude only after session 15</summary>
<p>As a result, the piloting data up to session 14 will look more like:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>├── ses-pilot014
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>│   ├── anat
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>│   │   ├── sub-001_ses-pilot014_acq-original_T1w.json
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>│   │   ├── sub-001_ses-pilot014_acq-original_T1w.nii.gz
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>│   │   ├── sub-001_ses-pilot014_acq-undistorted_T1w.json
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>│   │   ├── sub-001_ses-pilot014_acq-undistorted_T1w.nii.gz
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>│   │   ├── sub-001_ses-pilot014_T2w.json
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>│   │   └── sub-001_ses-pilot014_T2w.nii.gz
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>│   ├── dwi
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>│   │   ├── sub-001_ses-pilot014_acq-highres_dir-PA_dwi.bval
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>│   │   ├── sub-001_ses-pilot014_acq-highres_dir-PA_dwi.bvec
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>│   │   ├── sub-001_ses-pilot014_acq-highres_dir-PA_dwi.json
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>│   │   └── sub-001_ses-pilot014_acq-highres_dir-PA_dwi.nii.gz
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>│   ├── fmap
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>│   │   ├── sub-001_ses-pilot014_acq-b0_dir-AP_epi.json
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>│   │   ├── sub-001_ses-pilot014_acq-b0_dir-AP_epi.nii.gz
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>│   │   ├── sub-001_ses-pilot014_acq-bold_dir-PA_run-1_epi.json
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>│   │   ├── sub-001_ses-pilot014_acq-bold_dir-PA_run-1_epi.nii.gz
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>│   │   ├── sub-001_ses-pilot014_acq-bold_dir-PA_run-2_epi.json
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>│   │   ├── sub-001_ses-pilot014_acq-bold_dir-PA_run-2_epi.nii.gz
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>│   │   ├── sub-001_ses-pilot014_magnitude1.json
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>│   │   ├── sub-001_ses-pilot014_magnitude1.nii.gz
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>│   │   ├── sub-001_ses-pilot014_magnitude2.json
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>│   │   ├── sub-001_ses-pilot014_magnitude2.nii.gz
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>│   │   ├── sub-001_ses-pilot014_phasediff.json
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>│   │   └── sub-001_ses-pilot014_phasediff.nii.gz
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>│   ├── func
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a>│   │   ├── sub-001_ses-pilot014_task-bht_echo-1_bold.json
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>│   │   ├── sub-001_ses-pilot014_task-bht_echo-1_bold.nii.gz
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>│   │   ├── sub-001_ses-pilot014_task-bht_echo-2_bold.json
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a>│   │   ├── sub-001_ses-pilot014_task-bht_echo-2_bold.nii.gz
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a>│   │   ├── sub-001_ses-pilot014_task-bht_echo-3_bold.json
</span><span id="__span-9-33"><a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>│   │   ├── sub-001_ses-pilot014_task-bht_echo-3_bold.nii.gz
</span><span id="__span-9-34"><a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>│   │   ├── sub-001_ses-pilot014_task-bht_echo-4_bold.json
</span><span id="__span-9-35"><a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a>│   │   ├── sub-001_ses-pilot014_task-bht_echo-4_bold.nii.gz
</span><span id="__span-9-36"><a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a>│   │   ├── sub-001_ses-pilot014_task-bht_events.tsv
</span><span id="__span-9-37"><a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-1_echo-1_bold.json
</span><span id="__span-9-38"><a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-1_echo-1_bold.nii.gz
</span><span id="__span-9-39"><a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-1_echo-2_bold.json
</span><span id="__span-9-40"><a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-1_echo-2_bold.nii.gz
</span><span id="__span-9-41"><a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-1_echo-3_bold.json
</span><span id="__span-9-42"><a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-1_echo-3_bold.nii.gz
</span><span id="__span-9-43"><a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-1_echo-4_bold.json
</span><span id="__span-9-44"><a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-1_echo-4_bold.nii.gz
</span><span id="__span-9-45"><a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-1_events.tsv
</span><span id="__span-9-46"><a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-2_echo-1_bold.json
</span><span id="__span-9-47"><a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-2_echo-1_bold.nii.gz
</span><span id="__span-9-48"><a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-2_echo-2_bold.json
</span><span id="__span-9-49"><a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-2_echo-2_bold.nii.gz
</span><span id="__span-9-50"><a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-2_echo-3_bold.json
</span><span id="__span-9-51"><a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-2_echo-3_bold.nii.gz
</span><span id="__span-9-52"><a id="__codelineno-9-52" name="__codelineno-9-52" href="#__codelineno-9-52"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-2_echo-4_bold.json
</span><span id="__span-9-53"><a id="__codelineno-9-53" name="__codelineno-9-53" href="#__codelineno-9-53"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-2_echo-4_bold.nii.gz
</span><span id="__span-9-54"><a id="__codelineno-9-54" name="__codelineno-9-54" href="#__codelineno-9-54"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-2_events.tsv
</span><span id="__span-9-55"><a id="__codelineno-9-55" name="__codelineno-9-55" href="#__codelineno-9-55"></a>│   │   ├── sub-001_ses-pilot014_task-qct_echo-1_bold.json
</span><span id="__span-9-56"><a id="__codelineno-9-56" name="__codelineno-9-56" href="#__codelineno-9-56"></a>│   │   ├── sub-001_ses-pilot014_task-qct_echo-1_bold.nii.gz
</span><span id="__span-9-57"><a id="__codelineno-9-57" name="__codelineno-9-57" href="#__codelineno-9-57"></a>│   │   ├── sub-001_ses-pilot014_task-qct_echo-2_bold.json
</span><span id="__span-9-58"><a id="__codelineno-9-58" name="__codelineno-9-58" href="#__codelineno-9-58"></a>│   │   ├── sub-001_ses-pilot014_task-qct_echo-2_bold.nii.gz
</span><span id="__span-9-59"><a id="__codelineno-9-59" name="__codelineno-9-59" href="#__codelineno-9-59"></a>│   │   ├── sub-001_ses-pilot014_task-qct_echo-3_bold.json
</span><span id="__span-9-60"><a id="__codelineno-9-60" name="__codelineno-9-60" href="#__codelineno-9-60"></a>│   │   ├── sub-001_ses-pilot014_task-qct_echo-3_bold.nii.gz
</span><span id="__span-9-61"><a id="__codelineno-9-61" name="__codelineno-9-61" href="#__codelineno-9-61"></a>│   │   ├── sub-001_ses-pilot014_task-qct_echo-4_bold.json
</span><span id="__span-9-62"><a id="__codelineno-9-62" name="__codelineno-9-62" href="#__codelineno-9-62"></a>│   │   ├── sub-001_ses-pilot014_task-qct_echo-4_bold.nii.gz
</span><span id="__span-9-63"><a id="__codelineno-9-63" name="__codelineno-9-63" href="#__codelineno-9-63"></a>│   │   ├── sub-001_ses-pilot014_task-qct_events.tsv
</span><span id="__span-9-64"><a id="__codelineno-9-64" name="__codelineno-9-64" href="#__codelineno-9-64"></a>│   │   ├── sub-001_ses-pilot014_task-rest_echo-1_bold.json
</span><span id="__span-9-65"><a id="__codelineno-9-65" name="__codelineno-9-65" href="#__codelineno-9-65"></a>│   │   ├── sub-001_ses-pilot014_task-rest_echo-1_bold.nii.gz
</span><span id="__span-9-66"><a id="__codelineno-9-66" name="__codelineno-9-66" href="#__codelineno-9-66"></a>│   │   ├── sub-001_ses-pilot014_task-rest_echo-2_bold.json
</span><span id="__span-9-67"><a id="__codelineno-9-67" name="__codelineno-9-67" href="#__codelineno-9-67"></a>│   │   ├── sub-001_ses-pilot014_task-rest_echo-2_bold.nii.gz
</span><span id="__span-9-68"><a id="__codelineno-9-68" name="__codelineno-9-68" href="#__codelineno-9-68"></a>│   │   ├── sub-001_ses-pilot014_task-rest_echo-3_bold.json
</span><span id="__span-9-69"><a id="__codelineno-9-69" name="__codelineno-9-69" href="#__codelineno-9-69"></a>│   │   ├── sub-001_ses-pilot014_task-rest_echo-3_bold.nii.gz
</span><span id="__span-9-70"><a id="__codelineno-9-70" name="__codelineno-9-70" href="#__codelineno-9-70"></a>│   │   ├── sub-001_ses-pilot014_task-rest_echo-4_bold.json
</span><span id="__span-9-71"><a id="__codelineno-9-71" name="__codelineno-9-71" href="#__codelineno-9-71"></a>│   │   ├── sub-001_ses-pilot014_task-rest_echo-4_bold.nii.gz
</span><span id="__span-9-72"><a id="__codelineno-9-72" name="__codelineno-9-72" href="#__codelineno-9-72"></a>│   │   └── sub-001_ses-pilot014_task-rest_events.tsv
</span><span id="__span-9-73"><a id="__codelineno-9-73" name="__codelineno-9-73" href="#__codelineno-9-73"></a>│   └── sub-001_ses-pilot014_scans.tsv
</span></code></pre></div>
</details>
</li>
</ul>
<h3 id="convert-physiological-recordings-and-eye-tracking-data-to-bids">Convert physiological recordings and eye-tracking data to <abbr title="Brain Imaging Data Structure">BIDS</abbr><a class="headerlink" href="#convert-physiological-recordings-and-eye-tracking-data-to-bids" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Plot an overview of the data with the following command.
     This command generates a <abbr title="portable networks graphics">PNG</abbr> plot of the data within the current directory without processing the data itself.
     The physiological data folder is specified via the <code>-in</code> command line argument.
    <div class="language-shell highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>phys2bids<span class="w"> </span>-in<span class="w"> </span>/data/datasets/hcph-pilot-sourcedata/physio/session-recording.acq<span class="w"> </span>-info
</span></code></pre></div></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Check that all the channels are present in the <abbr title="portable networks graphics">PNG</abbr> plot.</li>
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> If this is the case, proceed to process the file using the subsequent command.
    Use the <code>-ntp</code> argument to specify the number of volumes for each task, and the <code>-tr</code> argument to indicate the task's repetition time.
    Define the output directory with <code>-outdir</code> and provide the path to the heuristic file using <code>-heur</code>.
    Adjust the subject and session numbers accordingly.
    Should scanner trigger transmission encounter issues and manual adjustments are made to the trigger data, it is possible to allocate one trigger per task.
    Set the repetition time duration as the task length, as demonstrated in the example below.
    <div class="language-shell highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>phys2bids<span class="w"> </span>-in<span class="w"> </span>modified-last-session_multiscan.txt<span class="w"> </span>-chtrig<span class="w"> </span><span class="m">4</span><span class="w"> </span>-ntp<span class="w">  </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>-tr<span class="w"> </span><span class="m">158</span><span class="w"> </span><span class="m">1200</span><span class="w"> </span><span class="m">331</span><span class="w"> </span>-thr<span class="w"> </span><span class="m">2</span><span class="w"> </span>-outdir<span class="w"> </span>outputdir<span class="w"> </span>-heur<span class="w"> </span>heur_physio.py<span class="w"> </span>-sub<span class="w"> </span>pilot<span class="w"> </span>-ses<span class="w"> </span>pilot016
</span></code></pre></div></p>
</li>
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Execute the script <code>write_event_file.py</code> as shown below to generate task event files.
    This script creates <abbr title="JavaScript Object Notation">JSON</abbr> and <abbr title="tab-separated values">TSV</abbr> files containing event information and generates <abbr title="portable networks graphics">PNG</abbr> plots for each task, displaying both physiological data and corresponding events.
    These plots are saved in the current directory.
    The script must be executed with the following command, where <code>outputdir</code> is the output directory of <em>phys2bids</em>:
    <div class="language-shell highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>python<span class="w"> </span>write_event_file.py<span class="w"> </span>--path<span class="w"> </span>./outputdir/sub-001/ses-pilot016/func/
</span></code></pre></div></p>
</li>
</ul>
<p>Once the script is executed, the <abbr title="Brain Imaging Data Structure">BIDS</abbr> folder (consisting solely of physiological data in this case) will have the following structure:
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>ses-pilot016
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>    └── func
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>        ├── sub-001_ses-pilot016_task-bht_events.json
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>        ├── sub-001_ses-pilot016_task-bht_events.tsv
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>        ├── sub-001_ses-pilot016_task-bht_physio.json
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>        ├── sub-001_ses-pilot016_task-bht_physio.tsv.gz
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>        ├── sub-001_ses-pilot016_task-qct_events.json
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>        ├── sub-001_ses-pilot016_task-qct_events.tsv
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>        ├── sub-001_ses-pilot016_task-qct_physio.json
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>        ├── sub-001_ses-pilot016_task-qct_physio.tsv.gz
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>        ├── sub-001_ses-pilot016_task-rest_events.json
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>        ├── sub-001_ses-pilot016_task-rest_events.tsv
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>        ├── sub-001_ses-pilot016_task-rest_physio.json
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>        └── sub-001_ses-pilot016_task-rest_physio.tsv.gz
</span></code></pre></div></p>
<h3 id="add-new-data-to-the-datalad-dataset">Add new data to the <em>DataLad</em> dataset<a class="headerlink" href="#add-new-data-to-the-datalad-dataset" title="Permanent link">&para;</a></h3>
<p>As new sessions are collected, the corresponding <abbr title="Brain Imaging Data Structure">BIDS</abbr> structures MUST be saved within the <em>DataLad</em> dataset and pushed to remote storage systems:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Save the files in the dataset history using the command below.
    Replace <code>&lt;session_id&gt;</code> below with the number of the session (e.g., <code>pilot017</code>):
    <div class="language-shell highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>datalad<span class="w"> </span>save<span class="w"> </span>-r<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;add: session &lt;session_id&gt;&quot;</span><span class="w"> </span>sub-001/ses-&lt;session_id&gt;
</span></code></pre></div></li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Push the new data to the remote storage (if your git containing <em>DataLad</em> and the Git annex is different from <code>origin</code>, e.g., <code>github</code>, replace the name below):
    <div class="language-shell highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>datalad<span class="w"> </span>push<span class="w"> </span>--to<span class="w"> </span>origin
</span></code></pre></div></li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2023
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.expand", "navigation.top", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.aecac24b.min.js"></script>
      
        <script src="../../js/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>