
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Step-by-step instructions (standard operating procedures; SOPs) to replicate our Human Connectome PHantom project (HCPh)">
      
      
        <meta name="author" content="The AxonLab">
      
      
      
        <link rel="prev" href="../preliminary/">
      
      
        <link rel="next" href="../qaqc-general/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.34">
    
    
      
        <title>Post-session retrieval and BIDS - Standard Operating Procedures of the HCPh project</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.35f28582.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--thanks:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8.048 2.241c.964-.709 2.079-1.238 3.325-1.241a4.62 4.62 0 0 1 3.282 1.355c.41.408.757.86.996 1.428.238.568.348 1.206.347 1.968 0 2.193-1.505 4.254-3.081 5.862-1.496 1.526-3.213 2.796-4.249 3.563l-.22.163a.75.75 0 0 1-.895 0l-.221-.163c-1.036-.767-2.753-2.037-4.249-3.563C1.51 10.008.007 7.952.002 5.762a4.61 4.61 0 0 1 1.353-3.407C3.123.585 6.223.537 8.048 2.24Zm-1.153.983c-1.25-1.033-3.321-.967-4.48.191a3.12 3.12 0 0 0-.913 2.335c0 1.556 1.109 3.24 2.652 4.813C5.463 11.898 6.96 13.032 8 13.805c.353-.262.758-.565 1.191-.905l-1.326-1.223a.75.75 0 0 1 1.018-1.102l1.48 1.366c.328-.281.659-.577.984-.887L9.99 9.802a.75.75 0 1 1 1.019-1.103l1.384 1.28q.443-.494.81-.995L12.92 8.7l-1.167-1.168c-.674-.671-1.78-.664-2.474.03q-.404.405-.802.797c-.893.882-2.319.843-3.185-.032q-.518-.524-1.043-1.047a.75.75 0 0 1-.04-1.016q.244-.288.52-.623c.62-.748 1.356-1.637 2.166-2.417m7.112 4.442c.313-.65.491-1.293.491-1.916v-.001c0-.614-.088-1.045-.23-1.385-.143-.339-.357-.633-.673-.949a3.1 3.1 0 0 0-2.218-.915c-1.092.003-2.165.627-3.226 1.602-.823.755-1.554 1.637-2.228 2.45l-.127.154.562.566a.755.755 0 0 0 1.066.02l.794-.79c1.258-1.258 3.312-1.31 4.594-.032.396.394.792.791 1.173 1.173Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M256 448c141.4 0 256-93.1 256-208S397.4 32 256 32 0 125.1 0 240c0 45.1 17.7 86.8 47.7 120.9-1.9 24.5-11.4 46.3-21.4 62.9-5.5 9.2-11.1 16.6-15.2 21.6-2.1 2.5-3.7 4.4-4.9 5.7-.6.6-1 1.1-1.3 1.4l-.3.3c-4.6 4.6-5.9 11.4-3.4 17.4s8.3 9.9 14.8 9.9c28.7 0 57.6-8.9 81.6-19.3 22.9-10 42.4-21.9 54.3-30.6 31.8 11.5 67 17.9 104.1 17.9zM128 208a32 32 0 1 1 0 64 32 32 0 1 1 0-64m128 0a32 32 0 1 1 0 64 32 32 0 1 1 0-64m96 32a32 32 0 1 1 64 0 32 32 0 1 1-64 0"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M256 512a256 256 0 1 0 0-512 256 256 0 1 0 0 512m0-384c13.3 0 24 10.7 24 24v112c0 13.3-10.7 24-24 24s-24-10.7-24-24V152c0-13.3 10.7-24 24-24m-32 224a32 32 0 1 1 64 0 32 32 0 1 1-64 0"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M64 0C28.7 0 0 28.7 0 64v288c0 88.4 71.6 160 160 160s160-71.6 160-160V64c0-35.3-28.7-64-64-64zm96 416a48 48 0 1 1 0-96 48 48 0 1 1 0 96m48-176a48 48 0 1 1-96 0 48 48 0 1 1 96 0m-48-80a48 48 0 1 1 0-96 48 48 0 1 1 0 96"/></svg>');--md-admonition-icon--important:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M480 32c0-12.9-7.8-24.6-19.8-29.6S434.5.2 425.3 9.3L381.7 53c-48 48-113.1 75-181 75H64c-35.3 0-64 28.7-64 64v96c0 35.3 28.7 64 64 64v128c0 17.7 14.3 32 32 32h64c17.7 0 32-14.3 32-32V352h8.7c67.9 0 133 27 181 75l43.6 43.6c9.2 9.2 22.9 11.9 34.9 6.9s19.8-16.6 19.8-29.6V300.3c18.6-8.8 32-32.5 32-60.4s-13.4-51.6-32-60.4zm-64 76.7v262.6C357.2 317.8 280.5 288 200.7 288H192v-96h8.7c79.8 0 156.5-29.8 215.3-83.3"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 48v439.7C0 501.1 10.9 512 24.3 512c5 0 9.9-1.5 14-4.4L192 400l153.7 107.6c4.1 2.9 9 4.4 14 4.4 13.4 0 24.3-10.9 24.3-24.3V48c0-26.5-21.5-48-48-48H48C21.5 0 0 21.5 0 48"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M256 48a208 208 0 1 1 0 416 208 208 0 1 1 0-416m0 464a256 256 0 1 0 0-512 256 256 0 1 0 0 512m-81-337c-9.4 9.4-9.4 24.6 0 33.9l47 47-47 47c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l47-47 47 47c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-47-47 47-47c9.4-9.4 9.4-24.6 0-33.9s-24.6-9.4-33.9 0l-47 47-47-47c-9.4-9.4-24.6-9.4-33.9 0"/></svg>');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#post-session-retrieval-and-bids" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Standard Operating Procedures of the HCPh project" class="md-header__button md-logo" aria-label="Standard Operating Procedures of the HCPh project" data-md-component="logo">
      
  <img src="../../assets/images/chuv_logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Standard Operating Procedures of the HCPh project
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Post-session retrieval and BIDS
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Standard Operating Procedures of the HCPh project" class="md-nav__button md-logo" aria-label="Standard Operating Procedures of the HCPh project" data-md-component="logo">
      
  <img src="../../assets/images/chuv_logo.svg" alt="logo">

    </a>
    Standard Operating Procedures of the HCPh project
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Change History
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Recruitment, Scheduling, and Screening
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Recruitment, Scheduling, and Screening
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recruitment-scheduling-screening/recruitment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Recruitment and screening
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../recruitment-scheduling-screening/scheduling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scheduling
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data collection
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Data collection
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-collection/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overall experimental settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-collection/setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Before data collection starts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-collection/pre-session/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Before session day
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-collection/tear-up/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Session preparation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-collection/participant-prep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preparing the participant
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-collection/scanning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running the scanning session
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-collection/tear-down/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Session tear-down
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-collection/emergency-procedures/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Emergency procedures
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data management
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Data management
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overall post-scanner steps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../preliminary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Before data acquisition (storage preparation)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Post-session retrieval and BIDS
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Post-session retrieval and BIDS
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#within-48h-after-the-first-session" class="md-nav__link">
    <span class="md-ellipsis">
      Within 48h after the FIRST session
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#within-one-week-after-the-completed-session" class="md-nav__link">
    <span class="md-ellipsis">
      Within one week after the completed session
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Within one week after the completed session">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-the-data-from-the-pacs-with-pacsman-only-authorized-users" class="md-nav__link">
    <span class="md-ellipsis">
      Download the data from the PACS with PACSMAN (only authorized users)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieve-physiological-recordings" class="md-nav__link">
    <span class="md-ellipsis">
      Retrieve physiological recordings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#within-two-weeks-after-the-completed-session" class="md-nav__link">
    <span class="md-ellipsis">
      Within two weeks after the completed session
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Within two weeks after the completed session">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#convert-imaging-data-to-bids-with-heudiconv" class="md-nav__link">
    <span class="md-ellipsis">
      Convert imaging data to BIDS with HeuDiConv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clean-up-after-bids-conversion-and-preparation-for-archival" class="md-nav__link">
    <span class="md-ellipsis">
      Clean-up after BIDS conversion and preparation for archival
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-bids-events-files" class="md-nav__link">
    <span class="md-ellipsis">
      Generate BIDS' events files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#convert-physiological-recordings-into-bids-in-house" class="md-nav__link">
    <span class="md-ellipsis">
      Convert physiological recordings into BIDS (in-house)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#convert-eye-tracking-into-bids-in-house" class="md-nav__link">
    <span class="md-ellipsis">
      Convert eye-tracking into BIDS (in-house)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-new-data-to-the-datalad-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      Add new data to the DataLad dataset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formal-qc" class="md-nav__link">
    <span class="md-ellipsis">
      Formal QC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visual-assessment-of-unprocessed-data-with-mriqc" class="md-nav__link">
    <span class="md-ellipsis">
      Visual assessment of unprocessed data with MRIQC
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upon-updates-and-bugfixes-of-the-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      Upon updates and bugfixes of the dataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Upon updates and bugfixes of the dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#update-pybidss-database-index" class="md-nav__link">
    <span class="md-ellipsis">
      Update PyBIDS's database index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../qaqc-general/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    QA/QC protocol overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mriqc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    QC of unprocessed data
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Processing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Processing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processing/preprocessing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Preprocessing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processing/functional-connectivity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extracting functional connectivity
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Analysis
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../analysis/qct-activation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quality control task activation analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../analysis/qc-regressor-hcph/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Calibrating regressor to flag HCPh T1w images for exclusion
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Release of data
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Appendices
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Appendices
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-collection/notes-scanning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Notes on the scanner's console
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-collection/notes-et/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ET extended guidelines
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-collection/notes-misc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Additional miscellaneous protocols
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-collection/notes-software/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Notes on software installation and tips
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../physio-to-bids/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Converting HCPh's physio into BIDS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../edf-to-bids/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Converting eye-tracking into BIDS
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    QA/QC Appendices
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            QA/QC Appendices
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../qaqc-criteria-unprocessed/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    QA/QC criteria for unprocessed data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processing/qaqc-criteria-preprocessed/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    QA/QC criteria for preprocessed data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../processing/qaqc-criteria-FC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    QA/QC criteria for functional connectivity
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../eyetrack-qc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    QA/QC of eye-tracking data
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Deprecated procedures
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Deprecated procedures
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data-collection/legacy-et/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Legacy procedure for the ET mirror
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#within-48h-after-the-first-session" class="md-nav__link">
    <span class="md-ellipsis">
      Within 48h after the FIRST session
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#within-one-week-after-the-completed-session" class="md-nav__link">
    <span class="md-ellipsis">
      Within one week after the completed session
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Within one week after the completed session">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#download-the-data-from-the-pacs-with-pacsman-only-authorized-users" class="md-nav__link">
    <span class="md-ellipsis">
      Download the data from the PACS with PACSMAN (only authorized users)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retrieve-physiological-recordings" class="md-nav__link">
    <span class="md-ellipsis">
      Retrieve physiological recordings
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#within-two-weeks-after-the-completed-session" class="md-nav__link">
    <span class="md-ellipsis">
      Within two weeks after the completed session
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Within two weeks after the completed session">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#convert-imaging-data-to-bids-with-heudiconv" class="md-nav__link">
    <span class="md-ellipsis">
      Convert imaging data to BIDS with HeuDiConv
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clean-up-after-bids-conversion-and-preparation-for-archival" class="md-nav__link">
    <span class="md-ellipsis">
      Clean-up after BIDS conversion and preparation for archival
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-bids-events-files" class="md-nav__link">
    <span class="md-ellipsis">
      Generate BIDS' events files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#convert-physiological-recordings-into-bids-in-house" class="md-nav__link">
    <span class="md-ellipsis">
      Convert physiological recordings into BIDS (in-house)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#convert-eye-tracking-into-bids-in-house" class="md-nav__link">
    <span class="md-ellipsis">
      Convert eye-tracking into BIDS (in-house)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-new-data-to-the-datalad-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      Add new data to the DataLad dataset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formal-qc" class="md-nav__link">
    <span class="md-ellipsis">
      Formal QC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visual-assessment-of-unprocessed-data-with-mriqc" class="md-nav__link">
    <span class="md-ellipsis">
      Visual assessment of unprocessed data with MRIQC
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upon-updates-and-bugfixes-of-the-dataset" class="md-nav__link">
    <span class="md-ellipsis">
      Upon updates and bugfixes of the dataset
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Upon updates and bugfixes of the dataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#update-pybidss-database-index" class="md-nav__link">
    <span class="md-ellipsis">
      Update PyBIDS's database index
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="post-session-retrieval-and-bids">Post-session retrieval and <abbr title="Brain Imaging Data Structure">BIDS</abbr><a class="headerlink" href="#post-session-retrieval-and-bids" title="Permanent link">&para;</a></h1>
<h2 id="within-48h-after-the-first-session">Within 48h after the FIRST session<a class="headerlink" href="#within-48h-after-the-first-session" title="Permanent link">&para;</a></h2>
<div class="admonition danger">
<p class="admonition-title">Anatomical images must be screened for incidental findings within 48h after the first session</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Send the T1-weighted and T2-weighted scan to ███ for screening and incidental findings.</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Indicate on <a href="/redacted.html">our recruits spreadsheet</a> that the participant's first session has been submitted for screening.</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Wait for response from ███ and note down the result of the screening in our <a href="/redacted.html">our recruits spreadsheet</a>.</li>
</ul>
</div>
<p>To do so, you'll need to first <a href="#download-the-data-from-the-pacs-with-pacsman-only-authorized-users">download the data from <abbr title="picture archiving and communication system">PACS</abbr></a> and then <a href="#convert-imaging-data-to-bids-with-heudiconv">convert the data into <abbr title="Brain Imaging Data Structure">BIDS</abbr></a>.</p>
<div class="admonition warning">
<p class="admonition-title">What to do when there are incidental findings</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Discuss with ███ how to proceed with the participant.</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Exclude the participant from the study if ███ evaluates they don't meet the participation (inclusion and exclusion) criteria.</li>
</ul>
</div>
<h2 id="within-one-week-after-the-completed-session">Within one week after the completed session<a class="headerlink" href="#within-one-week-after-the-completed-session" title="Permanent link">&para;</a></h2>
<h3 id="download-the-data-from-the-pacs-with-pacsman-only-authorized-users">Download the data from the <abbr title="picture archiving and communication system">PACS</abbr> with <em>PACSMAN</em> (only authorized users)<a class="headerlink" href="#download-the-data-from-the-pacs-with-pacsman-only-authorized-users" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Log-in into the <em>PACSMAN</em> computer  (<em>███</em>)</li>
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Mount a remote filesystem through sshfs:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>sshfs<span class="w"> </span>&lt;hostname&gt;:/data/datasets/hcph-pilot-sourcedata<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">               </span><span class="nv">$HOME</span>/data/hcph-pilot<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">      </span>&lt;args&gt;
</span></code></pre></div>
</li>
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Edit the query file <code>vim $HOME/queries/last-session.csv</code> (most likely, just update with the session's date)</p>
<div class="language-text highlight"><span class="filename">mydata-onesession.csv</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>PatientID,StudyDate
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>2022_11_07*,20230503
</span></code></pre></div>
</li>
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Prepare and run PACSMAN, pointing the output to the mounted directory.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>pacsman<span class="w"> </span>--save<span class="w"> </span>-q<span class="w"> </span><span class="nv">$HOME</span>/queries/last-session.csv<span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">       </span>--out_directory<span class="w"> </span><span class="nv">$HOME</span>/data/hcph-pilot/<span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">       </span>--config<span class="w"> </span>/opt/PACSMAN/files/config.json
</span></code></pre></div>
</li>
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Unmount the remote filesystem:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>sudo<span class="w"> </span>umount<span class="w"> </span><span class="nv">$HOME</span>/data/hcph-pilot
</span></code></pre></div>
</li>
</ul>
<h3 id="retrieve-physiological-recordings">Retrieve physiological recordings<a class="headerlink" href="#retrieve-physiological-recordings" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Check that the <em>AcqKnowledge</em> file(s) corresponding to the session were added to the <em>Dropbox</em> shared folder and completely uploaded from ████.</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Check that <em>Psychopy</em>'s logs and <abbr title="eye tracker">ET</abbr>'s <code>.EDF</code> files corresponding to the session were added to the <em>Dropbox</em> shared folder and completely uploaded from ████.</li>
</ul>
<h2 id="within-two-weeks-after-the-completed-session">Within two weeks after the completed session<a class="headerlink" href="#within-two-weeks-after-the-completed-session" title="Permanent link">&para;</a></h2>
<h3 id="convert-imaging-data-to-bids-with-heudiconv">Convert imaging data to <abbr title="Brain Imaging Data Structure">BIDS</abbr> with <em>HeuDiConv</em><a class="headerlink" href="#convert-imaging-data-to-bids-with-heudiconv" title="Permanent link">&para;</a></h3>
<p>We use <em>HeuDiConv</em> to convert from the <abbr title="Digital Imaging and Communications in Medicine">DICOM</abbr> format generated by the scanner.
In addition, starting from the piloting session five, we abide by <em>ReproIn conventions</em>.
To support backward compatibility (and some extra, currently unsupported features by the original heuristic file), we have our own heuristic file.</p>
<details class="info">
<summary>Our custom heuristic file</summary>
<p>Our heuristic file largely derives from <a href="https://github.com/nipy/heudiconv/blob/55524168b02519bbf0a3a1c94cafb29a419728a0/heudiconv/heuristics/reproin.py"><em>ReproIn</em>'s at the time of writing</a>.
The heuristic has a a <code class="language-python highlight"><span class="n">protocols2fix</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span></code> (<a href="#__codelineno-6-113">lines 113-148</a>), where replacement patterns to permit backward compatibility are written.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">  1</a></span>
<span class="normal"><a href="#__codelineno-4-2">  2</a></span>
<span class="normal"><a href="#__codelineno-4-3">  3</a></span>
<span class="normal"><a href="#__codelineno-4-4">  4</a></span>
<span class="normal"><a href="#__codelineno-4-5">  5</a></span>
<span class="normal"><a href="#__codelineno-4-6">  6</a></span>
<span class="normal"><a href="#__codelineno-4-7">  7</a></span>
<span class="normal"><a href="#__codelineno-4-8">  8</a></span>
<span class="normal"><a href="#__codelineno-4-9">  9</a></span>
<span class="normal"><a href="#__codelineno-4-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-4-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-4-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-4-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-4-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-4-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-4-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-4-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-4-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-4-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-4-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-4-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-4-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-4-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-4-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-4-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-4-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-4-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-4-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-4-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-4-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-4-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-4-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-4-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-4-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-4-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-4-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-4-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-4-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-4-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-4-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-4-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-4-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-4-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-4-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-4-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-4-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-4-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-4-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-4-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-4-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-4-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-4-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-4-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-4-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-4-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-4-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-4-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-4-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-4-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-4-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-4-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-4-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-4-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-4-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-4-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-4-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-4-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-4-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-4-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-4-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-4-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-4-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-4-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-4-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-4-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-4-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-4-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-4-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-4-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-4-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-4-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-4-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-4-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-4-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-4-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-4-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-4-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-4-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-4-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-4-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-4-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-4-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-4-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-4-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-4-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-4-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-4-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-4-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-4-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-4-100">100</a></span>
<span class="normal"><a href="#__codelineno-4-101">101</a></span>
<span class="normal"><a href="#__codelineno-4-102">102</a></span>
<span class="normal"><a href="#__codelineno-4-103">103</a></span>
<span class="normal"><a href="#__codelineno-4-104">104</a></span>
<span class="normal"><a href="#__codelineno-4-105">105</a></span>
<span class="normal"><a href="#__codelineno-4-106">106</a></span>
<span class="normal"><a href="#__codelineno-4-107">107</a></span>
<span class="normal"><a href="#__codelineno-4-108">108</a></span>
<span class="normal"><a href="#__codelineno-4-109">109</a></span>
<span class="normal"><a href="#__codelineno-4-110">110</a></span>
<span class="normal"><a href="#__codelineno-4-111">111</a></span>
<span class="normal"><a href="#__codelineno-4-112">112</a></span>
<span class="normal"><a href="#__codelineno-4-113">113</a></span>
<span class="normal"><a href="#__codelineno-4-114">114</a></span>
<span class="normal"><a href="#__codelineno-4-115">115</a></span>
<span class="normal"><a href="#__codelineno-4-116">116</a></span>
<span class="normal"><a href="#__codelineno-4-117">117</a></span>
<span class="normal"><a href="#__codelineno-4-118">118</a></span>
<span class="normal"><a href="#__codelineno-4-119">119</a></span>
<span class="normal"><a href="#__codelineno-4-120">120</a></span>
<span class="normal"><a href="#__codelineno-4-121">121</a></span>
<span class="normal"><a href="#__codelineno-4-122">122</a></span>
<span class="normal"><a href="#__codelineno-4-123">123</a></span>
<span class="normal"><a href="#__codelineno-4-124">124</a></span>
<span class="normal"><a href="#__codelineno-4-125">125</a></span>
<span class="normal"><a href="#__codelineno-4-126">126</a></span>
<span class="normal"><a href="#__codelineno-4-127">127</a></span>
<span class="normal"><a href="#__codelineno-4-128">128</a></span>
<span class="normal"><a href="#__codelineno-4-129">129</a></span>
<span class="normal"><a href="#__codelineno-4-130">130</a></span>
<span class="normal"><a href="#__codelineno-4-131">131</a></span>
<span class="normal"><a href="#__codelineno-4-132">132</a></span>
<span class="normal"><a href="#__codelineno-4-133">133</a></span>
<span class="normal"><a href="#__codelineno-4-134">134</a></span>
<span class="normal"><a href="#__codelineno-4-135">135</a></span>
<span class="normal"><a href="#__codelineno-4-136">136</a></span>
<span class="normal"><a href="#__codelineno-4-137">137</a></span>
<span class="normal"><a href="#__codelineno-4-138">138</a></span>
<span class="normal"><a href="#__codelineno-4-139">139</a></span>
<span class="normal"><a href="#__codelineno-4-140">140</a></span>
<span class="normal"><a href="#__codelineno-4-141">141</a></span>
<span class="normal"><a href="#__codelineno-4-142">142</a></span>
<span class="normal"><a href="#__codelineno-4-143">143</a></span>
<span class="normal"><a href="#__codelineno-4-144">144</a></span>
<span class="normal"><a href="#__codelineno-4-145">145</a></span>
<span class="normal"><a href="#__codelineno-4-146">146</a></span>
<span class="normal"><a href="#__codelineno-4-147">147</a></span>
<span class="normal"><a href="#__codelineno-4-148">148</a></span>
<span class="normal"><a href="#__codelineno-4-149">149</a></span>
<span class="normal"><a href="#__codelineno-4-150">150</a></span>
<span class="normal"><a href="#__codelineno-4-151">151</a></span>
<span class="normal"><a href="#__codelineno-4-152">152</a></span>
<span class="normal"><a href="#__codelineno-4-153">153</a></span>
<span class="normal"><a href="#__codelineno-4-154">154</a></span>
<span class="normal"><a href="#__codelineno-4-155">155</a></span>
<span class="normal"><a href="#__codelineno-4-156">156</a></span>
<span class="normal"><a href="#__codelineno-4-157">157</a></span>
<span class="normal"><a href="#__codelineno-4-158">158</a></span>
<span class="normal"><a href="#__codelineno-4-159">159</a></span>
<span class="normal"><a href="#__codelineno-4-160">160</a></span>
<span class="normal"><a href="#__codelineno-4-161">161</a></span>
<span class="normal"><a href="#__codelineno-4-162">162</a></span>
<span class="normal"><a href="#__codelineno-4-163">163</a></span>
<span class="normal"><a href="#__codelineno-4-164">164</a></span>
<span class="normal"><a href="#__codelineno-4-165">165</a></span>
<span class="normal"><a href="#__codelineno-4-166">166</a></span>
<span class="normal"><a href="#__codelineno-4-167">167</a></span>
<span class="normal"><a href="#__codelineno-4-168">168</a></span>
<span class="normal"><a href="#__codelineno-4-169">169</a></span>
<span class="normal"><a href="#__codelineno-4-170">170</a></span>
<span class="normal"><a href="#__codelineno-4-171">171</a></span>
<span class="normal"><a href="#__codelineno-4-172">172</a></span>
<span class="normal"><a href="#__codelineno-4-173">173</a></span>
<span class="normal"><a href="#__codelineno-4-174">174</a></span>
<span class="normal"><a href="#__codelineno-4-175">175</a></span>
<span class="normal"><a href="#__codelineno-4-176">176</a></span>
<span class="normal"><a href="#__codelineno-4-177">177</a></span>
<span class="normal"><a href="#__codelineno-4-178">178</a></span>
<span class="normal"><a href="#__codelineno-4-179">179</a></span>
<span class="normal"><a href="#__codelineno-4-180">180</a></span>
<span class="normal"><a href="#__codelineno-4-181">181</a></span>
<span class="normal"><a href="#__codelineno-4-182">182</a></span>
<span class="normal"><a href="#__codelineno-4-183">183</a></span>
<span class="normal"><a href="#__codelineno-4-184">184</a></span>
<span class="normal"><a href="#__codelineno-4-185">185</a></span>
<span class="normal"><a href="#__codelineno-4-186">186</a></span>
<span class="normal"><a href="#__codelineno-4-187">187</a></span>
<span class="normal"><a href="#__codelineno-4-188">188</a></span>
<span class="normal"><a href="#__codelineno-4-189">189</a></span>
<span class="normal"><a href="#__codelineno-4-190">190</a></span>
<span class="normal"><a href="#__codelineno-4-191">191</a></span>
<span class="normal"><a href="#__codelineno-4-192">192</a></span>
<span class="normal"><a href="#__codelineno-4-193">193</a></span>
<span class="normal"><a href="#__codelineno-4-194">194</a></span>
<span class="normal"><a href="#__codelineno-4-195">195</a></span>
<span class="normal"><a href="#__codelineno-4-196">196</a></span>
<span class="normal"><a href="#__codelineno-4-197">197</a></span>
<span class="normal"><a href="#__codelineno-4-198">198</a></span>
<span class="normal"><a href="#__codelineno-4-199">199</a></span>
<span class="normal"><a href="#__codelineno-4-200">200</a></span>
<span class="normal"><a href="#__codelineno-4-201">201</a></span>
<span class="normal"><a href="#__codelineno-4-202">202</a></span>
<span class="normal"><a href="#__codelineno-4-203">203</a></span>
<span class="normal"><a href="#__codelineno-4-204">204</a></span>
<span class="normal"><a href="#__codelineno-4-205">205</a></span>
<span class="normal"><a href="#__codelineno-4-206">206</a></span>
<span class="normal"><a href="#__codelineno-4-207">207</a></span>
<span class="normal"><a href="#__codelineno-4-208">208</a></span>
<span class="normal"><a href="#__codelineno-4-209">209</a></span>
<span class="normal"><a href="#__codelineno-4-210">210</a></span>
<span class="normal"><a href="#__codelineno-4-211">211</a></span>
<span class="normal"><a href="#__codelineno-4-212">212</a></span>
<span class="normal"><a href="#__codelineno-4-213">213</a></span>
<span class="normal"><a href="#__codelineno-4-214">214</a></span>
<span class="normal"><a href="#__codelineno-4-215">215</a></span>
<span class="normal"><a href="#__codelineno-4-216">216</a></span>
<span class="normal"><a href="#__codelineno-4-217">217</a></span>
<span class="normal"><a href="#__codelineno-4-218">218</a></span>
<span class="normal"><a href="#__codelineno-4-219">219</a></span>
<span class="normal"><a href="#__codelineno-4-220">220</a></span>
<span class="normal"><a href="#__codelineno-4-221">221</a></span>
<span class="normal"><a href="#__codelineno-4-222">222</a></span>
<span class="normal"><a href="#__codelineno-4-223">223</a></span>
<span class="normal"><a href="#__codelineno-4-224">224</a></span>
<span class="normal"><a href="#__codelineno-4-225">225</a></span>
<span class="normal"><a href="#__codelineno-4-226">226</a></span>
<span class="normal"><a href="#__codelineno-4-227">227</a></span>
<span class="normal"><a href="#__codelineno-4-228">228</a></span>
<span class="normal"><a href="#__codelineno-4-229">229</a></span>
<span class="normal"><a href="#__codelineno-4-230">230</a></span>
<span class="normal"><a href="#__codelineno-4-231">231</a></span>
<span class="normal"><a href="#__codelineno-4-232">232</a></span>
<span class="normal"><a href="#__codelineno-4-233">233</a></span>
<span class="normal"><a href="#__codelineno-4-234">234</a></span>
<span class="normal"><a href="#__codelineno-4-235">235</a></span>
<span class="normal"><a href="#__codelineno-4-236">236</a></span>
<span class="normal"><a href="#__codelineno-4-237">237</a></span>
<span class="normal"><a href="#__codelineno-4-238">238</a></span>
<span class="normal"><a href="#__codelineno-4-239">239</a></span>
<span class="normal"><a href="#__codelineno-4-240">240</a></span>
<span class="normal"><a href="#__codelineno-4-241">241</a></span>
<span class="normal"><a href="#__codelineno-4-242">242</a></span>
<span class="normal"><a href="#__codelineno-4-243">243</a></span>
<span class="normal"><a href="#__codelineno-4-244">244</a></span>
<span class="normal"><a href="#__codelineno-4-245">245</a></span>
<span class="normal"><a href="#__codelineno-4-246">246</a></span>
<span class="normal"><a href="#__codelineno-4-247">247</a></span>
<span class="normal"><a href="#__codelineno-4-248">248</a></span>
<span class="normal"><a href="#__codelineno-4-249">249</a></span>
<span class="normal"><a href="#__codelineno-4-250">250</a></span>
<span class="normal"><a href="#__codelineno-4-251">251</a></span>
<span class="normal"><a href="#__codelineno-4-252">252</a></span>
<span class="normal"><a href="#__codelineno-4-253">253</a></span>
<span class="normal"><a href="#__codelineno-4-254">254</a></span>
<span class="normal"><a href="#__codelineno-4-255">255</a></span>
<span class="normal"><a href="#__codelineno-4-256">256</a></span>
<span class="normal"><a href="#__codelineno-4-257">257</a></span>
<span class="normal"><a href="#__codelineno-4-258">258</a></span>
<span class="normal"><a href="#__codelineno-4-259">259</a></span>
<span class="normal"><a href="#__codelineno-4-260">260</a></span>
<span class="normal"><a href="#__codelineno-4-261">261</a></span>
<span class="normal"><a href="#__codelineno-4-262">262</a></span>
<span class="normal"><a href="#__codelineno-4-263">263</a></span>
<span class="normal"><a href="#__codelineno-4-264">264</a></span>
<span class="normal"><a href="#__codelineno-4-265">265</a></span>
<span class="normal"><a href="#__codelineno-4-266">266</a></span>
<span class="normal"><a href="#__codelineno-4-267">267</a></span>
<span class="normal"><a href="#__codelineno-4-268">268</a></span>
<span class="normal"><a href="#__codelineno-4-269">269</a></span>
<span class="normal"><a href="#__codelineno-4-270">270</a></span>
<span class="normal"><a href="#__codelineno-4-271">271</a></span>
<span class="normal"><a href="#__codelineno-4-272">272</a></span>
<span class="normal"><a href="#__codelineno-4-273">273</a></span>
<span class="normal"><a href="#__codelineno-4-274">274</a></span>
<span class="normal"><a href="#__codelineno-4-275">275</a></span>
<span class="normal"><a href="#__codelineno-4-276">276</a></span>
<span class="normal"><a href="#__codelineno-4-277">277</a></span>
<span class="normal"><a href="#__codelineno-4-278">278</a></span>
<span class="normal"><a href="#__codelineno-4-279">279</a></span>
<span class="normal"><a href="#__codelineno-4-280">280</a></span>
<span class="normal"><a href="#__codelineno-4-281">281</a></span>
<span class="normal"><a href="#__codelineno-4-282">282</a></span>
<span class="normal"><a href="#__codelineno-4-283">283</a></span>
<span class="normal"><a href="#__codelineno-4-284">284</a></span>
<span class="normal"><a href="#__codelineno-4-285">285</a></span>
<span class="normal"><a href="#__codelineno-4-286">286</a></span>
<span class="normal"><a href="#__codelineno-4-287">287</a></span>
<span class="normal"><a href="#__codelineno-4-288">288</a></span>
<span class="normal"><a href="#__codelineno-4-289">289</a></span>
<span class="normal"><a href="#__codelineno-4-290">290</a></span>
<span class="normal"><a href="#__codelineno-4-291">291</a></span>
<span class="normal"><a href="#__codelineno-4-292">292</a></span>
<span class="normal"><a href="#__codelineno-4-293">293</a></span>
<span class="normal"><a href="#__codelineno-4-294">294</a></span>
<span class="normal"><a href="#__codelineno-4-295">295</a></span>
<span class="normal"><a href="#__codelineno-4-296">296</a></span>
<span class="normal"><a href="#__codelineno-4-297">297</a></span>
<span class="normal"><a href="#__codelineno-4-298">298</a></span>
<span class="normal"><a href="#__codelineno-4-299">299</a></span>
<span class="normal"><a href="#__codelineno-4-300">300</a></span>
<span class="normal"><a href="#__codelineno-4-301">301</a></span>
<span class="normal"><a href="#__codelineno-4-302">302</a></span>
<span class="normal"><a href="#__codelineno-4-303">303</a></span>
<span class="normal"><a href="#__codelineno-4-304">304</a></span>
<span class="normal"><a href="#__codelineno-4-305">305</a></span>
<span class="normal"><a href="#__codelineno-4-306">306</a></span>
<span class="normal"><a href="#__codelineno-4-307">307</a></span>
<span class="normal"><a href="#__codelineno-4-308">308</a></span>
<span class="normal"><a href="#__codelineno-4-309">309</a></span>
<span class="normal"><a href="#__codelineno-4-310">310</a></span>
<span class="normal"><a href="#__codelineno-4-311">311</a></span>
<span class="normal"><a href="#__codelineno-4-312">312</a></span>
<span class="normal"><a href="#__codelineno-4-313">313</a></span>
<span class="normal"><a href="#__codelineno-4-314">314</a></span>
<span class="normal"><a href="#__codelineno-4-315">315</a></span>
<span class="normal"><a href="#__codelineno-4-316">316</a></span>
<span class="normal"><a href="#__codelineno-4-317">317</a></span>
<span class="normal"><a href="#__codelineno-4-318">318</a></span>
<span class="normal"><a href="#__codelineno-4-319">319</a></span>
<span class="normal"><a href="#__codelineno-4-320">320</a></span>
<span class="normal"><a href="#__codelineno-4-321">321</a></span>
<span class="normal"><a href="#__codelineno-4-322">322</a></span>
<span class="normal"><a href="#__codelineno-4-323">323</a></span>
<span class="normal"><a href="#__codelineno-4-324">324</a></span>
<span class="normal"><a href="#__codelineno-4-325">325</a></span>
<span class="normal"><a href="#__codelineno-4-326">326</a></span>
<span class="normal"><a href="#__codelineno-4-327">327</a></span>
<span class="normal"><a href="#__codelineno-4-328">328</a></span>
<span class="normal"><a href="#__codelineno-4-329">329</a></span>
<span class="normal"><a href="#__codelineno-4-330">330</a></span>
<span class="normal"><a href="#__codelineno-4-331">331</a></span>
<span class="normal"><a href="#__codelineno-4-332">332</a></span>
<span class="normal"><a href="#__codelineno-4-333">333</a></span>
<span class="normal"><a href="#__codelineno-4-334">334</a></span>
<span class="normal"><a href="#__codelineno-4-335">335</a></span>
<span class="normal"><a href="#__codelineno-4-336">336</a></span>
<span class="normal"><a href="#__codelineno-4-337">337</a></span>
<span class="normal"><a href="#__codelineno-4-338">338</a></span>
<span class="normal"><a href="#__codelineno-4-339">339</a></span>
<span class="normal"><a href="#__codelineno-4-340">340</a></span>
<span class="normal"><a href="#__codelineno-4-341">341</a></span>
<span class="normal"><a href="#__codelineno-4-342">342</a></span>
<span class="normal"><a href="#__codelineno-4-343">343</a></span>
<span class="normal"><a href="#__codelineno-4-344">344</a></span>
<span class="normal"><a href="#__codelineno-4-345">345</a></span>
<span class="normal"><a href="#__codelineno-4-346">346</a></span>
<span class="normal"><a href="#__codelineno-4-347">347</a></span>
<span class="normal"><a href="#__codelineno-4-348">348</a></span>
<span class="normal"><a href="#__codelineno-4-349">349</a></span>
<span class="normal"><a href="#__codelineno-4-350">350</a></span>
<span class="normal"><a href="#__codelineno-4-351">351</a></span>
<span class="normal"><a href="#__codelineno-4-352">352</a></span>
<span class="normal"><a href="#__codelineno-4-353">353</a></span>
<span class="normal"><a href="#__codelineno-4-354">354</a></span>
<span class="normal"><a href="#__codelineno-4-355">355</a></span>
<span class="normal"><a href="#__codelineno-4-356">356</a></span>
<span class="normal"><a href="#__codelineno-4-357">357</a></span>
<span class="normal"><a href="#__codelineno-4-358">358</a></span>
<span class="normal"><a href="#__codelineno-4-359">359</a></span>
<span class="normal"><a href="#__codelineno-4-360">360</a></span>
<span class="normal"><a href="#__codelineno-4-361">361</a></span>
<span class="normal"><a href="#__codelineno-4-362">362</a></span>
<span class="normal"><a href="#__codelineno-4-363">363</a></span>
<span class="normal"><a href="#__codelineno-4-364">364</a></span>
<span class="normal"><a href="#__codelineno-4-365">365</a></span>
<span class="normal"><a href="#__codelineno-4-366">366</a></span>
<span class="normal"><a href="#__codelineno-4-367">367</a></span>
<span class="normal"><a href="#__codelineno-4-368">368</a></span>
<span class="normal"><a href="#__codelineno-4-369">369</a></span>
<span class="normal"><a href="#__codelineno-4-370">370</a></span>
<span class="normal"><a href="#__codelineno-4-371">371</a></span>
<span class="normal"><a href="#__codelineno-4-372">372</a></span>
<span class="normal"><a href="#__codelineno-4-373">373</a></span>
<span class="normal"><a href="#__codelineno-4-374">374</a></span>
<span class="normal"><a href="#__codelineno-4-375">375</a></span>
<span class="normal"><a href="#__codelineno-4-376">376</a></span>
<span class="normal"><a href="#__codelineno-4-377">377</a></span>
<span class="normal"><a href="#__codelineno-4-378">378</a></span>
<span class="normal"><a href="#__codelineno-4-379">379</a></span>
<span class="normal"><a href="#__codelineno-4-380">380</a></span>
<span class="normal"><a href="#__codelineno-4-381">381</a></span>
<span class="normal"><a href="#__codelineno-4-382">382</a></span>
<span class="normal"><a href="#__codelineno-4-383">383</a></span>
<span class="normal"><a href="#__codelineno-4-384">384</a></span>
<span class="normal"><a href="#__codelineno-4-385">385</a></span>
<span class="normal"><a href="#__codelineno-4-386">386</a></span>
<span class="normal"><a href="#__codelineno-4-387">387</a></span>
<span class="normal"><a href="#__codelineno-4-388">388</a></span>
<span class="normal"><a href="#__codelineno-4-389">389</a></span>
<span class="normal"><a href="#__codelineno-4-390">390</a></span>
<span class="normal"><a href="#__codelineno-4-391">391</a></span>
<span class="normal"><a href="#__codelineno-4-392">392</a></span>
<span class="normal"><a href="#__codelineno-4-393">393</a></span>
<span class="normal"><a href="#__codelineno-4-394">394</a></span>
<span class="normal"><a href="#__codelineno-4-395">395</a></span>
<span class="normal"><a href="#__codelineno-4-396">396</a></span>
<span class="normal"><a href="#__codelineno-4-397">397</a></span>
<span class="normal"><a href="#__codelineno-4-398">398</a></span>
<span class="normal"><a href="#__codelineno-4-399">399</a></span>
<span class="normal"><a href="#__codelineno-4-400">400</a></span>
<span class="normal"><a href="#__codelineno-4-401">401</a></span>
<span class="normal"><a href="#__codelineno-4-402">402</a></span>
<span class="normal"><a href="#__codelineno-4-403">403</a></span>
<span class="normal"><a href="#__codelineno-4-404">404</a></span>
<span class="normal"><a href="#__codelineno-4-405">405</a></span>
<span class="normal"><a href="#__codelineno-4-406">406</a></span>
<span class="normal"><a href="#__codelineno-4-407">407</a></span>
<span class="normal"><a href="#__codelineno-4-408">408</a></span>
<span class="normal"><a href="#__codelineno-4-409">409</a></span>
<span class="normal"><a href="#__codelineno-4-410">410</a></span>
<span class="normal"><a href="#__codelineno-4-411">411</a></span>
<span class="normal"><a href="#__codelineno-4-412">412</a></span>
<span class="normal"><a href="#__codelineno-4-413">413</a></span>
<span class="normal"><a href="#__codelineno-4-414">414</a></span>
<span class="normal"><a href="#__codelineno-4-415">415</a></span>
<span class="normal"><a href="#__codelineno-4-416">416</a></span>
<span class="normal"><a href="#__codelineno-4-417">417</a></span>
<span class="normal"><a href="#__codelineno-4-418">418</a></span>
<span class="normal"><a href="#__codelineno-4-419">419</a></span>
<span class="normal"><a href="#__codelineno-4-420">420</a></span>
<span class="normal"><a href="#__codelineno-4-421">421</a></span>
<span class="normal"><a href="#__codelineno-4-422">422</a></span>
<span class="normal"><a href="#__codelineno-4-423">423</a></span>
<span class="normal"><a href="#__codelineno-4-424">424</a></span>
<span class="normal"><a href="#__codelineno-4-425">425</a></span>
<span class="normal"><a href="#__codelineno-4-426">426</a></span>
<span class="normal"><a href="#__codelineno-4-427">427</a></span>
<span class="normal"><a href="#__codelineno-4-428">428</a></span>
<span class="normal"><a href="#__codelineno-4-429">429</a></span>
<span class="normal"><a href="#__codelineno-4-430">430</a></span>
<span class="normal"><a href="#__codelineno-4-431">431</a></span>
<span class="normal"><a href="#__codelineno-4-432">432</a></span>
<span class="normal"><a href="#__codelineno-4-433">433</a></span>
<span class="normal"><a href="#__codelineno-4-434">434</a></span>
<span class="normal"><a href="#__codelineno-4-435">435</a></span>
<span class="normal"><a href="#__codelineno-4-436">436</a></span>
<span class="normal"><a href="#__codelineno-4-437">437</a></span>
<span class="normal"><a href="#__codelineno-4-438">438</a></span>
<span class="normal"><a href="#__codelineno-4-439">439</a></span>
<span class="normal"><a href="#__codelineno-4-440">440</a></span>
<span class="normal"><a href="#__codelineno-4-441">441</a></span>
<span class="normal"><a href="#__codelineno-4-442">442</a></span>
<span class="normal"><a href="#__codelineno-4-443">443</a></span>
<span class="normal"><a href="#__codelineno-4-444">444</a></span>
<span class="normal"><a href="#__codelineno-4-445">445</a></span>
<span class="normal"><a href="#__codelineno-4-446">446</a></span>
<span class="normal"><a href="#__codelineno-4-447">447</a></span>
<span class="normal"><a href="#__codelineno-4-448">448</a></span>
<span class="normal"><a href="#__codelineno-4-449">449</a></span>
<span class="normal"><a href="#__codelineno-4-450">450</a></span>
<span class="normal"><a href="#__codelineno-4-451">451</a></span>
<span class="normal"><a href="#__codelineno-4-452">452</a></span>
<span class="normal"><a href="#__codelineno-4-453">453</a></span>
<span class="normal"><a href="#__codelineno-4-454">454</a></span>
<span class="normal"><a href="#__codelineno-4-455">455</a></span>
<span class="normal"><a href="#__codelineno-4-456">456</a></span>
<span class="normal"><a href="#__codelineno-4-457">457</a></span>
<span class="normal"><a href="#__codelineno-4-458">458</a></span>
<span class="normal"><a href="#__codelineno-4-459">459</a></span>
<span class="normal"><a href="#__codelineno-4-460">460</a></span>
<span class="normal"><a href="#__codelineno-4-461">461</a></span>
<span class="normal"><a href="#__codelineno-4-462">462</a></span>
<span class="normal"><a href="#__codelineno-4-463">463</a></span>
<span class="normal"><a href="#__codelineno-4-464">464</a></span>
<span class="normal"><a href="#__codelineno-4-465">465</a></span>
<span class="normal"><a href="#__codelineno-4-466">466</a></span>
<span class="normal"><a href="#__codelineno-4-467">467</a></span>
<span class="normal"><a href="#__codelineno-4-468">468</a></span>
<span class="normal"><a href="#__codelineno-4-469">469</a></span>
<span class="normal"><a href="#__codelineno-4-470">470</a></span>
<span class="normal"><a href="#__codelineno-4-471">471</a></span>
<span class="normal"><a href="#__codelineno-4-472">472</a></span>
<span class="normal"><a href="#__codelineno-4-473">473</a></span>
<span class="normal"><a href="#__codelineno-4-474">474</a></span>
<span class="normal"><a href="#__codelineno-4-475">475</a></span>
<span class="normal"><a href="#__codelineno-4-476">476</a></span>
<span class="normal"><a href="#__codelineno-4-477">477</a></span>
<span class="normal"><a href="#__codelineno-4-478">478</a></span>
<span class="normal"><a href="#__codelineno-4-479">479</a></span>
<span class="normal"><a href="#__codelineno-4-480">480</a></span>
<span class="normal"><a href="#__codelineno-4-481">481</a></span>
<span class="normal"><a href="#__codelineno-4-482">482</a></span>
<span class="normal"><a href="#__codelineno-4-483">483</a></span>
<span class="normal"><a href="#__codelineno-4-484">484</a></span>
<span class="normal"><a href="#__codelineno-4-485">485</a></span>
<span class="normal"><a href="#__codelineno-4-486">486</a></span>
<span class="normal"><a href="#__codelineno-4-487">487</a></span>
<span class="normal"><a href="#__codelineno-4-488">488</a></span>
<span class="normal"><a href="#__codelineno-4-489">489</a></span>
<span class="normal"><a href="#__codelineno-4-490">490</a></span>
<span class="normal"><a href="#__codelineno-4-491">491</a></span>
<span class="normal"><a href="#__codelineno-4-492">492</a></span>
<span class="normal"><a href="#__codelineno-4-493">493</a></span>
<span class="normal"><a href="#__codelineno-4-494">494</a></span>
<span class="normal"><a href="#__codelineno-4-495">495</a></span>
<span class="normal"><a href="#__codelineno-4-496">496</a></span>
<span class="normal"><a href="#__codelineno-4-497">497</a></span>
<span class="normal"><a href="#__codelineno-4-498">498</a></span>
<span class="normal"><a href="#__codelineno-4-499">499</a></span>
<span class="normal"><a href="#__codelineno-4-500">500</a></span>
<span class="normal"><a href="#__codelineno-4-501">501</a></span>
<span class="normal"><a href="#__codelineno-4-502">502</a></span>
<span class="normal"><a href="#__codelineno-4-503">503</a></span>
<span class="normal"><a href="#__codelineno-4-504">504</a></span>
<span class="normal"><a href="#__codelineno-4-505">505</a></span>
<span class="normal"><a href="#__codelineno-4-506">506</a></span>
<span class="normal"><a href="#__codelineno-4-507">507</a></span>
<span class="normal"><a href="#__codelineno-4-508">508</a></span>
<span class="normal"><a href="#__codelineno-4-509">509</a></span>
<span class="normal"><a href="#__codelineno-4-510">510</a></span>
<span class="normal"><a href="#__codelineno-4-511">511</a></span>
<span class="normal"><a href="#__codelineno-4-512">512</a></span>
<span class="normal"><a href="#__codelineno-4-513">513</a></span>
<span class="normal"><a href="#__codelineno-4-514">514</a></span>
<span class="normal"><a href="#__codelineno-4-515">515</a></span>
<span class="normal"><a href="#__codelineno-4-516">516</a></span>
<span class="normal"><a href="#__codelineno-4-517">517</a></span>
<span class="normal"><a href="#__codelineno-4-518">518</a></span>
<span class="normal"><a href="#__codelineno-4-519">519</a></span>
<span class="normal"><a href="#__codelineno-4-520">520</a></span>
<span class="normal"><a href="#__codelineno-4-521">521</a></span>
<span class="normal"><a href="#__codelineno-4-522">522</a></span>
<span class="normal"><a href="#__codelineno-4-523">523</a></span>
<span class="normal"><a href="#__codelineno-4-524">524</a></span>
<span class="normal"><a href="#__codelineno-4-525">525</a></span>
<span class="normal"><a href="#__codelineno-4-526">526</a></span>
<span class="normal"><a href="#__codelineno-4-527">527</a></span>
<span class="normal"><a href="#__codelineno-4-528">528</a></span>
<span class="normal"><a href="#__codelineno-4-529">529</a></span>
<span class="normal"><a href="#__codelineno-4-530">530</a></span>
<span class="normal"><a href="#__codelineno-4-531">531</a></span>
<span class="normal"><a href="#__codelineno-4-532">532</a></span>
<span class="normal"><a href="#__codelineno-4-533">533</a></span>
<span class="normal"><a href="#__codelineno-4-534">534</a></span>
<span class="normal"><a href="#__codelineno-4-535">535</a></span>
<span class="normal"><a href="#__codelineno-4-536">536</a></span>
<span class="normal"><a href="#__codelineno-4-537">537</a></span>
<span class="normal"><a href="#__codelineno-4-538">538</a></span>
<span class="normal"><a href="#__codelineno-4-539">539</a></span>
<span class="normal"><a href="#__codelineno-4-540">540</a></span>
<span class="normal"><a href="#__codelineno-4-541">541</a></span>
<span class="normal"><a href="#__codelineno-4-542">542</a></span>
<span class="normal"><a href="#__codelineno-4-543">543</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c1"># emacs: -*- mode: python; py-indent-offset: 4; indent-tabs-mode: nil -*-</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="c1"># vi: set ft=python sts=4 ts=4 sw=4 et:</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="c1">#</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="c1"># Copyright 2023 The Axon Lab &lt;theaxonlab@gmail.com&gt;</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="c1">#</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="c1"># you may not use this file except in compliance with the License.</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="c1"># You may obtain a copy of the License at</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="c1">#</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="c1">#</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="c1"># See the License for the specific language governing permissions and</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="c1"># limitations under the License.</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="c1">#</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18"></a><span class="c1"># We support and encourage derived works from this project, please read</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19"></a><span class="c1"># about our expectations at</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20"></a><span class="c1">#</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21"></a><span class="c1">#     https://www.nipreps.org/community/licensing/</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22"></a><span class="c1">#</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23"></a><span class="c1"># STATEMENT OF CHANGES: This file is derived from sources licensed under the Apache-2.0 terms,</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24"></a><span class="c1"># and this file has been changed.</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25"></a><span class="c1"># The original file this work derives from is found at:</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26"></a><span class="c1"># https://github.com/nipy/heudiconv/blob/55524168b02519bbf0a3a1c94cafb29a419728a0/heudiconv/heuristics/reproin.py</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27"></a><span class="c1">#</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28"></a><span class="c1"># ORIGINAL WORK&#39;S ATTRIBUTION NOTICE:</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29"></a><span class="c1">#</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30"></a><span class="c1">#     Copyright [2014-2019] [Heudiconv developers]</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31"></a><span class="c1">#</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32"></a><span class="c1">#     Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33"></a><span class="c1">#     you may not use this file except in compliance with the License.</span>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34"></a><span class="c1">#     You may obtain a copy of the License at</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35"></a><span class="c1">#</span>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36"></a><span class="c1">#         http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37"></a><span class="c1">#</span>
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38"></a><span class="c1">#     Unless required by applicable law or agreed to in writing, software</span>
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39"></a><span class="c1">#     distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
</span><span id="__span-4-40"><a id="__codelineno-4-40" name="__codelineno-4-40"></a><span class="c1">#     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
</span><span id="__span-4-41"><a id="__codelineno-4-41" name="__codelineno-4-41"></a><span class="c1">#     See the License for the specific language governing permissions and</span>
</span><span id="__span-4-42"><a id="__codelineno-4-42" name="__codelineno-4-42"></a><span class="c1">#     limitations under the License.</span>
</span><span id="__span-4-43"><a id="__codelineno-4-43" name="__codelineno-4-43"></a><span class="sd">&quot;&quot;&quot;Reproin heuristic.&quot;&quot;&quot;</span>
</span><span id="__span-4-44"><a id="__codelineno-4-44" name="__codelineno-4-44"></a>
</span><span id="__span-4-45"><a id="__codelineno-4-45" name="__codelineno-4-45"></a><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
</span><span id="__span-4-46"><a id="__codelineno-4-46" name="__codelineno-4-46"></a>
</span><span id="__span-4-47"><a id="__codelineno-4-47" name="__codelineno-4-47"></a><span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>
</span><span id="__span-4-48"><a id="__codelineno-4-48" name="__codelineno-4-48"></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
</span><span id="__span-4-49"><a id="__codelineno-4-49" name="__codelineno-4-49"></a><span class="kn">import</span> <span class="nn">logging</span>
</span><span id="__span-4-50"><a id="__codelineno-4-50" name="__codelineno-4-50"></a><span class="kn">import</span> <span class="nn">re</span>
</span><span id="__span-4-51"><a id="__codelineno-4-51" name="__codelineno-4-51"></a>
</span><span id="__span-4-52"><a id="__codelineno-4-52" name="__codelineno-4-52"></a><span class="kn">import</span> <span class="nn">pydicom</span> <span class="k">as</span> <span class="nn">dcm</span>
</span><span id="__span-4-53"><a id="__codelineno-4-53" name="__codelineno-4-53"></a>
</span><span id="__span-4-54"><a id="__codelineno-4-54" name="__codelineno-4-54"></a><span class="kn">from</span> <span class="nn">heudiconv.utils</span> <span class="kn">import</span> <span class="n">SeqInfo</span>
</span><span id="__span-4-55"><a id="__codelineno-4-55" name="__codelineno-4-55"></a><span class="kn">from</span> <span class="nn">heudiconv.heuristics.reproin</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="__span-4-56"><a id="__codelineno-4-56" name="__codelineno-4-56"></a>    <span class="n">_apply_substitutions</span><span class="p">,</span>
</span><span id="__span-4-57"><a id="__codelineno-4-57" name="__codelineno-4-57"></a>    <span class="n">get_study_hash</span><span class="p">,</span>
</span><span id="__span-4-58"><a id="__codelineno-4-58" name="__codelineno-4-58"></a>    <span class="n">get_study_description</span><span class="p">,</span>
</span><span id="__span-4-59"><a id="__codelineno-4-59" name="__codelineno-4-59"></a><span class="p">)</span>
</span><span id="__span-4-60"><a id="__codelineno-4-60" name="__codelineno-4-60"></a>
</span><span id="__span-4-61"><a id="__codelineno-4-61" name="__codelineno-4-61"></a><span class="n">lgr</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;heudiconv&quot;</span><span class="p">)</span>
</span><span id="__span-4-62"><a id="__codelineno-4-62" name="__codelineno-4-62"></a>
</span><span id="__span-4-63"><a id="__codelineno-4-63" name="__codelineno-4-63"></a>
</span><span id="__span-4-64"><a id="__codelineno-4-64" name="__codelineno-4-64"></a><span class="n">DWI_RES</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-4-65"><a id="__codelineno-4-65" name="__codelineno-4-65"></a>    <span class="s2">&quot;1.6mm-iso&quot;</span><span class="p">:</span> <span class="s2">&quot;highres&quot;</span><span class="p">,</span>
</span><span id="__span-4-66"><a id="__codelineno-4-66" name="__codelineno-4-66"></a>    <span class="s2">&quot;2mm-iso&quot;</span><span class="p">:</span> <span class="s2">&quot;lowres&quot;</span><span class="p">,</span>
</span><span id="__span-4-67"><a id="__codelineno-4-67" name="__codelineno-4-67"></a><span class="p">}</span>
</span><span id="__span-4-68"><a id="__codelineno-4-68" name="__codelineno-4-68"></a>
</span><span id="__span-4-69"><a id="__codelineno-4-69" name="__codelineno-4-69"></a>
</span><span id="__span-4-70"><a id="__codelineno-4-70" name="__codelineno-4-70"></a><span class="n">IGNORE_PROTOCOLS</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-4-71"><a id="__codelineno-4-71" name="__codelineno-4-71"></a>    <span class="s2">&quot;DEV&quot;</span><span class="p">,</span>
</span><span id="__span-4-72"><a id="__codelineno-4-72" name="__codelineno-4-72"></a>    <span class="s2">&quot;LABEL&quot;</span><span class="p">,</span>
</span><span id="__span-4-73"><a id="__codelineno-4-73" name="__codelineno-4-73"></a>    <span class="s2">&quot;REPORT&quot;</span><span class="p">,</span>
</span><span id="__span-4-74"><a id="__codelineno-4-74" name="__codelineno-4-74"></a>    <span class="s2">&quot;ADC&quot;</span><span class="p">,</span>
</span><span id="__span-4-75"><a id="__codelineno-4-75" name="__codelineno-4-75"></a>    <span class="s2">&quot;TRACEW&quot;</span><span class="p">,</span>
</span><span id="__span-4-76"><a id="__codelineno-4-76" name="__codelineno-4-76"></a>    <span class="s2">&quot;FA&quot;</span><span class="p">,</span>
</span><span id="__span-4-77"><a id="__codelineno-4-77" name="__codelineno-4-77"></a>    <span class="s2">&quot;ColFA&quot;</span><span class="p">,</span>
</span><span id="__span-4-78"><a id="__codelineno-4-78" name="__codelineno-4-78"></a>    <span class="s2">&quot;B0&quot;</span><span class="p">,</span>
</span><span id="__span-4-79"><a id="__codelineno-4-79" name="__codelineno-4-79"></a>    <span class="s2">&quot;TENSOR&quot;</span><span class="p">,</span>
</span><span id="__span-4-80"><a id="__codelineno-4-80" name="__codelineno-4-80"></a>    <span class="s2">&quot;10meas&quot;</span><span class="p">,</span>  <span class="c1"># dismiss a trial of fmap acquisition</span>
</span><span id="__span-4-81"><a id="__codelineno-4-81" name="__codelineno-4-81"></a>    <span class="s2">&quot;testJB&quot;</span><span class="p">,</span>  <span class="c1"># dismiss a test trial of the cmrr sequence</span>
</span><span id="__span-4-82"><a id="__codelineno-4-82" name="__codelineno-4-82"></a><span class="p">)</span>
</span><span id="__span-4-83"><a id="__codelineno-4-83" name="__codelineno-4-83"></a>
</span><span id="__span-4-84"><a id="__codelineno-4-84" name="__codelineno-4-84"></a><span class="n">bids_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;_(?=(dir|acq|task|run)-([A-Za-z0-9]+))&quot;</span><span class="p">)</span>
</span><span id="__span-4-85"><a id="__codelineno-4-85" name="__codelineno-4-85"></a>
</span><span id="__span-4-86"><a id="__codelineno-4-86" name="__codelineno-4-86"></a>
</span><span id="__span-4-87"><a id="__codelineno-4-87" name="__codelineno-4-87"></a><span class="c1"># Terminology to harmonise and use to name variables etc</span>
</span><span id="__span-4-88"><a id="__codelineno-4-88" name="__codelineno-4-88"></a><span class="c1"># experiment</span>
</span><span id="__span-4-89"><a id="__codelineno-4-89" name="__codelineno-4-89"></a><span class="c1">#  subject</span>
</span><span id="__span-4-90"><a id="__codelineno-4-90" name="__codelineno-4-90"></a><span class="c1">#   [session]</span>
</span><span id="__span-4-91"><a id="__codelineno-4-91" name="__codelineno-4-91"></a><span class="c1">#    exam (AKA scanning session) - currently seqinfo, unless brought together from multiple</span>
</span><span id="__span-4-92"><a id="__codelineno-4-92" name="__codelineno-4-92"></a><span class="c1">#     series  (AKA protocol?)</span>
</span><span id="__span-4-93"><a id="__codelineno-4-93" name="__codelineno-4-93"></a><span class="c1">#      - series_spec - deduced from fields the spec (literal value)</span>
</span><span id="__span-4-94"><a id="__codelineno-4-94" name="__codelineno-4-94"></a><span class="c1">#      - series_info - the dictionary with fields parsed from series_spec</span>
</span><span id="__span-4-95"><a id="__codelineno-4-95" name="__codelineno-4-95"></a>
</span><span id="__span-4-96"><a id="__codelineno-4-96" name="__codelineno-4-96"></a><span class="c1"># Which fields in seqinfo (in this order) to check for the ReproIn spec</span>
</span><span id="__span-4-97"><a id="__codelineno-4-97" name="__codelineno-4-97"></a><span class="n">series_spec_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;protocol_name&quot;</span><span class="p">,</span> <span class="s2">&quot;series_description&quot;</span><span class="p">)</span>
</span><span id="__span-4-98"><a id="__codelineno-4-98" name="__codelineno-4-98"></a>
</span><span id="__span-4-99"><a id="__codelineno-4-99" name="__codelineno-4-99"></a><span class="c1"># dictionary from accession-number to runs that need to be marked as bad</span>
</span><span id="__span-4-100"><a id="__codelineno-4-100" name="__codelineno-4-100"></a><span class="c1"># NOTE: even if filename has number that is 0-padded, internally no padding</span>
</span><span id="__span-4-101"><a id="__codelineno-4-101" name="__codelineno-4-101"></a><span class="c1"># is done</span>
</span><span id="__span-4-102"><a id="__codelineno-4-102" name="__codelineno-4-102"></a><span class="n">fix_accession2run</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-4-103"><a id="__codelineno-4-103" name="__codelineno-4-103"></a>    <span class="c1"># e.g.:</span>
</span><span id="__span-4-104"><a id="__codelineno-4-104" name="__codelineno-4-104"></a>    <span class="c1"># &#39;A000035&#39;: [&#39;^8-&#39;, &#39;^9-&#39;],</span>
</span><span id="__span-4-105"><a id="__codelineno-4-105" name="__codelineno-4-105"></a><span class="p">}</span>
</span><span id="__span-4-106"><a id="__codelineno-4-106" name="__codelineno-4-106"></a>
</span><span id="__span-4-107"><a id="__codelineno-4-107" name="__codelineno-4-107"></a><span class="c1"># A dictionary containing fixes/remapping for sequence names per study.</span>
</span><span id="__span-4-108"><a id="__codelineno-4-108" name="__codelineno-4-108"></a><span class="c1"># Keys are md5sum of study_description from DICOMs, in the form of PI-Experimenter^protocolname</span>
</span><span id="__span-4-109"><a id="__codelineno-4-109" name="__codelineno-4-109"></a><span class="c1"># You can use `heudiconv -f reproin --command ls --files  PATH</span>
</span><span id="__span-4-110"><a id="__codelineno-4-110" name="__codelineno-4-110"></a><span class="c1"># to list the &quot;study hash&quot;.</span>
</span><span id="__span-4-111"><a id="__codelineno-4-111" name="__codelineno-4-111"></a><span class="c1"># Values are list of tuples in the form (regex_pattern, substitution).</span>
</span><span id="__span-4-112"><a id="__codelineno-4-112" name="__codelineno-4-112"></a><span class="c1"># If the  key is an empty string`&#39;&#39;&#39;&#39;`, it would apply to any study.</span>
</span><span id="__span-4-113"><a id="__codelineno-4-113" name="__codelineno-4-113"></a><span class="hll"><span class="n">protocols2fix</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span id="__span-4-114"><a id="__codelineno-4-114" name="__codelineno-4-114"></a><span class="hll">    <span class="s2">&quot;&quot;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span id="__span-4-115"><a id="__codelineno-4-115" name="__codelineno-4-115"></a><span class="hll">        <span class="p">(</span><span class="s2">&quot;t1_mprage_pre_Morpho&quot;</span><span class="p">,</span> <span class="s2">&quot;anat-T1w_acq-morphobox__mprage&quot;</span><span class="p">),</span>
</span></span><span id="__span-4-116"><a id="__codelineno-4-116" name="__codelineno-4-116"></a><span class="hll">        <span class="p">(</span>
</span></span><span id="__span-4-117"><a id="__codelineno-4-117" name="__codelineno-4-117"></a><span class="hll">            <span class="s2">&quot;micro_struct_137dir_BIPOLAR_b3000_1.6mm-iso&quot;</span><span class="p">,</span>
</span></span><span id="__span-4-118"><a id="__codelineno-4-118" name="__codelineno-4-118"></a><span class="hll">            <span class="s2">&quot;dwi-dwi_acq-highres_dir-unknown__137dir_bipolar&quot;</span><span class="p">,</span>
</span></span><span id="__span-4-119"><a id="__codelineno-4-119" name="__codelineno-4-119"></a><span class="hll">        <span class="p">),</span>
</span></span><span id="__span-4-120"><a id="__codelineno-4-120" name="__codelineno-4-120"></a><span class="hll">        <span class="p">(</span>
</span></span><span id="__span-4-121"><a id="__codelineno-4-121" name="__codelineno-4-121"></a><span class="hll">            <span class="s2">&quot;micro_struct_137dir_BIPOLAR_b3000_1.6mm-iso&quot;</span><span class="p">,</span>
</span></span><span id="__span-4-122"><a id="__codelineno-4-122" name="__codelineno-4-122"></a><span class="hll">            <span class="s2">&quot;dwi-dwi_acq-highres_dir-unknown__137dir_bipolar&quot;</span><span class="p">,</span>
</span></span><span id="__span-4-123"><a id="__codelineno-4-123" name="__codelineno-4-123"></a><span class="hll">        <span class="p">),</span>
</span></span><span id="__span-4-124"><a id="__codelineno-4-124" name="__codelineno-4-124"></a><span class="hll">        <span class="p">(</span>
</span></span><span id="__span-4-125"><a id="__codelineno-4-125" name="__codelineno-4-125"></a><span class="hll">            <span class="s2">&quot;micro_struct_137dir_BIPOLAR_b3000_2mm-iso&quot;</span><span class="p">,</span>
</span></span><span id="__span-4-126"><a id="__codelineno-4-126" name="__codelineno-4-126"></a><span class="hll">            <span class="s2">&quot;dwi-dwi_acq-lowres_dir-unknown__137dir_bipolar&quot;</span><span class="p">,</span>
</span></span><span id="__span-4-127"><a id="__codelineno-4-127" name="__codelineno-4-127"></a><span class="hll">        <span class="p">),</span>
</span></span><span id="__span-4-128"><a id="__codelineno-4-128" name="__codelineno-4-128"></a><span class="hll">        <span class="p">(</span><span class="s2">&quot;gre_field_mapping_1.6mmiso&quot;</span><span class="p">,</span> <span class="s2">&quot;fmap-phasediff__gre&quot;</span><span class="p">),</span>
</span></span><span id="__span-4-129"><a id="__codelineno-4-129" name="__codelineno-4-129"></a><span class="hll">        <span class="p">(</span>
</span></span><span id="__span-4-130"><a id="__codelineno-4-130" name="__codelineno-4-130"></a><span class="hll">            <span class="s2">&quot;cmrr_mbep2d_bold_me4_sms4_fa75_750meas&quot;</span><span class="p">,</span>
</span></span><span id="__span-4-131"><a id="__codelineno-4-131" name="__codelineno-4-131"></a><span class="hll">            <span class="s2">&quot;func-bold_task-rest__750meas&quot;</span><span class="p">,</span>
</span></span><span id="__span-4-132"><a id="__codelineno-4-132" name="__codelineno-4-132"></a><span class="hll">        <span class="p">),</span>
</span></span><span id="__span-4-133"><a id="__codelineno-4-133" name="__codelineno-4-133"></a><span class="hll">        <span class="p">(</span>
</span></span><span id="__span-4-134"><a id="__codelineno-4-134" name="__codelineno-4-134"></a><span class="hll">            <span class="s2">&quot;cmrr_mbep2d_bold_me4_sms4_fa80&quot;</span><span class="p">,</span>
</span></span><span id="__span-4-135"><a id="__codelineno-4-135" name="__codelineno-4-135"></a><span class="hll">            <span class="s2">&quot;func-bold_task-rest_acq-fa80__cmrr&quot;</span><span class="p">,</span>
</span></span><span id="__span-4-136"><a id="__codelineno-4-136" name="__codelineno-4-136"></a><span class="hll">        <span class="p">),</span>
</span></span><span id="__span-4-137"><a id="__codelineno-4-137" name="__codelineno-4-137"></a><span class="hll">        <span class="p">(</span>
</span></span><span id="__span-4-138"><a id="__codelineno-4-138" name="__codelineno-4-138"></a><span class="hll">            <span class="s2">&quot;cmrr_mbep2d_bold_me4_testJB&quot;</span><span class="p">,</span>
</span></span><span id="__span-4-139"><a id="__codelineno-4-139" name="__codelineno-4-139"></a><span class="hll">            <span class="s2">&quot;func-bold_task-rest_acq-testJB__cmrr&quot;</span><span class="p">,</span>
</span></span><span id="__span-4-140"><a id="__codelineno-4-140" name="__codelineno-4-140"></a><span class="hll">        <span class="p">),</span>
</span></span><span id="__span-4-141"><a id="__codelineno-4-141" name="__codelineno-4-141"></a><span class="hll">        <span class="p">(</span>
</span></span><span id="__span-4-142"><a id="__codelineno-4-142" name="__codelineno-4-142"></a><span class="hll">            <span class="s2">&quot;cmrr_mbep2d_bold_fmap_fa80&quot;</span><span class="p">,</span>
</span></span><span id="__span-4-143"><a id="__codelineno-4-143" name="__codelineno-4-143"></a><span class="hll">            <span class="s2">&quot;fmap-epi_acq-bold_dir-unknown__cmrr_mbepd2d_fa80&quot;</span><span class="p">,</span>
</span></span><span id="__span-4-144"><a id="__codelineno-4-144" name="__codelineno-4-144"></a><span class="hll">        <span class="p">),</span>
</span></span><span id="__span-4-145"><a id="__codelineno-4-145" name="__codelineno-4-145"></a><span class="hll">        <span class="p">(</span><span class="s2">&quot;cmrr_mbep2d_bold_me4_sms4&quot;</span><span class="p">,</span> <span class="s2">&quot;func-bold_task-qct__cmrr&quot;</span><span class="p">),</span>
</span></span><span id="__span-4-146"><a id="__codelineno-4-146" name="__codelineno-4-146"></a><span class="hll">        <span class="p">(</span><span class="s2">&quot;_task-qc_&quot;</span><span class="p">,</span> <span class="s2">&quot;_task-qct_&quot;</span><span class="p">),</span>
</span></span><span id="__span-4-147"><a id="__codelineno-4-147" name="__codelineno-4-147"></a><span class="hll">        <span class="p">(</span><span class="s2">&quot;anat-T2w__flair&quot;</span><span class="p">,</span> <span class="s2">&quot;anat-FLAIR__spcir&quot;</span><span class="p">),</span>
</span></span><span id="__span-4-148"><a id="__codelineno-4-148" name="__codelineno-4-148"></a><span class="hll">        <span class="p">(</span><span class="s2">&quot;AAHead_Scout_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;anat-scout&quot;</span><span class="p">),</span>
</span></span><span id="__span-4-149"><a id="__codelineno-4-149" name="__codelineno-4-149"></a>        <span class="p">(</span><span class="s2">&quot;_dir_RL&quot;</span><span class="p">,</span> <span class="s2">&quot;_dir-RL&quot;</span><span class="p">),</span>
</span><span id="__span-4-150"><a id="__codelineno-4-150" name="__codelineno-4-150"></a>        <span class="p">(</span><span class="s2">&quot;_dir_LR&quot;</span><span class="p">,</span> <span class="s2">&quot;_dir-LR&quot;</span><span class="p">),</span>
</span><span id="__span-4-151"><a id="__codelineno-4-151" name="__codelineno-4-151"></a>        <span class="p">(</span><span class="s2">&quot;_dir_AP&quot;</span><span class="p">,</span> <span class="s2">&quot;_dir-AP&quot;</span><span class="p">),</span>
</span><span id="__span-4-152"><a id="__codelineno-4-152" name="__codelineno-4-152"></a>        <span class="p">(</span><span class="s2">&quot;_dir_PA&quot;</span><span class="p">,</span> <span class="s2">&quot;_dir-PA&quot;</span><span class="p">),</span>
</span><span id="__span-4-153"><a id="__codelineno-4-153" name="__codelineno-4-153"></a>    <span class="p">]</span>
</span><span id="__span-4-154"><a id="__codelineno-4-154" name="__codelineno-4-154"></a>    <span class="c1"># e.g., QA:</span>
</span><span id="__span-4-155"><a id="__codelineno-4-155" name="__codelineno-4-155"></a>    <span class="c1"># &#39;43b67d9139e8c7274578b7451ab21123&#39;:</span>
</span><span id="__span-4-156"><a id="__codelineno-4-156" name="__codelineno-4-156"></a>    <span class="c1">#     [</span>
</span><span id="__span-4-157"><a id="__codelineno-4-157" name="__codelineno-4-157"></a>    <span class="c1">#      (&#39;BOLD_p2_s4_3\.5mm&#39;, &#39;func_task-rest_acq-p2-s4-3.5mm&#39;),</span>
</span><span id="__span-4-158"><a id="__codelineno-4-158" name="__codelineno-4-158"></a>    <span class="c1">#      (&#39;BOLD_&#39;, &#39;func_task-rest&#39;),</span>
</span><span id="__span-4-159"><a id="__codelineno-4-159" name="__codelineno-4-159"></a>    <span class="c1">#      (&#39;_p2_s4&#39;,        &#39;_acq-p2-s4&#39;),</span>
</span><span id="__span-4-160"><a id="__codelineno-4-160" name="__codelineno-4-160"></a>    <span class="c1">#      (&#39;_p2&#39;, &#39;_acq-p2&#39;),</span>
</span><span id="__span-4-161"><a id="__codelineno-4-161" name="__codelineno-4-161"></a>    <span class="c1">#     ],</span>
</span><span id="__span-4-162"><a id="__codelineno-4-162" name="__codelineno-4-162"></a>    <span class="c1"># &#39;&#39;:  # for any study example with regexes used</span>
</span><span id="__span-4-163"><a id="__codelineno-4-163" name="__codelineno-4-163"></a>    <span class="c1">#     [</span>
</span><span id="__span-4-164"><a id="__codelineno-4-164" name="__codelineno-4-164"></a>    <span class="c1">#         (&#39;AAHead_Scout_.*&#39;, &#39;anat-scout&#39;),</span>
</span><span id="__span-4-165"><a id="__codelineno-4-165" name="__codelineno-4-165"></a>    <span class="c1">#         (&#39;^dti_.*&#39;, &#39;dwi&#39;),</span>
</span><span id="__span-4-166"><a id="__codelineno-4-166" name="__codelineno-4-166"></a>    <span class="c1">#         (&#39;^.*_distortion_corr.*_([ap]+)_([12])&#39;, r&#39;fmap-epi_dir-\1_run-\2&#39;),</span>
</span><span id="__span-4-167"><a id="__codelineno-4-167" name="__codelineno-4-167"></a>    <span class="c1">#         (&#39;^(.+)_ap.*_r(0[0-9])&#39;, r&#39;func_task-\1_run-\2&#39;),</span>
</span><span id="__span-4-168"><a id="__codelineno-4-168" name="__codelineno-4-168"></a>    <span class="c1">#         (&#39;^t1w_.*&#39;, &#39;anat-T1w&#39;),</span>
</span><span id="__span-4-169"><a id="__codelineno-4-169" name="__codelineno-4-169"></a>    <span class="c1">#         # problematic case -- multiple identically named pepolar fieldmap runs</span>
</span><span id="__span-4-170"><a id="__codelineno-4-170" name="__codelineno-4-170"></a>    <span class="c1">#         # I guess we will just sacrifice ability to detect canceled runs here.</span>
</span><span id="__span-4-171"><a id="__codelineno-4-171" name="__codelineno-4-171"></a>    <span class="c1">#         # And we cannot just use _run+ since it would increment independently</span>
</span><span id="__span-4-172"><a id="__codelineno-4-172" name="__codelineno-4-172"></a>    <span class="c1">#         # for ap and then for pa.  We will rely on having ap preceding pa.</span>
</span><span id="__span-4-173"><a id="__codelineno-4-173" name="__codelineno-4-173"></a>    <span class="c1">#         # Added  _acq-mb8  so they match the one in funcs</span>
</span><span id="__span-4-174"><a id="__codelineno-4-174" name="__codelineno-4-174"></a>    <span class="c1">#         (&#39;func_task-discorr_acq-ap&#39;, r&#39;fmap-epi_dir-ap_acq-mb8_run+&#39;),</span>
</span><span id="__span-4-175"><a id="__codelineno-4-175" name="__codelineno-4-175"></a>    <span class="c1">#         (&#39;func_task-discorr_acq-pa&#39;, r&#39;fmap-epi_dir-pa_acq-mb8_run=&#39;),</span>
</span><span id="__span-4-176"><a id="__codelineno-4-176" name="__codelineno-4-176"></a>    <span class="c1"># ]</span>
</span><span id="__span-4-177"><a id="__codelineno-4-177" name="__codelineno-4-177"></a><span class="p">}</span>
</span><span id="__span-4-178"><a id="__codelineno-4-178" name="__codelineno-4-178"></a>
</span><span id="__span-4-179"><a id="__codelineno-4-179" name="__codelineno-4-179"></a><span class="c1"># list containing StudyInstanceUID to skip -- hopefully doesn&#39;t happen too often</span>
</span><span id="__span-4-180"><a id="__codelineno-4-180" name="__codelineno-4-180"></a><span class="n">dicoms2skip</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-4-181"><a id="__codelineno-4-181" name="__codelineno-4-181"></a>    <span class="c1"># e.g.</span>
</span><span id="__span-4-182"><a id="__codelineno-4-182" name="__codelineno-4-182"></a>    <span class="c1"># &#39;1.3.12.2.1107.5.2.43.66112.30000016110117002435700000001&#39;,</span>
</span><span id="__span-4-183"><a id="__codelineno-4-183" name="__codelineno-4-183"></a><span class="p">]</span>
</span><span id="__span-4-184"><a id="__codelineno-4-184" name="__codelineno-4-184"></a>
</span><span id="__span-4-185"><a id="__codelineno-4-185" name="__codelineno-4-185"></a><span class="n">DEFAULT_FIELDS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-4-186"><a id="__codelineno-4-186" name="__codelineno-4-186"></a>    <span class="c1"># Let it just be in each json file extracted</span>
</span><span id="__span-4-187"><a id="__codelineno-4-187" name="__codelineno-4-187"></a>    <span class="s2">&quot;Acknowledgements&quot;</span><span class="p">:</span> <span class="s2">&quot;See README.md.&quot;</span><span class="p">,</span>
</span><span id="__span-4-188"><a id="__codelineno-4-188" name="__codelineno-4-188"></a><span class="p">}</span>
</span><span id="__span-4-189"><a id="__codelineno-4-189" name="__codelineno-4-189"></a>
</span><span id="__span-4-190"><a id="__codelineno-4-190" name="__codelineno-4-190"></a><span class="n">POPULATE_INTENDED_FOR_OPTS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-4-191"><a id="__codelineno-4-191" name="__codelineno-4-191"></a>    <span class="s2">&quot;matching_parameters&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ImagingVolume&quot;</span><span class="p">,</span> <span class="s2">&quot;Shims&quot;</span><span class="p">],</span>
</span><span id="__span-4-192"><a id="__codelineno-4-192" name="__codelineno-4-192"></a>    <span class="s2">&quot;criterion&quot;</span><span class="p">:</span> <span class="s2">&quot;Closest&quot;</span><span class="p">,</span>
</span><span id="__span-4-193"><a id="__codelineno-4-193" name="__codelineno-4-193"></a><span class="p">}</span>
</span><span id="__span-4-194"><a id="__codelineno-4-194" name="__codelineno-4-194"></a>
</span><span id="__span-4-195"><a id="__codelineno-4-195" name="__codelineno-4-195"></a>
</span><span id="__span-4-196"><a id="__codelineno-4-196" name="__codelineno-4-196"></a><span class="k">def</span> <span class="nf">filter_dicom</span><span class="p">(</span><span class="n">dcmdata</span><span class="p">:</span> <span class="n">dcm</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-4-197"><a id="__codelineno-4-197" name="__codelineno-4-197"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if a DICOM dataset should be filtered out, else False&quot;&quot;&quot;</span>
</span><span id="__span-4-198"><a id="__codelineno-4-198" name="__codelineno-4-198"></a>    <span class="k">return</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">dcmdata</span><span class="o">.</span><span class="n">StudyInstanceUID</span> <span class="ow">in</span> <span class="n">dicoms2skip</span> <span class="k">else</span> <span class="kc">False</span>
</span><span id="__span-4-199"><a id="__codelineno-4-199" name="__codelineno-4-199"></a>
</span><span id="__span-4-200"><a id="__codelineno-4-200" name="__codelineno-4-200"></a>
</span><span id="__span-4-201"><a id="__codelineno-4-201" name="__codelineno-4-201"></a><span class="k">def</span> <span class="nf">filter_files</span><span class="p">(</span><span class="n">_fn</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="__span-4-202"><a id="__codelineno-4-202" name="__codelineno-4-202"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return True if a file should be kept, else False.</span>
</span><span id="__span-4-203"><a id="__codelineno-4-203" name="__codelineno-4-203"></a>
</span><span id="__span-4-204"><a id="__codelineno-4-204" name="__codelineno-4-204"></a><span class="sd">    ATM reproin does not do any filtering. Override if you need to add some</span>
</span><span id="__span-4-205"><a id="__codelineno-4-205" name="__codelineno-4-205"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-4-206"><a id="__codelineno-4-206" name="__codelineno-4-206"></a>    <span class="k">return</span> <span class="ow">not</span> <span class="n">_fn</span><span class="o">.</span><span class="n">endswith</span><span class="p">((</span><span class="s2">&quot;.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;.dvs&quot;</span><span class="p">))</span>
</span><span id="__span-4-207"><a id="__codelineno-4-207" name="__codelineno-4-207"></a>
</span><span id="__span-4-208"><a id="__codelineno-4-208" name="__codelineno-4-208"></a>
</span><span id="__span-4-209"><a id="__codelineno-4-209" name="__codelineno-4-209"></a><span class="k">def</span> <span class="nf">fix_canceled_runs</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SeqInfo</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SeqInfo</span><span class="p">]:</span>
</span><span id="__span-4-210"><a id="__codelineno-4-210" name="__codelineno-4-210"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Function that adds cancelme_ to known bad runs which were forgotten&quot;&quot;&quot;</span>
</span><span id="__span-4-211"><a id="__codelineno-4-211" name="__codelineno-4-211"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">fix_accession2run</span><span class="p">:</span>
</span><span id="__span-4-212"><a id="__codelineno-4-212" name="__codelineno-4-212"></a>        <span class="k">return</span> <span class="n">seqinfo</span>  <span class="c1"># nothing to do</span>
</span><span id="__span-4-213"><a id="__codelineno-4-213" name="__codelineno-4-213"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">):</span>
</span><span id="__span-4-214"><a id="__codelineno-4-214" name="__codelineno-4-214"></a>        <span class="n">accession_number</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">accession_number</span>
</span><span id="__span-4-215"><a id="__codelineno-4-215" name="__codelineno-4-215"></a>        <span class="k">if</span> <span class="n">accession_number</span> <span class="ow">and</span> <span class="n">accession_number</span> <span class="ow">in</span> <span class="n">fix_accession2run</span><span class="p">:</span>
</span><span id="__span-4-216"><a id="__codelineno-4-216" name="__codelineno-4-216"></a>            <span class="n">lgr</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="__span-4-217"><a id="__codelineno-4-217" name="__codelineno-4-217"></a>                <span class="s2">&quot;Considering some runs possibly marked to be &quot;</span>
</span><span id="__span-4-218"><a id="__codelineno-4-218" name="__codelineno-4-218"></a>                <span class="s2">&quot;canceled for accession </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-4-219"><a id="__codelineno-4-219" name="__codelineno-4-219"></a>                <span class="n">accession_number</span><span class="p">,</span>
</span><span id="__span-4-220"><a id="__codelineno-4-220" name="__codelineno-4-220"></a>            <span class="p">)</span>
</span><span id="__span-4-221"><a id="__codelineno-4-221" name="__codelineno-4-221"></a>            <span class="c1"># This code is reminiscent of prior logic when operating on</span>
</span><span id="__span-4-222"><a id="__codelineno-4-222" name="__codelineno-4-222"></a>            <span class="c1"># a single accession, but left as is for now</span>
</span><span id="__span-4-223"><a id="__codelineno-4-223" name="__codelineno-4-223"></a>            <span class="n">badruns</span> <span class="o">=</span> <span class="n">fix_accession2run</span><span class="p">[</span><span class="n">accession_number</span><span class="p">]</span>
</span><span id="__span-4-224"><a id="__codelineno-4-224" name="__codelineno-4-224"></a>            <span class="n">badruns_pattern</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">badruns</span><span class="p">)</span>
</span><span id="__span-4-225"><a id="__codelineno-4-225" name="__codelineno-4-225"></a>            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">badruns_pattern</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="p">):</span>
</span><span id="__span-4-226"><a id="__codelineno-4-226" name="__codelineno-4-226"></a>                <span class="n">lgr</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fixing bad run </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="p">))</span>
</span><span id="__span-4-227"><a id="__codelineno-4-227" name="__codelineno-4-227"></a>                <span class="n">fixedkwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
</span><span id="__span-4-228"><a id="__codelineno-4-228" name="__codelineno-4-228"></a>                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">series_spec_fields</span><span class="p">:</span>
</span><span id="__span-4-229"><a id="__codelineno-4-229" name="__codelineno-4-229"></a>                    <span class="n">fixedkwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cancelme_&quot;</span> <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="__span-4-230"><a id="__codelineno-4-230" name="__codelineno-4-230"></a>                <span class="n">seqinfo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="o">**</span><span class="n">fixedkwargs</span><span class="p">)</span>
</span><span id="__span-4-231"><a id="__codelineno-4-231" name="__codelineno-4-231"></a>    <span class="k">return</span> <span class="n">seqinfo</span>
</span><span id="__span-4-232"><a id="__codelineno-4-232" name="__codelineno-4-232"></a>
</span><span id="__span-4-233"><a id="__codelineno-4-233" name="__codelineno-4-233"></a>
</span><span id="__span-4-234"><a id="__codelineno-4-234" name="__codelineno-4-234"></a><span class="k">def</span> <span class="nf">fix_dbic_protocol</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SeqInfo</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SeqInfo</span><span class="p">]:</span>
</span><span id="__span-4-235"><a id="__codelineno-4-235" name="__codelineno-4-235"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Ad-hoc fixup for existing protocols.</span>
</span><span id="__span-4-236"><a id="__codelineno-4-236" name="__codelineno-4-236"></a>
</span><span id="__span-4-237"><a id="__codelineno-4-237" name="__codelineno-4-237"></a><span class="sd">    It will operate in 3 stages on `protocols2fix` records.</span>
</span><span id="__span-4-238"><a id="__codelineno-4-238" name="__codelineno-4-238"></a><span class="sd">    1. consider a record which has md5sum of study_description</span>
</span><span id="__span-4-239"><a id="__codelineno-4-239" name="__codelineno-4-239"></a><span class="sd">    2. apply all substitutions, where key is a regular expression which</span>
</span><span id="__span-4-240"><a id="__codelineno-4-240" name="__codelineno-4-240"></a><span class="sd">       successfully searches (not necessarily matches, so anchor appropriately)</span>
</span><span id="__span-4-241"><a id="__codelineno-4-241" name="__codelineno-4-241"></a><span class="sd">       study_description</span>
</span><span id="__span-4-242"><a id="__codelineno-4-242" name="__codelineno-4-242"></a><span class="sd">    3. apply &quot;catch all&quot; substitutions in the key containing an empty string</span>
</span><span id="__span-4-243"><a id="__codelineno-4-243" name="__codelineno-4-243"></a>
</span><span id="__span-4-244"><a id="__codelineno-4-244" name="__codelineno-4-244"></a><span class="sd">    3. is somewhat redundant since `re.compile(&#39;.*&#39;)` could match any, but is</span>
</span><span id="__span-4-245"><a id="__codelineno-4-245" name="__codelineno-4-245"></a><span class="sd">    kept for simplicity of its specification.</span>
</span><span id="__span-4-246"><a id="__codelineno-4-246" name="__codelineno-4-246"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-4-247"><a id="__codelineno-4-247" name="__codelineno-4-247"></a>
</span><span id="__span-4-248"><a id="__codelineno-4-248" name="__codelineno-4-248"></a>    <span class="n">study_hash</span> <span class="o">=</span> <span class="n">get_study_hash</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">)</span>
</span><span id="__span-4-249"><a id="__codelineno-4-249" name="__codelineno-4-249"></a>    <span class="n">study_description</span> <span class="o">=</span> <span class="n">get_study_description</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">)</span>
</span><span id="__span-4-250"><a id="__codelineno-4-250" name="__codelineno-4-250"></a>
</span><span id="__span-4-251"><a id="__codelineno-4-251" name="__codelineno-4-251"></a>    <span class="c1"># We will consider first study specific (based on hash)</span>
</span><span id="__span-4-252"><a id="__codelineno-4-252" name="__codelineno-4-252"></a>    <span class="k">if</span> <span class="n">study_hash</span> <span class="ow">in</span> <span class="n">protocols2fix</span><span class="p">:</span>
</span><span id="__span-4-253"><a id="__codelineno-4-253" name="__codelineno-4-253"></a>        <span class="n">_apply_substitutions</span><span class="p">(</span>
</span><span id="__span-4-254"><a id="__codelineno-4-254" name="__codelineno-4-254"></a>            <span class="n">seqinfo</span><span class="p">,</span> <span class="n">protocols2fix</span><span class="p">[</span><span class="n">study_hash</span><span class="p">],</span> <span class="s2">&quot;study (</span><span class="si">%s</span><span class="s2">) specific&quot;</span> <span class="o">%</span> <span class="n">study_hash</span>
</span><span id="__span-4-255"><a id="__codelineno-4-255" name="__codelineno-4-255"></a>        <span class="p">)</span>
</span><span id="__span-4-256"><a id="__codelineno-4-256" name="__codelineno-4-256"></a>    <span class="c1"># Then go through all regexps returning regex &quot;search&quot; result</span>
</span><span id="__span-4-257"><a id="__codelineno-4-257" name="__codelineno-4-257"></a>    <span class="c1"># on study_description</span>
</span><span id="__span-4-258"><a id="__codelineno-4-258" name="__codelineno-4-258"></a>    <span class="k">for</span> <span class="n">sub</span><span class="p">,</span> <span class="n">substitutions</span> <span class="ow">in</span> <span class="n">protocols2fix</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-4-259"><a id="__codelineno-4-259" name="__codelineno-4-259"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">Pattern</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sub</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">study_description</span><span class="p">):</span>
</span><span id="__span-4-260"><a id="__codelineno-4-260" name="__codelineno-4-260"></a>            <span class="n">_apply_substitutions</span><span class="p">(</span>
</span><span id="__span-4-261"><a id="__codelineno-4-261" name="__codelineno-4-261"></a>                <span class="n">seqinfo</span><span class="p">,</span> <span class="n">substitutions</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%r</span><span class="s2"> regex matching&quot;</span> <span class="o">%</span> <span class="n">sub</span><span class="o">.</span><span class="n">pattern</span>
</span><span id="__span-4-262"><a id="__codelineno-4-262" name="__codelineno-4-262"></a>            <span class="p">)</span>
</span><span id="__span-4-263"><a id="__codelineno-4-263" name="__codelineno-4-263"></a>    <span class="c1"># and at the end - global</span>
</span><span id="__span-4-264"><a id="__codelineno-4-264" name="__codelineno-4-264"></a>    <span class="k">if</span> <span class="s2">&quot;&quot;</span> <span class="ow">in</span> <span class="n">protocols2fix</span><span class="p">:</span>
</span><span id="__span-4-265"><a id="__codelineno-4-265" name="__codelineno-4-265"></a>        <span class="n">_apply_substitutions</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">,</span> <span class="n">protocols2fix</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">],</span> <span class="s2">&quot;global&quot;</span><span class="p">)</span>
</span><span id="__span-4-266"><a id="__codelineno-4-266" name="__codelineno-4-266"></a>
</span><span id="__span-4-267"><a id="__codelineno-4-267" name="__codelineno-4-267"></a>    <span class="k">return</span> <span class="n">seqinfo</span>
</span><span id="__span-4-268"><a id="__codelineno-4-268" name="__codelineno-4-268"></a>
</span><span id="__span-4-269"><a id="__codelineno-4-269" name="__codelineno-4-269"></a>
</span><span id="__span-4-270"><a id="__codelineno-4-270" name="__codelineno-4-270"></a><span class="k">def</span> <span class="nf">fix_seqinfo</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SeqInfo</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">SeqInfo</span><span class="p">]:</span>
</span><span id="__span-4-271"><a id="__codelineno-4-271" name="__codelineno-4-271"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Just a helper on top of both fixers&quot;&quot;&quot;</span>
</span><span id="__span-4-272"><a id="__codelineno-4-272" name="__codelineno-4-272"></a>    <span class="c1"># add cancelme to known bad runs</span>
</span><span id="__span-4-273"><a id="__codelineno-4-273" name="__codelineno-4-273"></a>    <span class="n">seqinfo</span> <span class="o">=</span> <span class="n">fix_canceled_runs</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">)</span>
</span><span id="__span-4-274"><a id="__codelineno-4-274" name="__codelineno-4-274"></a>    <span class="n">seqinfo</span> <span class="o">=</span> <span class="n">fix_dbic_protocol</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">)</span>
</span><span id="__span-4-275"><a id="__codelineno-4-275" name="__codelineno-4-275"></a>    <span class="k">return</span> <span class="n">seqinfo</span>
</span><span id="__span-4-276"><a id="__codelineno-4-276" name="__codelineno-4-276"></a>
</span><span id="__span-4-277"><a id="__codelineno-4-277" name="__codelineno-4-277"></a>
</span><span id="__span-4-278"><a id="__codelineno-4-278" name="__codelineno-4-278"></a><span class="k">def</span> <span class="nf">create_key</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">outtype</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;nii.gz&quot;</span><span class="p">,),</span> <span class="n">annotation_classes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-4-279"><a id="__codelineno-4-279" name="__codelineno-4-279"></a>    <span class="k">if</span> <span class="n">template</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">template</span><span class="p">:</span>
</span><span id="__span-4-280"><a id="__codelineno-4-280" name="__codelineno-4-280"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Template must be a valid format string&quot;</span><span class="p">)</span>
</span><span id="__span-4-281"><a id="__codelineno-4-281" name="__codelineno-4-281"></a>    <span class="k">return</span> <span class="n">template</span><span class="p">,</span> <span class="n">outtype</span><span class="p">,</span> <span class="n">annotation_classes</span>
</span><span id="__span-4-282"><a id="__codelineno-4-282" name="__codelineno-4-282"></a>
</span><span id="__span-4-283"><a id="__codelineno-4-283" name="__codelineno-4-283"></a>
</span><span id="__span-4-284"><a id="__codelineno-4-284" name="__codelineno-4-284"></a><span class="k">def</span> <span class="nf">infotodict</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">):</span>
</span><span id="__span-4-285"><a id="__codelineno-4-285" name="__codelineno-4-285"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Heuristic evaluator for determining which runs belong where</span>
</span><span id="__span-4-286"><a id="__codelineno-4-286" name="__codelineno-4-286"></a>
</span><span id="__span-4-287"><a id="__codelineno-4-287" name="__codelineno-4-287"></a><span class="sd">    allowed template fields - follow python string module:</span>
</span><span id="__span-4-288"><a id="__codelineno-4-288" name="__codelineno-4-288"></a>
</span><span id="__span-4-289"><a id="__codelineno-4-289" name="__codelineno-4-289"></a><span class="sd">    item: index within category</span>
</span><span id="__span-4-290"><a id="__codelineno-4-290" name="__codelineno-4-290"></a><span class="sd">    subject: participant id</span>
</span><span id="__span-4-291"><a id="__codelineno-4-291" name="__codelineno-4-291"></a><span class="sd">    seqitem: run number during scanning</span>
</span><span id="__span-4-292"><a id="__codelineno-4-292" name="__codelineno-4-292"></a><span class="sd">    subindex: sub index within group</span>
</span><span id="__span-4-293"><a id="__codelineno-4-293" name="__codelineno-4-293"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-4-294"><a id="__codelineno-4-294" name="__codelineno-4-294"></a>    <span class="n">seqinfo</span> <span class="o">=</span> <span class="n">fix_seqinfo</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">)</span>
</span><span id="__span-4-295"><a id="__codelineno-4-295" name="__codelineno-4-295"></a>    <span class="n">lgr</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Processing </span><span class="si">%d</span><span class="s2"> seqinfo entries&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">seqinfo</span><span class="p">))</span>
</span><span id="__span-4-296"><a id="__codelineno-4-296" name="__codelineno-4-296"></a>
</span><span id="__span-4-297"><a id="__codelineno-4-297" name="__codelineno-4-297"></a>    <span class="n">t1w</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span>
</span><span id="__span-4-298"><a id="__codelineno-4-298" name="__codelineno-4-298"></a>        <span class="s2">&quot;sub-</span><span class="si">{subject}</span><span class="s2">/</span><span class="si">{session}</span><span class="s2">/anat/sub-</span><span class="si">{subject}</span><span class="s2">_</span><span class="si">{session}</span><span class="s2">_acq-</span><span class="si">{acquisition}{run_entity}</span><span class="s2">_T1w&quot;</span>
</span><span id="__span-4-299"><a id="__codelineno-4-299" name="__codelineno-4-299"></a>    <span class="p">)</span>
</span><span id="__span-4-300"><a id="__codelineno-4-300" name="__codelineno-4-300"></a>    <span class="n">t2w</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span>
</span><span id="__span-4-301"><a id="__codelineno-4-301" name="__codelineno-4-301"></a>        <span class="s2">&quot;sub-</span><span class="si">{subject}</span><span class="s2">/</span><span class="si">{session}</span><span class="s2">/anat/sub-</span><span class="si">{subject}</span><span class="s2">_</span><span class="si">{session}</span><span class="s2">_acq-</span><span class="si">{acquisition}{run_entity}</span><span class="s2">_T2w&quot;</span>
</span><span id="__span-4-302"><a id="__codelineno-4-302" name="__codelineno-4-302"></a>    <span class="p">)</span>
</span><span id="__span-4-303"><a id="__codelineno-4-303" name="__codelineno-4-303"></a>    <span class="n">t2_flair</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span>
</span><span id="__span-4-304"><a id="__codelineno-4-304" name="__codelineno-4-304"></a>        <span class="s2">&quot;sub-</span><span class="si">{subject}</span><span class="s2">/</span><span class="si">{session}</span><span class="s2">/anat/sub-</span><span class="si">{subject}</span><span class="s2">_</span><span class="si">{session}{run_entity}</span><span class="s2">_FLAIR&quot;</span>
</span><span id="__span-4-305"><a id="__codelineno-4-305" name="__codelineno-4-305"></a>    <span class="p">)</span>
</span><span id="__span-4-306"><a id="__codelineno-4-306" name="__codelineno-4-306"></a>    <span class="n">dwi</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span>
</span><span id="__span-4-307"><a id="__codelineno-4-307" name="__codelineno-4-307"></a>        <span class="s2">&quot;sub-</span><span class="si">{subject}</span><span class="s2">/</span><span class="si">{session}</span><span class="s2">/dwi/sub-</span><span class="si">{subject}</span><span class="s2">_</span><span class="si">{session}</span><span class="s2">_acq-</span><span class="si">{acq}</span><span class="s2">_dir-</span><span class="si">{dir}{run_entity}</span><span class="s2">_dwi&quot;</span>
</span><span id="__span-4-308"><a id="__codelineno-4-308" name="__codelineno-4-308"></a>    <span class="p">)</span>
</span><span id="__span-4-309"><a id="__codelineno-4-309" name="__codelineno-4-309"></a>    <span class="n">mag</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span>
</span><span id="__span-4-310"><a id="__codelineno-4-310" name="__codelineno-4-310"></a>        <span class="s2">&quot;sub-</span><span class="si">{subject}</span><span class="s2">/</span><span class="si">{session}</span><span class="s2">/fmap/sub-</span><span class="si">{subject}</span><span class="s2">_</span><span class="si">{session}{run_entity}</span><span class="s2">_magnitude&quot;</span>
</span><span id="__span-4-311"><a id="__codelineno-4-311" name="__codelineno-4-311"></a>    <span class="p">)</span>
</span><span id="__span-4-312"><a id="__codelineno-4-312" name="__codelineno-4-312"></a>    <span class="n">phdiff</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span>
</span><span id="__span-4-313"><a id="__codelineno-4-313" name="__codelineno-4-313"></a>        <span class="s2">&quot;sub-</span><span class="si">{subject}</span><span class="s2">/</span><span class="si">{session}</span><span class="s2">/fmap/sub-</span><span class="si">{subject}</span><span class="s2">_</span><span class="si">{session}{run_entity}</span><span class="s2">_phasediff&quot;</span>
</span><span id="__span-4-314"><a id="__codelineno-4-314" name="__codelineno-4-314"></a>    <span class="p">)</span>
</span><span id="__span-4-315"><a id="__codelineno-4-315" name="__codelineno-4-315"></a>    <span class="n">epi</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span>
</span><span id="__span-4-316"><a id="__codelineno-4-316" name="__codelineno-4-316"></a>        <span class="s2">&quot;sub-</span><span class="si">{subject}</span><span class="s2">/</span><span class="si">{session}</span><span class="s2">/fmap/sub-</span><span class="si">{subject}</span><span class="s2">_</span><span class="si">{session}</span><span class="s2">&quot;</span>
</span><span id="__span-4-317"><a id="__codelineno-4-317" name="__codelineno-4-317"></a>        <span class="s2">&quot;_acq-</span><span class="si">{acquisition}</span><span class="s2">_dir-</span><span class="si">{dir}{run_entity}{part_entity}</span><span class="s2">_epi&quot;</span>
</span><span id="__span-4-318"><a id="__codelineno-4-318" name="__codelineno-4-318"></a>    <span class="p">)</span>
</span><span id="__span-4-319"><a id="__codelineno-4-319" name="__codelineno-4-319"></a>    <span class="n">func</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span>
</span><span id="__span-4-320"><a id="__codelineno-4-320" name="__codelineno-4-320"></a>        <span class="s2">&quot;sub-</span><span class="si">{subject}</span><span class="s2">/</span><span class="si">{session}</span><span class="s2">/func/sub-</span><span class="si">{subject}</span><span class="s2">_</span><span class="si">{session}</span><span class="s2">&quot;</span>
</span><span id="__span-4-321"><a id="__codelineno-4-321" name="__codelineno-4-321"></a>        <span class="s2">&quot;_task-</span><span class="si">{task}{acq_entity}{dir_entity}{run_entity}{part_entity}</span><span class="s2">_bold&quot;</span>
</span><span id="__span-4-322"><a id="__codelineno-4-322" name="__codelineno-4-322"></a>    <span class="p">)</span>
</span><span id="__span-4-323"><a id="__codelineno-4-323" name="__codelineno-4-323"></a>    <span class="n">sbref</span> <span class="o">=</span> <span class="n">create_key</span><span class="p">(</span>
</span><span id="__span-4-324"><a id="__codelineno-4-324" name="__codelineno-4-324"></a>        <span class="s2">&quot;sub-</span><span class="si">{subject}</span><span class="s2">/</span><span class="si">{session}</span><span class="s2">/func/sub-</span><span class="si">{subject}</span><span class="s2">_</span><span class="si">{session}</span><span class="s2">_task-</span><span class="si">{task}{run_entity}</span><span class="s2">_sbref&quot;</span>
</span><span id="__span-4-325"><a id="__codelineno-4-325" name="__codelineno-4-325"></a>    <span class="p">)</span>
</span><span id="__span-4-326"><a id="__codelineno-4-326" name="__codelineno-4-326"></a>
</span><span id="__span-4-327"><a id="__codelineno-4-327" name="__codelineno-4-327"></a>    <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-4-328"><a id="__codelineno-4-328" name="__codelineno-4-328"></a>        <span class="n">t1w</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="__span-4-329"><a id="__codelineno-4-329" name="__codelineno-4-329"></a>        <span class="n">t2w</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="__span-4-330"><a id="__codelineno-4-330" name="__codelineno-4-330"></a>        <span class="n">t2_flair</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="__span-4-331"><a id="__codelineno-4-331" name="__codelineno-4-331"></a>        <span class="n">dwi</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="__span-4-332"><a id="__codelineno-4-332" name="__codelineno-4-332"></a>        <span class="n">mag</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="__span-4-333"><a id="__codelineno-4-333" name="__codelineno-4-333"></a>        <span class="n">phdiff</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="__span-4-334"><a id="__codelineno-4-334" name="__codelineno-4-334"></a>        <span class="n">epi</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="__span-4-335"><a id="__codelineno-4-335" name="__codelineno-4-335"></a>        <span class="n">func</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="__span-4-336"><a id="__codelineno-4-336" name="__codelineno-4-336"></a>        <span class="n">sbref</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="__span-4-337"><a id="__codelineno-4-337" name="__codelineno-4-337"></a>    <span class="p">}</span>
</span><span id="__span-4-338"><a id="__codelineno-4-338" name="__codelineno-4-338"></a>    <span class="n">epi_mags</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-4-339"><a id="__codelineno-4-339" name="__codelineno-4-339"></a>    <span class="n">bold_mags</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-4-340"><a id="__codelineno-4-340" name="__codelineno-4-340"></a>
</span><span id="__span-4-341"><a id="__codelineno-4-341" name="__codelineno-4-341"></a>    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">seqinfo</span><span class="p">:</span>
</span><span id="__span-4-342"><a id="__codelineno-4-342" name="__codelineno-4-342"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-4-343"><a id="__codelineno-4-343" name="__codelineno-4-343"></a><span class="sd">        The namedtuple `s` contains the following fields:</span>
</span><span id="__span-4-344"><a id="__codelineno-4-344" name="__codelineno-4-344"></a>
</span><span id="__span-4-345"><a id="__codelineno-4-345" name="__codelineno-4-345"></a><span class="sd">        * total_files_till_now</span>
</span><span id="__span-4-346"><a id="__codelineno-4-346" name="__codelineno-4-346"></a><span class="sd">        * example_dcm_file</span>
</span><span id="__span-4-347"><a id="__codelineno-4-347" name="__codelineno-4-347"></a><span class="sd">        * series_id</span>
</span><span id="__span-4-348"><a id="__codelineno-4-348" name="__codelineno-4-348"></a><span class="sd">        * dcm_dir_name</span>
</span><span id="__span-4-349"><a id="__codelineno-4-349" name="__codelineno-4-349"></a><span class="sd">        * unspecified2</span>
</span><span id="__span-4-350"><a id="__codelineno-4-350" name="__codelineno-4-350"></a><span class="sd">        * unspecified3</span>
</span><span id="__span-4-351"><a id="__codelineno-4-351" name="__codelineno-4-351"></a><span class="sd">        * dim1</span>
</span><span id="__span-4-352"><a id="__codelineno-4-352" name="__codelineno-4-352"></a><span class="sd">        * dim2</span>
</span><span id="__span-4-353"><a id="__codelineno-4-353" name="__codelineno-4-353"></a><span class="sd">        * dim3</span>
</span><span id="__span-4-354"><a id="__codelineno-4-354" name="__codelineno-4-354"></a><span class="sd">        * dim4</span>
</span><span id="__span-4-355"><a id="__codelineno-4-355" name="__codelineno-4-355"></a><span class="sd">        * TR</span>
</span><span id="__span-4-356"><a id="__codelineno-4-356" name="__codelineno-4-356"></a><span class="sd">        * TE</span>
</span><span id="__span-4-357"><a id="__codelineno-4-357" name="__codelineno-4-357"></a><span class="sd">        * protocol_name</span>
</span><span id="__span-4-358"><a id="__codelineno-4-358" name="__codelineno-4-358"></a><span class="sd">        * is_motion_corrected</span>
</span><span id="__span-4-359"><a id="__codelineno-4-359" name="__codelineno-4-359"></a><span class="sd">        * is_derived</span>
</span><span id="__span-4-360"><a id="__codelineno-4-360" name="__codelineno-4-360"></a><span class="sd">        * patient_id</span>
</span><span id="__span-4-361"><a id="__codelineno-4-361" name="__codelineno-4-361"></a><span class="sd">        * study_description</span>
</span><span id="__span-4-362"><a id="__codelineno-4-362" name="__codelineno-4-362"></a><span class="sd">        * referring_physician_name</span>
</span><span id="__span-4-363"><a id="__codelineno-4-363" name="__codelineno-4-363"></a><span class="sd">        * series_description</span>
</span><span id="__span-4-364"><a id="__codelineno-4-364" name="__codelineno-4-364"></a><span class="sd">        * image_type</span>
</span><span id="__span-4-365"><a id="__codelineno-4-365" name="__codelineno-4-365"></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-4-366"><a id="__codelineno-4-366" name="__codelineno-4-366"></a>
</span><span id="__span-4-367"><a id="__codelineno-4-367" name="__codelineno-4-367"></a>        <span class="c1"># Ignore derived data and reports</span>
</span><span id="__span-4-368"><a id="__codelineno-4-368" name="__codelineno-4-368"></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="__span-4-369"><a id="__codelineno-4-369" name="__codelineno-4-369"></a>            <span class="n">s</span><span class="o">.</span><span class="n">is_derived</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span>
</span><span id="__span-4-370"><a id="__codelineno-4-370" name="__codelineno-4-370"></a>            <span class="ow">or</span> <span class="n">s</span><span class="o">.</span><span class="n">is_derived</span> <span class="ow">is</span> <span class="kc">True</span>
</span><span id="__span-4-371"><a id="__codelineno-4-371" name="__codelineno-4-371"></a>            <span class="ow">or</span> <span class="n">s</span><span class="o">.</span><span class="n">dcm_dir_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">IGNORE_PROTOCOLS</span>
</span><span id="__span-4-372"><a id="__codelineno-4-372" name="__codelineno-4-372"></a>        <span class="p">):</span>
</span><span id="__span-4-373"><a id="__codelineno-4-373" name="__codelineno-4-373"></a>            <span class="k">continue</span>
</span><span id="__span-4-374"><a id="__codelineno-4-374" name="__codelineno-4-374"></a>
</span><span id="__span-4-375"><a id="__codelineno-4-375" name="__codelineno-4-375"></a>        <span class="n">thisitem</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-4-376"><a id="__codelineno-4-376" name="__codelineno-4-376"></a>            <span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="p">,</span>
</span><span id="__span-4-377"><a id="__codelineno-4-377" name="__codelineno-4-377"></a>        <span class="p">}</span>
</span><span id="__span-4-378"><a id="__codelineno-4-378" name="__codelineno-4-378"></a>        <span class="n">thiskey</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-4-379"><a id="__codelineno-4-379" name="__codelineno-4-379"></a>        <span class="n">thisitem</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">bids_regex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="p">)})</span>
</span><span id="__span-4-380"><a id="__codelineno-4-380" name="__codelineno-4-380"></a>        <span class="n">thisitem</span><span class="p">[</span><span class="s2">&quot;run_entity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">thisitem</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;run&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-4-381"><a id="__codelineno-4-381" name="__codelineno-4-381"></a>
</span><span id="__span-4-382"><a id="__codelineno-4-382" name="__codelineno-4-382"></a>        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;anat-t1w&quot;</span><span class="p">):</span>
</span><span id="__span-4-383"><a id="__codelineno-4-383" name="__codelineno-4-383"></a>            <span class="n">thiskey</span> <span class="o">=</span> <span class="n">t1w</span>
</span><span id="__span-4-384"><a id="__codelineno-4-384" name="__codelineno-4-384"></a>            <span class="n">acquisition_present</span> <span class="o">=</span> <span class="n">thisitem</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;acq&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-4-385"><a id="__codelineno-4-385" name="__codelineno-4-385"></a>            <span class="n">thisitem</span><span class="p">[</span><span class="s2">&quot;acquisition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-4-386"><a id="__codelineno-4-386" name="__codelineno-4-386"></a>                <span class="p">(</span><span class="s2">&quot;original&quot;</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">dcm_dir_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_ND&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;undistorted&quot;</span><span class="p">)</span>
</span><span id="__span-4-387"><a id="__codelineno-4-387" name="__codelineno-4-387"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">acquisition_present</span>
</span><span id="__span-4-388"><a id="__codelineno-4-388" name="__codelineno-4-388"></a>                <span class="k">else</span> <span class="n">acquisition_present</span>
</span><span id="__span-4-389"><a id="__codelineno-4-389" name="__codelineno-4-389"></a>            <span class="p">)</span>
</span><span id="__span-4-390"><a id="__codelineno-4-390" name="__codelineno-4-390"></a>        <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;anat-t2w&quot;</span><span class="p">):</span>
</span><span id="__span-4-391"><a id="__codelineno-4-391" name="__codelineno-4-391"></a>            <span class="n">thiskey</span> <span class="o">=</span> <span class="n">t2w</span>
</span><span id="__span-4-392"><a id="__codelineno-4-392" name="__codelineno-4-392"></a>            <span class="n">acquisition_present</span> <span class="o">=</span> <span class="n">thisitem</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;acq&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-4-393"><a id="__codelineno-4-393" name="__codelineno-4-393"></a>            <span class="n">thisitem</span><span class="p">[</span><span class="s2">&quot;acquisition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-4-394"><a id="__codelineno-4-394" name="__codelineno-4-394"></a>                <span class="p">(</span><span class="s2">&quot;original&quot;</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">dcm_dir_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_ND&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;undistorted&quot;</span><span class="p">)</span>
</span><span id="__span-4-395"><a id="__codelineno-4-395" name="__codelineno-4-395"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">acquisition_present</span>
</span><span id="__span-4-396"><a id="__codelineno-4-396" name="__codelineno-4-396"></a>                <span class="k">else</span> <span class="s2">&quot;unspecified&quot;</span>
</span><span id="__span-4-397"><a id="__codelineno-4-397" name="__codelineno-4-397"></a>            <span class="p">)</span>
</span><span id="__span-4-398"><a id="__codelineno-4-398" name="__codelineno-4-398"></a>        <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;anat-flair&quot;</span><span class="p">):</span>
</span><span id="__span-4-399"><a id="__codelineno-4-399" name="__codelineno-4-399"></a>            <span class="n">thiskey</span> <span class="o">=</span> <span class="n">t2_flair</span>
</span><span id="__span-4-400"><a id="__codelineno-4-400" name="__codelineno-4-400"></a>        <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;dwi-dwi&quot;</span><span class="p">):</span>
</span><span id="__span-4-401"><a id="__codelineno-4-401" name="__codelineno-4-401"></a>            <span class="n">thiskey</span> <span class="o">=</span> <span class="n">dwi</span>
</span><span id="__span-4-402"><a id="__codelineno-4-402" name="__codelineno-4-402"></a>        <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;fmap-phasediff&quot;</span><span class="p">):</span>
</span><span id="__span-4-403"><a id="__codelineno-4-403" name="__codelineno-4-403"></a>            <span class="n">thiskey</span> <span class="o">=</span> <span class="n">phdiff</span> <span class="k">if</span> <span class="s2">&quot;P&quot;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">image_type</span> <span class="k">else</span> <span class="n">mag</span>
</span><span id="__span-4-404"><a id="__codelineno-4-404" name="__codelineno-4-404"></a>        <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;fmap-epi&quot;</span><span class="p">):</span>
</span><span id="__span-4-405"><a id="__codelineno-4-405" name="__codelineno-4-405"></a>            <span class="n">thiskey</span> <span class="o">=</span> <span class="n">epi</span>
</span><span id="__span-4-406"><a id="__codelineno-4-406" name="__codelineno-4-406"></a>            <span class="n">thisitem</span><span class="p">[</span><span class="s2">&quot;part_entity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-4-407"><a id="__codelineno-4-407" name="__codelineno-4-407"></a>            <span class="n">thisitem</span><span class="p">[</span><span class="s2">&quot;acquisition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-4-408"><a id="__codelineno-4-408" name="__codelineno-4-408"></a>                <span class="s2">&quot;b0&quot;</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">sequence_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;ep_b0&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;bold&quot;</span>
</span><span id="__span-4-409"><a id="__codelineno-4-409" name="__codelineno-4-409"></a>            <span class="p">)</span>
</span><span id="__span-4-410"><a id="__codelineno-4-410" name="__codelineno-4-410"></a>
</span><span id="__span-4-411"><a id="__codelineno-4-411" name="__codelineno-4-411"></a>            <span class="c1"># Check whether phase was written out:</span>
</span><span id="__span-4-412"><a id="__codelineno-4-412" name="__codelineno-4-412"></a>            <span class="c1"># 1. A magnitude needs to exist immediately before in the dicom info</span>
</span><span id="__span-4-413"><a id="__codelineno-4-413" name="__codelineno-4-413"></a>            <span class="c1"># 2. Magnitude and phase must have the same number of volumes</span>
</span><span id="__span-4-414"><a id="__codelineno-4-414" name="__codelineno-4-414"></a>            <span class="n">series_id_idx</span><span class="p">,</span> <span class="n">series_id_name</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-4-415"><a id="__codelineno-4-415" name="__codelineno-4-415"></a>            <span class="n">prev_series_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">series_id_idx</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">series_id_name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">series_files</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-4-416"><a id="__codelineno-4-416" name="__codelineno-4-416"></a>            <span class="k">if</span> <span class="n">prev_series_id</span> <span class="ow">in</span> <span class="n">epi_mags</span><span class="p">:</span>
</span><span id="__span-4-417"><a id="__codelineno-4-417" name="__codelineno-4-417"></a>                <span class="n">thisitem</span><span class="p">[</span><span class="s2">&quot;part_entity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;_part-phase&quot;</span>
</span><span id="__span-4-418"><a id="__codelineno-4-418" name="__codelineno-4-418"></a>                <span class="n">info</span><span class="p">[</span><span class="n">thiskey</span><span class="p">][</span><span class="n">epi_mags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">prev_series_id</span><span class="p">)][</span><span class="s2">&quot;part_entity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;_part-mag&quot;</span>
</span><span id="__span-4-419"><a id="__codelineno-4-419" name="__codelineno-4-419"></a>
</span><span id="__span-4-420"><a id="__codelineno-4-420" name="__codelineno-4-420"></a>            <span class="n">epi_mags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">series_files</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-4-421"><a id="__codelineno-4-421" name="__codelineno-4-421"></a>
</span><span id="__span-4-422"><a id="__codelineno-4-422" name="__codelineno-4-422"></a>        <span class="k">elif</span> <span class="n">s</span><span class="o">.</span><span class="n">protocol_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;func-bold&quot;</span><span class="p">):</span>
</span><span id="__span-4-423"><a id="__codelineno-4-423" name="__codelineno-4-423"></a>            <span class="c1"># Likely an error</span>
</span><span id="__span-4-424"><a id="__codelineno-4-424" name="__codelineno-4-424"></a>            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">series_files</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="__span-4-425"><a id="__codelineno-4-425" name="__codelineno-4-425"></a>                <span class="n">warn</span><span class="p">(</span>
</span><span id="__span-4-426"><a id="__codelineno-4-426" name="__codelineno-4-426"></a>                    <span class="sa">f</span><span class="s2">&quot;Dropping exceedingly short BOLD file with </span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">series_files</span><span class="si">}</span><span class="s2"> time points.&quot;</span>
</span><span id="__span-4-427"><a id="__codelineno-4-427" name="__codelineno-4-427"></a>                <span class="p">)</span>
</span><span id="__span-4-428"><a id="__codelineno-4-428" name="__codelineno-4-428"></a>                <span class="k">continue</span>
</span><span id="__span-4-429"><a id="__codelineno-4-429" name="__codelineno-4-429"></a>
</span><span id="__span-4-430"><a id="__codelineno-4-430" name="__codelineno-4-430"></a>            <span class="n">thiskey</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="__span-4-431"><a id="__codelineno-4-431" name="__codelineno-4-431"></a>
</span><span id="__span-4-432"><a id="__codelineno-4-432" name="__codelineno-4-432"></a>            <span class="n">thisitem</span><span class="p">[</span><span class="s2">&quot;part_entity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="__span-4-433"><a id="__codelineno-4-433" name="__codelineno-4-433"></a>            <span class="c1"># Some functional runs may come with acq</span>
</span><span id="__span-4-434"><a id="__codelineno-4-434" name="__codelineno-4-434"></a>            <span class="n">func_acq</span> <span class="o">=</span> <span class="n">thisitem</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;acq&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-4-435"><a id="__codelineno-4-435" name="__codelineno-4-435"></a>            <span class="n">thisitem</span><span class="p">[</span><span class="s2">&quot;acq_entity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">func_acq</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;_acq-</span><span class="si">{</span><span class="n">func_acq</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-4-436"><a id="__codelineno-4-436" name="__codelineno-4-436"></a>
</span><span id="__span-4-437"><a id="__codelineno-4-437" name="__codelineno-4-437"></a>            <span class="c1"># Some functional runs may come with dir</span>
</span><span id="__span-4-438"><a id="__codelineno-4-438" name="__codelineno-4-438"></a>            <span class="n">func_dir</span> <span class="o">=</span> <span class="n">thisitem</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;dir&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-4-439"><a id="__codelineno-4-439" name="__codelineno-4-439"></a>            <span class="n">thisitem</span><span class="p">[</span><span class="s2">&quot;dir_entity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">func_dir</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;_dir-</span><span class="si">{</span><span class="n">func_dir</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-4-440"><a id="__codelineno-4-440" name="__codelineno-4-440"></a>
</span><span id="__span-4-441"><a id="__codelineno-4-441" name="__codelineno-4-441"></a>            <span class="c1"># Check whether phase was written out:</span>
</span><span id="__span-4-442"><a id="__codelineno-4-442" name="__codelineno-4-442"></a>            <span class="c1"># 1. A magnitude needs to exist immediately before in the dicom info</span>
</span><span id="__span-4-443"><a id="__codelineno-4-443" name="__codelineno-4-443"></a>            <span class="c1"># 2. Magnitude and phase must have the same number of volumes</span>
</span><span id="__span-4-444"><a id="__codelineno-4-444" name="__codelineno-4-444"></a>            <span class="n">series_id_idx</span><span class="p">,</span> <span class="n">series_id_name</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-4-445"><a id="__codelineno-4-445" name="__codelineno-4-445"></a>            <span class="n">prev_series_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">series_id_idx</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">series_id_name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">series_files</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-4-446"><a id="__codelineno-4-446" name="__codelineno-4-446"></a>            <span class="k">if</span> <span class="n">prev_series_id</span> <span class="ow">in</span> <span class="n">bold_mags</span><span class="p">:</span>
</span><span id="__span-4-447"><a id="__codelineno-4-447" name="__codelineno-4-447"></a>                <span class="n">thisitem</span><span class="p">[</span><span class="s2">&quot;part_entity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;_part-phase&quot;</span>
</span><span id="__span-4-448"><a id="__codelineno-4-448" name="__codelineno-4-448"></a>                <span class="n">info</span><span class="p">[</span><span class="n">thiskey</span><span class="p">][</span><span class="n">bold_mags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">prev_series_id</span><span class="p">)][</span><span class="s2">&quot;part_entity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;_part-mag&quot;</span>
</span><span id="__span-4-449"><a id="__codelineno-4-449" name="__codelineno-4-449"></a>
</span><span id="__span-4-450"><a id="__codelineno-4-450" name="__codelineno-4-450"></a>            <span class="n">bold_mags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">series_id</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">series_files</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-4-451"><a id="__codelineno-4-451" name="__codelineno-4-451"></a>
</span><span id="__span-4-452"><a id="__codelineno-4-452" name="__codelineno-4-452"></a>        <span class="k">if</span> <span class="n">thiskey</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-4-453"><a id="__codelineno-4-453" name="__codelineno-4-453"></a>            <span class="n">info</span><span class="p">[</span><span class="n">thiskey</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisitem</span><span class="p">)</span>
</span><span id="__span-4-454"><a id="__codelineno-4-454" name="__codelineno-4-454"></a>
</span><span id="__span-4-455"><a id="__codelineno-4-455" name="__codelineno-4-455"></a>    <span class="k">for</span> <span class="n">mod</span><span class="p">,</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-4-456"><a id="__codelineno-4-456" name="__codelineno-4-456"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-4-457"><a id="__codelineno-4-457" name="__codelineno-4-457"></a>            <span class="k">continue</span>
</span><span id="__span-4-458"><a id="__codelineno-4-458" name="__codelineno-4-458"></a>
</span><span id="__span-4-459"><a id="__codelineno-4-459" name="__codelineno-4-459"></a>        <span class="n">info</span><span class="p">[</span><span class="n">mod</span><span class="p">]</span> <span class="o">=</span> <span class="n">_assign_run_on_repeat</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</span><span id="__span-4-460"><a id="__codelineno-4-460" name="__codelineno-4-460"></a>
</span><span id="__span-4-461"><a id="__codelineno-4-461" name="__codelineno-4-461"></a>    <span class="k">return</span> <span class="n">info</span>
</span><span id="__span-4-462"><a id="__codelineno-4-462" name="__codelineno-4-462"></a>
</span><span id="__span-4-463"><a id="__codelineno-4-463" name="__codelineno-4-463"></a>
</span><span id="__span-4-464"><a id="__codelineno-4-464" name="__codelineno-4-464"></a><span class="k">def</span> <span class="nf">_assign_run_on_repeat</span><span class="p">(</span><span class="n">modality_items</span><span class="p">):</span>
</span><span id="__span-4-465"><a id="__codelineno-4-465" name="__codelineno-4-465"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-4-466"><a id="__codelineno-4-466" name="__codelineno-4-466"></a><span class="sd">    Assign run IDs for repeated inputs for a given modality.</span>
</span><span id="__span-4-467"><a id="__codelineno-4-467" name="__codelineno-4-467"></a>
</span><span id="__span-4-468"><a id="__codelineno-4-468" name="__codelineno-4-468"></a><span class="sd">    Examples</span>
</span><span id="__span-4-469"><a id="__codelineno-4-469" name="__codelineno-4-469"></a><span class="sd">    --------</span>
</span><span id="__span-4-470"><a id="__codelineno-4-470" name="__codelineno-4-470"></a><span class="sd">    &gt;&gt;&gt; _assign_run_on_repeat([</span>
</span><span id="__span-4-471"><a id="__codelineno-4-471" name="__codelineno-4-471"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard1&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;PA&quot;},</span>
</span><span id="__span-4-472"><a id="__codelineno-4-472" name="__codelineno-4-472"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard2&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;AP&quot;},</span>
</span><span id="__span-4-473"><a id="__codelineno-4-473" name="__codelineno-4-473"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard3&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;PA&quot;},</span>
</span><span id="__span-4-474"><a id="__codelineno-4-474" name="__codelineno-4-474"></a><span class="sd">    ... ])  # doctest: +NORMALIZE_WHITESPACE</span>
</span><span id="__span-4-475"><a id="__codelineno-4-475" name="__codelineno-4-475"></a><span class="sd">    [{&#39;item&#39;: &#39;discard1&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;PA&#39;, &#39;run_entity&#39;: &#39;_run-1&#39;},</span>
</span><span id="__span-4-476"><a id="__codelineno-4-476" name="__codelineno-4-476"></a><span class="sd">     {&#39;item&#39;: &#39;discard2&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;AP&#39;},</span>
</span><span id="__span-4-477"><a id="__codelineno-4-477" name="__codelineno-4-477"></a><span class="sd">     {&#39;item&#39;: &#39;discard3&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;PA&#39;, &#39;run_entity&#39;: &#39;_run-2&#39;}]</span>
</span><span id="__span-4-478"><a id="__codelineno-4-478" name="__codelineno-4-478"></a>
</span><span id="__span-4-479"><a id="__codelineno-4-479" name="__codelineno-4-479"></a><span class="sd">    &gt;&gt;&gt; _assign_run_on_repeat([</span>
</span><span id="__span-4-480"><a id="__codelineno-4-480" name="__codelineno-4-480"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard1&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;PA&quot;},</span>
</span><span id="__span-4-481"><a id="__codelineno-4-481" name="__codelineno-4-481"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard2&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;AP&quot;},</span>
</span><span id="__span-4-482"><a id="__codelineno-4-482" name="__codelineno-4-482"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard3&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;PA&quot;},</span>
</span><span id="__span-4-483"><a id="__codelineno-4-483" name="__codelineno-4-483"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard4&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;AP&quot;},</span>
</span><span id="__span-4-484"><a id="__codelineno-4-484" name="__codelineno-4-484"></a><span class="sd">    ... ])  # doctest: +NORMALIZE_WHITESPACE</span>
</span><span id="__span-4-485"><a id="__codelineno-4-485" name="__codelineno-4-485"></a><span class="sd">    [{&#39;item&#39;: &#39;discard1&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;PA&#39;, &#39;run_entity&#39;: &#39;_run-1&#39;},</span>
</span><span id="__span-4-486"><a id="__codelineno-4-486" name="__codelineno-4-486"></a><span class="sd">     {&#39;item&#39;: &#39;discard2&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;AP&#39;, &#39;run_entity&#39;: &#39;_run-1&#39;},</span>
</span><span id="__span-4-487"><a id="__codelineno-4-487" name="__codelineno-4-487"></a><span class="sd">     {&#39;item&#39;: &#39;discard3&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;PA&#39;, &#39;run_entity&#39;: &#39;_run-2&#39;},</span>
</span><span id="__span-4-488"><a id="__codelineno-4-488" name="__codelineno-4-488"></a><span class="sd">     {&#39;item&#39;: &#39;discard4&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;AP&#39;, &#39;run_entity&#39;: &#39;_run-2&#39;}]</span>
</span><span id="__span-4-489"><a id="__codelineno-4-489" name="__codelineno-4-489"></a>
</span><span id="__span-4-490"><a id="__codelineno-4-490" name="__codelineno-4-490"></a><span class="sd">    &gt;&gt;&gt; _assign_run_on_repeat([</span>
</span><span id="__span-4-491"><a id="__codelineno-4-491" name="__codelineno-4-491"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard1&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;PA&quot;, &quot;run&quot;: &quot;1&quot;},</span>
</span><span id="__span-4-492"><a id="__codelineno-4-492" name="__codelineno-4-492"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard2&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;AP&quot;},</span>
</span><span id="__span-4-493"><a id="__codelineno-4-493" name="__codelineno-4-493"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard3&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;PA&quot;, &quot;run&quot;: &quot;2&quot;},</span>
</span><span id="__span-4-494"><a id="__codelineno-4-494" name="__codelineno-4-494"></a><span class="sd">    ... ])  # doctest: +NORMALIZE_WHITESPACE</span>
</span><span id="__span-4-495"><a id="__codelineno-4-495" name="__codelineno-4-495"></a><span class="sd">    [{&#39;item&#39;: &#39;discard1&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;PA&#39;, &#39;run&#39;: &#39;1&#39;},</span>
</span><span id="__span-4-496"><a id="__codelineno-4-496" name="__codelineno-4-496"></a><span class="sd">     {&#39;item&#39;: &#39;discard2&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;AP&#39;},</span>
</span><span id="__span-4-497"><a id="__codelineno-4-497" name="__codelineno-4-497"></a><span class="sd">     {&#39;item&#39;: &#39;discard3&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;PA&#39;, &#39;run&#39;: &#39;2&#39;}]</span>
</span><span id="__span-4-498"><a id="__codelineno-4-498" name="__codelineno-4-498"></a>
</span><span id="__span-4-499"><a id="__codelineno-4-499" name="__codelineno-4-499"></a><span class="sd">    &gt;&gt;&gt; _assign_run_on_repeat([</span>
</span><span id="__span-4-500"><a id="__codelineno-4-500" name="__codelineno-4-500"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard1&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;PA&quot;, &quot;run_entity&quot;: &quot;_run-1&quot;},</span>
</span><span id="__span-4-501"><a id="__codelineno-4-501" name="__codelineno-4-501"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard2&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;AP&quot;},</span>
</span><span id="__span-4-502"><a id="__codelineno-4-502" name="__codelineno-4-502"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard3&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;PA&quot;, &quot;run_entity&quot;: &quot;_run-2&quot;},</span>
</span><span id="__span-4-503"><a id="__codelineno-4-503" name="__codelineno-4-503"></a><span class="sd">    ... ])  # doctest: +NORMALIZE_WHITESPACE</span>
</span><span id="__span-4-504"><a id="__codelineno-4-504" name="__codelineno-4-504"></a><span class="sd">    [{&#39;item&#39;: &#39;discard1&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;PA&#39;, &#39;run_entity&#39;: &#39;_run-1&#39;},</span>
</span><span id="__span-4-505"><a id="__codelineno-4-505" name="__codelineno-4-505"></a><span class="sd">     {&#39;item&#39;: &#39;discard2&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;AP&#39;},</span>
</span><span id="__span-4-506"><a id="__codelineno-4-506" name="__codelineno-4-506"></a><span class="sd">     {&#39;item&#39;: &#39;discard3&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;PA&#39;, &#39;run_entity&#39;: &#39;_run-2&#39;}]</span>
</span><span id="__span-4-507"><a id="__codelineno-4-507" name="__codelineno-4-507"></a>
</span><span id="__span-4-508"><a id="__codelineno-4-508" name="__codelineno-4-508"></a><span class="sd">    &gt;&gt;&gt; _assign_run_on_repeat([</span>
</span><span id="__span-4-509"><a id="__codelineno-4-509" name="__codelineno-4-509"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard1&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;PA&quot;, &quot;part_entity&quot;: &quot;_part-mag&quot;},</span>
</span><span id="__span-4-510"><a id="__codelineno-4-510" name="__codelineno-4-510"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard2&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;PA&quot;, &quot;part_entity&quot;: &quot;_part-phase&quot;},</span>
</span><span id="__span-4-511"><a id="__codelineno-4-511" name="__codelineno-4-511"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard3&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;AP&quot;, &quot;part_entity&quot;: &quot;_part-mag&quot;},</span>
</span><span id="__span-4-512"><a id="__codelineno-4-512" name="__codelineno-4-512"></a><span class="sd">    ...     {&quot;item&quot;: &quot;discard4&quot;, &quot;acq&quot;: &quot;bold&quot;, &quot;dir&quot;: &quot;AP&quot;, &quot;part_entity&quot;: &quot;_part-phase&quot;},</span>
</span><span id="__span-4-513"><a id="__codelineno-4-513" name="__codelineno-4-513"></a><span class="sd">    ... ])  # doctest: +NORMALIZE_WHITESPACE</span>
</span><span id="__span-4-514"><a id="__codelineno-4-514" name="__codelineno-4-514"></a><span class="sd">    [{&#39;item&#39;: &#39;discard1&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;PA&#39;, &#39;part_entity&#39;: &#39;_part-mag&#39;},</span>
</span><span id="__span-4-515"><a id="__codelineno-4-515" name="__codelineno-4-515"></a><span class="sd">     {&#39;item&#39;: &#39;discard2&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;PA&#39;, &#39;part_entity&#39;: &#39;_part-phase&#39;},</span>
</span><span id="__span-4-516"><a id="__codelineno-4-516" name="__codelineno-4-516"></a><span class="sd">     {&#39;item&#39;: &#39;discard3&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;AP&#39;, &#39;part_entity&#39;: &#39;_part-mag&#39;},</span>
</span><span id="__span-4-517"><a id="__codelineno-4-517" name="__codelineno-4-517"></a><span class="sd">     {&#39;item&#39;: &#39;discard4&#39;, &#39;acq&#39;: &#39;bold&#39;, &#39;dir&#39;: &#39;AP&#39;, &#39;part_entity&#39;: &#39;_part-phase&#39;}]</span>
</span><span id="__span-4-518"><a id="__codelineno-4-518" name="__codelineno-4-518"></a>
</span><span id="__span-4-519"><a id="__codelineno-4-519" name="__codelineno-4-519"></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-4-520"><a id="__codelineno-4-520" name="__codelineno-4-520"></a>    <span class="n">modality_items</span> <span class="o">=</span> <span class="n">modality_items</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-4-521"><a id="__codelineno-4-521" name="__codelineno-4-521"></a>
</span><span id="__span-4-522"><a id="__codelineno-4-522" name="__codelineno-4-522"></a>    <span class="n">str_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-4-523"><a id="__codelineno-4-523" name="__codelineno-4-523"></a>        <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;item&quot;</span><span class="p">])</span>
</span><span id="__span-4-524"><a id="__codelineno-4-524" name="__codelineno-4-524"></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">modality_items</span>
</span><span id="__span-4-525"><a id="__codelineno-4-525" name="__codelineno-4-525"></a>    <span class="p">]</span>
</span><span id="__span-4-526"><a id="__codelineno-4-526" name="__codelineno-4-526"></a>    <span class="n">strcount</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">str_patterns</span><span class="p">)</span>
</span><span id="__span-4-527"><a id="__codelineno-4-527" name="__codelineno-4-527"></a>
</span><span id="__span-4-528"><a id="__codelineno-4-528" name="__codelineno-4-528"></a>    <span class="k">for</span> <span class="n">string</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">strcount</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-4-529"><a id="__codelineno-4-529" name="__codelineno-4-529"></a>        <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-4-530"><a id="__codelineno-4-530" name="__codelineno-4-530"></a>            <span class="k">continue</span>
</span><span id="__span-4-531"><a id="__codelineno-4-531" name="__codelineno-4-531"></a>
</span><span id="__span-4-532"><a id="__codelineno-4-532" name="__codelineno-4-532"></a>        <span class="n">runid</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-4-533"><a id="__codelineno-4-533" name="__codelineno-4-533"></a>
</span><span id="__span-4-534"><a id="__codelineno-4-534" name="__codelineno-4-534"></a>        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">item_string</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">str_patterns</span><span class="p">):</span>
</span><span id="__span-4-535"><a id="__codelineno-4-535" name="__codelineno-4-535"></a>            <span class="k">if</span> <span class="n">string</span> <span class="o">==</span> <span class="n">item_string</span><span class="p">:</span>
</span><span id="__span-4-536"><a id="__codelineno-4-536" name="__codelineno-4-536"></a>                <span class="n">modality_items</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="__span-4-537"><a id="__codelineno-4-537" name="__codelineno-4-537"></a>                    <span class="p">{</span>
</span><span id="__span-4-538"><a id="__codelineno-4-538" name="__codelineno-4-538"></a>                        <span class="s2">&quot;run_entity&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;_run-</span><span class="si">{</span><span class="n">runid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-4-539"><a id="__codelineno-4-539" name="__codelineno-4-539"></a>                    <span class="p">}</span>
</span><span id="__span-4-540"><a id="__codelineno-4-540" name="__codelineno-4-540"></a>                <span class="p">)</span>
</span><span id="__span-4-541"><a id="__codelineno-4-541" name="__codelineno-4-541"></a>                <span class="n">runid</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-4-542"><a id="__codelineno-4-542" name="__codelineno-4-542"></a>
</span><span id="__span-4-543"><a id="__codelineno-4-543" name="__codelineno-4-543"></a>    <span class="k">return</span> <span class="n">modality_items</span>
</span></code></pre></div></td></tr></table></div>
</details>
<div class="admonition warning">
<p class="admonition-title">During piloting, we changed a number of settings</p>
<p>For example, the first four sessions did not follow <em>Reproin</em> conventions and filenames
varied substantially.
Please note the <code>protocols2fix</code> variable in our heuristic file, where the compatibility is implemented.</p>
</div>
<ul class="task-list">
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Run <em>HeuDiConv</em> with our heuristic file <code>&lt;path&gt;/code/heudiconv/reproin.py</code>:</p>
<div class="language-bash highlight"><span class="filename">Executing HeuDiConv</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>heudiconv<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;001&quot;</span><span class="w"> </span>-ss<span class="w"> </span><span class="s2">&quot;pilot001&quot;</span><span class="w"> </span>-b<span class="w"> </span>-l<span class="w"> </span>.<span class="w"> </span>-o<span class="w"> </span>/data/datasets/hcph/<span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">          </span>-f<span class="w"> </span>&lt;sops_clone_path&gt;/code/heudiconv/reproin.py<span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">          </span>--files<span class="w"> </span>/data/datasets/hcph-pilot-sourcedata/<span class="se">\</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">                  </span>sub-01/<span class="se">\</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">                  </span>ses-18950702/
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Session number MUST be updated manually</p>
</div>
<details class="important">
<summary>Example of the dataset organization</summary>
<p>Piloting sessions 15 and 16 look like this:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>├── ses-pilot015
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>│   ├── anat
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>│   │   ├── sub-001_ses-pilot015_acq-original_T1w.json
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>│   │   ├── sub-001_ses-pilot015_acq-original_T1w.nii.gz
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>│   │   ├── sub-001_ses-pilot015_acq-undistorted_T1w.json
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>│   │   ├── sub-001_ses-pilot015_acq-undistorted_T1w.nii.gz
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>│   │   ├── sub-001_ses-pilot015_T2w.json
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>│   │   └── sub-001_ses-pilot015_T2w.nii.gz
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>│   ├── dwi
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>│   │   ├── sub-001_ses-pilot015_acq-highres_dir-LR_dwi.bval
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>│   │   ├── sub-001_ses-pilot015_acq-highres_dir-LR_dwi.bvec
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>│   │   ├── sub-001_ses-pilot015_acq-highres_dir-LR_dwi.json
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>│   │   └── sub-001_ses-pilot015_acq-highres_dir-LR_dwi.nii.gz
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>│   ├── fmap
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>│   │   ├── sub-001_ses-pilot015_acq-b0_dir-RL_epi.json
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>│   │   ├── sub-001_ses-pilot015_acq-b0_dir-RL_epi.nii.gz
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>│   │   ├── sub-001_ses-pilot015_acq-bold_dir-RL_part-mag_epi.json
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>│   │   ├── sub-001_ses-pilot015_acq-bold_dir-RL_part-mag_epi.nii.gz
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>│   │   ├── sub-001_ses-pilot015_acq-bold_dir-RL_part-phase_epi.json
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>│   │   ├── sub-001_ses-pilot015_acq-bold_dir-RL_part-phase_epi.nii.gz
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>│   │   ├── sub-001_ses-pilot015_magnitude1.json
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>│   │   ├── sub-001_ses-pilot015_magnitude1.nii.gz
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>│   │   ├── sub-001_ses-pilot015_magnitude2.json
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>│   │   ├── sub-001_ses-pilot015_magnitude2.nii.gz
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>│   │   ├── sub-001_ses-pilot015_phasediff.json
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>│   │   └── sub-001_ses-pilot015_phasediff.nii.gz
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>│   ├── func
</span><span id="__span-6-28"><a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-1_part-mag_bold.json
</span><span id="__span-6-29"><a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-1_part-mag_bold.nii.gz
</span><span id="__span-6-30"><a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-1_part-phase_bold.json
</span><span id="__span-6-31"><a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-1_part-phase_bold.nii.gz
</span><span id="__span-6-32"><a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-2_part-mag_bold.json
</span><span id="__span-6-33"><a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-2_part-mag_bold.nii.gz
</span><span id="__span-6-34"><a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-2_part-phase_bold.json
</span><span id="__span-6-35"><a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-2_part-phase_bold.nii.gz
</span><span id="__span-6-36"><a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-3_part-mag_bold.json
</span><span id="__span-6-37"><a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-3_part-mag_bold.nii.gz
</span><span id="__span-6-38"><a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-3_part-phase_bold.json
</span><span id="__span-6-39"><a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-3_part-phase_bold.nii.gz
</span><span id="__span-6-40"><a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-4_part-mag_bold.json
</span><span id="__span-6-41"><a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-4_part-mag_bold.nii.gz
</span><span id="__span-6-42"><a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-4_part-phase_bold.json
</span><span id="__span-6-43"><a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a>│   │   ├── sub-001_ses-pilot015_task-bht_echo-4_part-phase_bold.nii.gz
</span><span id="__span-6-44"><a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a>│   │   ├── sub-001_ses-pilot015_task-bht_part-mag_events.tsv
</span><span id="__span-6-45"><a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a>│   │   ├── sub-001_ses-pilot015_task-bht_part-phase_events.tsv
</span><span id="__span-6-46"><a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-1_part-mag_bold.json
</span><span id="__span-6-47"><a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-1_part-mag_bold.nii.gz
</span><span id="__span-6-48"><a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-1_part-phase_bold.json
</span><span id="__span-6-49"><a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-1_part-phase_bold.nii.gz
</span><span id="__span-6-50"><a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-2_part-mag_bold.json
</span><span id="__span-6-51"><a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-2_part-mag_bold.nii.gz
</span><span id="__span-6-52"><a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-2_part-phase_bold.json
</span><span id="__span-6-53"><a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-2_part-phase_bold.nii.gz
</span><span id="__span-6-54"><a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-3_part-mag_bold.json
</span><span id="__span-6-55"><a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-3_part-mag_bold.nii.gz
</span><span id="__span-6-56"><a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-3_part-phase_bold.json
</span><span id="__span-6-57"><a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-3_part-phase_bold.nii.gz
</span><span id="__span-6-58"><a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-4_part-mag_bold.json
</span><span id="__span-6-59"><a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-4_part-mag_bold.nii.gz
</span><span id="__span-6-60"><a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-4_part-phase_bold.json
</span><span id="__span-6-61"><a id="__codelineno-6-61" name="__codelineno-6-61" href="#__codelineno-6-61"></a>│   │   ├── sub-001_ses-pilot015_task-qct_echo-4_part-phase_bold.nii.gz
</span><span id="__span-6-62"><a id="__codelineno-6-62" name="__codelineno-6-62" href="#__codelineno-6-62"></a>│   │   ├── sub-001_ses-pilot015_task-qct_part-mag_events.tsv
</span><span id="__span-6-63"><a id="__codelineno-6-63" name="__codelineno-6-63" href="#__codelineno-6-63"></a>│   │   ├── sub-001_ses-pilot015_task-qct_part-phase_events.tsv
</span><span id="__span-6-64"><a id="__codelineno-6-64" name="__codelineno-6-64" href="#__codelineno-6-64"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-1_part-mag_bold.json
</span><span id="__span-6-65"><a id="__codelineno-6-65" name="__codelineno-6-65" href="#__codelineno-6-65"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-1_part-mag_bold.nii.gz
</span><span id="__span-6-66"><a id="__codelineno-6-66" name="__codelineno-6-66" href="#__codelineno-6-66"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-1_part-phase_bold.json
</span><span id="__span-6-67"><a id="__codelineno-6-67" name="__codelineno-6-67" href="#__codelineno-6-67"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-1_part-phase_bold.nii.gz
</span><span id="__span-6-68"><a id="__codelineno-6-68" name="__codelineno-6-68" href="#__codelineno-6-68"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-2_part-mag_bold.json
</span><span id="__span-6-69"><a id="__codelineno-6-69" name="__codelineno-6-69" href="#__codelineno-6-69"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-2_part-mag_bold.nii.gz
</span><span id="__span-6-70"><a id="__codelineno-6-70" name="__codelineno-6-70" href="#__codelineno-6-70"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-2_part-phase_bold.json
</span><span id="__span-6-71"><a id="__codelineno-6-71" name="__codelineno-6-71" href="#__codelineno-6-71"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-2_part-phase_bold.nii.gz
</span><span id="__span-6-72"><a id="__codelineno-6-72" name="__codelineno-6-72" href="#__codelineno-6-72"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-3_part-mag_bold.json
</span><span id="__span-6-73"><a id="__codelineno-6-73" name="__codelineno-6-73" href="#__codelineno-6-73"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-3_part-mag_bold.nii.gz
</span><span id="__span-6-74"><a id="__codelineno-6-74" name="__codelineno-6-74" href="#__codelineno-6-74"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-3_part-phase_bold.json
</span><span id="__span-6-75"><a id="__codelineno-6-75" name="__codelineno-6-75" href="#__codelineno-6-75"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-3_part-phase_bold.nii.gz
</span><span id="__span-6-76"><a id="__codelineno-6-76" name="__codelineno-6-76" href="#__codelineno-6-76"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-4_part-mag_bold.json
</span><span id="__span-6-77"><a id="__codelineno-6-77" name="__codelineno-6-77" href="#__codelineno-6-77"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-4_part-mag_bold.nii.gz
</span><span id="__span-6-78"><a id="__codelineno-6-78" name="__codelineno-6-78" href="#__codelineno-6-78"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-4_part-phase_bold.json
</span><span id="__span-6-79"><a id="__codelineno-6-79" name="__codelineno-6-79" href="#__codelineno-6-79"></a>│   │   ├── sub-001_ses-pilot015_task-rest_echo-4_part-phase_bold.nii.gz
</span><span id="__span-6-80"><a id="__codelineno-6-80" name="__codelineno-6-80" href="#__codelineno-6-80"></a>│   │   ├── sub-001_ses-pilot015_task-rest_part-mag_events.tsv
</span><span id="__span-6-81"><a id="__codelineno-6-81" name="__codelineno-6-81" href="#__codelineno-6-81"></a>│   │   └── sub-001_ses-pilot015_task-rest_part-phase_events.tsv
</span><span id="__span-6-82"><a id="__codelineno-6-82" name="__codelineno-6-82" href="#__codelineno-6-82"></a>│   └── sub-001_ses-pilot015_scans.tsv
</span><span id="__span-6-83"><a id="__codelineno-6-83" name="__codelineno-6-83" href="#__codelineno-6-83"></a>└── ses-pilot016
</span><span id="__span-6-84"><a id="__codelineno-6-84" name="__codelineno-6-84" href="#__codelineno-6-84"></a>    ├── anat
</span><span id="__span-6-85"><a id="__codelineno-6-85" name="__codelineno-6-85" href="#__codelineno-6-85"></a>    │   ├── sub-001_ses-pilot016_acq-original_T1w.json
</span><span id="__span-6-86"><a id="__codelineno-6-86" name="__codelineno-6-86" href="#__codelineno-6-86"></a>    │   ├── sub-001_ses-pilot016_acq-original_T1w.nii.gz
</span><span id="__span-6-87"><a id="__codelineno-6-87" name="__codelineno-6-87" href="#__codelineno-6-87"></a>    │   ├── sub-001_ses-pilot016_acq-undistorted_T1w.json
</span><span id="__span-6-88"><a id="__codelineno-6-88" name="__codelineno-6-88" href="#__codelineno-6-88"></a>    │   ├── sub-001_ses-pilot016_acq-undistorted_T1w.nii.gz
</span><span id="__span-6-89"><a id="__codelineno-6-89" name="__codelineno-6-89" href="#__codelineno-6-89"></a>    │   ├── sub-001_ses-pilot016_T2w.json
</span><span id="__span-6-90"><a id="__codelineno-6-90" name="__codelineno-6-90" href="#__codelineno-6-90"></a>    │   └── sub-001_ses-pilot016_T2w.nii.gz
</span><span id="__span-6-91"><a id="__codelineno-6-91" name="__codelineno-6-91" href="#__codelineno-6-91"></a>    ├── dwi
</span><span id="__span-6-92"><a id="__codelineno-6-92" name="__codelineno-6-92" href="#__codelineno-6-92"></a>    │   ├── sub-001_ses-pilot016_acq-highres_dir-RL_dwi.bval
</span><span id="__span-6-93"><a id="__codelineno-6-93" name="__codelineno-6-93" href="#__codelineno-6-93"></a>    │   ├── sub-001_ses-pilot016_acq-highres_dir-RL_dwi.bvec
</span><span id="__span-6-94"><a id="__codelineno-6-94" name="__codelineno-6-94" href="#__codelineno-6-94"></a>    │   ├── sub-001_ses-pilot016_acq-highres_dir-RL_dwi.json
</span><span id="__span-6-95"><a id="__codelineno-6-95" name="__codelineno-6-95" href="#__codelineno-6-95"></a>    │   └── sub-001_ses-pilot016_acq-highres_dir-RL_dwi.nii.gz
</span><span id="__span-6-96"><a id="__codelineno-6-96" name="__codelineno-6-96" href="#__codelineno-6-96"></a>    ├── fmap
</span><span id="__span-6-97"><a id="__codelineno-6-97" name="__codelineno-6-97" href="#__codelineno-6-97"></a>    │   ├── sub-001_ses-pilot016_acq-b0_dir-AP_epi.json
</span><span id="__span-6-98"><a id="__codelineno-6-98" name="__codelineno-6-98" href="#__codelineno-6-98"></a>    │   ├── sub-001_ses-pilot016_acq-b0_dir-AP_epi.nii.gz
</span><span id="__span-6-99"><a id="__codelineno-6-99" name="__codelineno-6-99" href="#__codelineno-6-99"></a>    │   ├── sub-001_ses-pilot016_acq-b0_dir-LR_epi.json
</span><span id="__span-6-100"><a id="__codelineno-6-100" name="__codelineno-6-100" href="#__codelineno-6-100"></a>    │   ├── sub-001_ses-pilot016_acq-b0_dir-LR_epi.nii.gz
</span><span id="__span-6-101"><a id="__codelineno-6-101" name="__codelineno-6-101" href="#__codelineno-6-101"></a>    │   ├── sub-001_ses-pilot016_acq-b0_dir-PA_epi.json
</span><span id="__span-6-102"><a id="__codelineno-6-102" name="__codelineno-6-102" href="#__codelineno-6-102"></a>    │   ├── sub-001_ses-pilot016_acq-b0_dir-PA_epi.nii.gz
</span><span id="__span-6-103"><a id="__codelineno-6-103" name="__codelineno-6-103" href="#__codelineno-6-103"></a>    │   ├── sub-001_ses-pilot016_acq-b0_dir-RL_epi.json
</span><span id="__span-6-104"><a id="__codelineno-6-104" name="__codelineno-6-104" href="#__codelineno-6-104"></a>    │   ├── sub-001_ses-pilot016_acq-b0_dir-RL_epi.nii.gz
</span><span id="__span-6-105"><a id="__codelineno-6-105" name="__codelineno-6-105" href="#__codelineno-6-105"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-AP_part-mag_epi.json
</span><span id="__span-6-106"><a id="__codelineno-6-106" name="__codelineno-6-106" href="#__codelineno-6-106"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-AP_part-mag_epi.nii.gz
</span><span id="__span-6-107"><a id="__codelineno-6-107" name="__codelineno-6-107" href="#__codelineno-6-107"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-AP_part-phase_epi.json
</span><span id="__span-6-108"><a id="__codelineno-6-108" name="__codelineno-6-108" href="#__codelineno-6-108"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-AP_part-phase_epi.nii.gz
</span><span id="__span-6-109"><a id="__codelineno-6-109" name="__codelineno-6-109" href="#__codelineno-6-109"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-LR_part-mag_epi.json
</span><span id="__span-6-110"><a id="__codelineno-6-110" name="__codelineno-6-110" href="#__codelineno-6-110"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-LR_part-mag_epi.nii.gz
</span><span id="__span-6-111"><a id="__codelineno-6-111" name="__codelineno-6-111" href="#__codelineno-6-111"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-LR_part-phase_epi.json
</span><span id="__span-6-112"><a id="__codelineno-6-112" name="__codelineno-6-112" href="#__codelineno-6-112"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-LR_part-phase_epi.nii.gz
</span><span id="__span-6-113"><a id="__codelineno-6-113" name="__codelineno-6-113" href="#__codelineno-6-113"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-PA_part-mag_epi.json
</span><span id="__span-6-114"><a id="__codelineno-6-114" name="__codelineno-6-114" href="#__codelineno-6-114"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-PA_part-mag_epi.nii.gz
</span><span id="__span-6-115"><a id="__codelineno-6-115" name="__codelineno-6-115" href="#__codelineno-6-115"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-PA_part-phase_epi.json
</span><span id="__span-6-116"><a id="__codelineno-6-116" name="__codelineno-6-116" href="#__codelineno-6-116"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-PA_part-phase_epi.nii.gz
</span><span id="__span-6-117"><a id="__codelineno-6-117" name="__codelineno-6-117" href="#__codelineno-6-117"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-RL_part-mag_epi.json
</span><span id="__span-6-118"><a id="__codelineno-6-118" name="__codelineno-6-118" href="#__codelineno-6-118"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-RL_part-mag_epi.nii.gz
</span><span id="__span-6-119"><a id="__codelineno-6-119" name="__codelineno-6-119" href="#__codelineno-6-119"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-RL_part-phase_epi.json
</span><span id="__span-6-120"><a id="__codelineno-6-120" name="__codelineno-6-120" href="#__codelineno-6-120"></a>    │   ├── sub-001_ses-pilot016_acq-bold_dir-RL_part-phase_epi.nii.gz
</span><span id="__span-6-121"><a id="__codelineno-6-121" name="__codelineno-6-121" href="#__codelineno-6-121"></a>    │   ├── sub-001_ses-pilot016_magnitude1.json
</span><span id="__span-6-122"><a id="__codelineno-6-122" name="__codelineno-6-122" href="#__codelineno-6-122"></a>    │   ├── sub-001_ses-pilot016_magnitude1.nii.gz
</span><span id="__span-6-123"><a id="__codelineno-6-123" name="__codelineno-6-123" href="#__codelineno-6-123"></a>    │   ├── sub-001_ses-pilot016_magnitude2.json
</span><span id="__span-6-124"><a id="__codelineno-6-124" name="__codelineno-6-124" href="#__codelineno-6-124"></a>    │   ├── sub-001_ses-pilot016_magnitude2.nii.gz
</span><span id="__span-6-125"><a id="__codelineno-6-125" name="__codelineno-6-125" href="#__codelineno-6-125"></a>    │   ├── sub-001_ses-pilot016_phasediff.json
</span><span id="__span-6-126"><a id="__codelineno-6-126" name="__codelineno-6-126" href="#__codelineno-6-126"></a>    │   └── sub-001_ses-pilot016_phasediff.nii.gz
</span><span id="__span-6-127"><a id="__codelineno-6-127" name="__codelineno-6-127" href="#__codelineno-6-127"></a>    ├── func
</span><span id="__span-6-128"><a id="__codelineno-6-128" name="__codelineno-6-128" href="#__codelineno-6-128"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-1_part-mag_bold.json
</span><span id="__span-6-129"><a id="__codelineno-6-129" name="__codelineno-6-129" href="#__codelineno-6-129"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-1_part-mag_bold.nii.gz
</span><span id="__span-6-130"><a id="__codelineno-6-130" name="__codelineno-6-130" href="#__codelineno-6-130"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-1_part-phase_bold.json
</span><span id="__span-6-131"><a id="__codelineno-6-131" name="__codelineno-6-131" href="#__codelineno-6-131"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-1_part-phase_bold.nii.gz
</span><span id="__span-6-132"><a id="__codelineno-6-132" name="__codelineno-6-132" href="#__codelineno-6-132"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-2_part-mag_bold.json
</span><span id="__span-6-133"><a id="__codelineno-6-133" name="__codelineno-6-133" href="#__codelineno-6-133"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-2_part-mag_bold.nii.gz
</span><span id="__span-6-134"><a id="__codelineno-6-134" name="__codelineno-6-134" href="#__codelineno-6-134"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-2_part-phase_bold.json
</span><span id="__span-6-135"><a id="__codelineno-6-135" name="__codelineno-6-135" href="#__codelineno-6-135"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-2_part-phase_bold.nii.gz
</span><span id="__span-6-136"><a id="__codelineno-6-136" name="__codelineno-6-136" href="#__codelineno-6-136"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-3_part-mag_bold.json
</span><span id="__span-6-137"><a id="__codelineno-6-137" name="__codelineno-6-137" href="#__codelineno-6-137"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-3_part-mag_bold.nii.gz
</span><span id="__span-6-138"><a id="__codelineno-6-138" name="__codelineno-6-138" href="#__codelineno-6-138"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-3_part-phase_bold.json
</span><span id="__span-6-139"><a id="__codelineno-6-139" name="__codelineno-6-139" href="#__codelineno-6-139"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-3_part-phase_bold.nii.gz
</span><span id="__span-6-140"><a id="__codelineno-6-140" name="__codelineno-6-140" href="#__codelineno-6-140"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-4_part-mag_bold.json
</span><span id="__span-6-141"><a id="__codelineno-6-141" name="__codelineno-6-141" href="#__codelineno-6-141"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-4_part-mag_bold.nii.gz
</span><span id="__span-6-142"><a id="__codelineno-6-142" name="__codelineno-6-142" href="#__codelineno-6-142"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-4_part-phase_bold.json
</span><span id="__span-6-143"><a id="__codelineno-6-143" name="__codelineno-6-143" href="#__codelineno-6-143"></a>    │   ├── sub-001_ses-pilot016_task-bht_echo-4_part-phase_bold.nii.gz
</span><span id="__span-6-144"><a id="__codelineno-6-144" name="__codelineno-6-144" href="#__codelineno-6-144"></a>    │   ├── sub-001_ses-pilot016_task-bht_part-mag_events.tsv
</span><span id="__span-6-145"><a id="__codelineno-6-145" name="__codelineno-6-145" href="#__codelineno-6-145"></a>    │   ├── sub-001_ses-pilot016_task-bht_part-phase_events.tsv
</span><span id="__span-6-146"><a id="__codelineno-6-146" name="__codelineno-6-146" href="#__codelineno-6-146"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-1_part-mag_bold.json
</span><span id="__span-6-147"><a id="__codelineno-6-147" name="__codelineno-6-147" href="#__codelineno-6-147"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-1_part-mag_bold.nii.gz
</span><span id="__span-6-148"><a id="__codelineno-6-148" name="__codelineno-6-148" href="#__codelineno-6-148"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-1_part-phase_bold.json
</span><span id="__span-6-149"><a id="__codelineno-6-149" name="__codelineno-6-149" href="#__codelineno-6-149"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-1_part-phase_bold.nii.gz
</span><span id="__span-6-150"><a id="__codelineno-6-150" name="__codelineno-6-150" href="#__codelineno-6-150"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-2_part-mag_bold.json
</span><span id="__span-6-151"><a id="__codelineno-6-151" name="__codelineno-6-151" href="#__codelineno-6-151"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-2_part-mag_bold.nii.gz
</span><span id="__span-6-152"><a id="__codelineno-6-152" name="__codelineno-6-152" href="#__codelineno-6-152"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-2_part-phase_bold.json
</span><span id="__span-6-153"><a id="__codelineno-6-153" name="__codelineno-6-153" href="#__codelineno-6-153"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-2_part-phase_bold.nii.gz
</span><span id="__span-6-154"><a id="__codelineno-6-154" name="__codelineno-6-154" href="#__codelineno-6-154"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-3_part-mag_bold.json
</span><span id="__span-6-155"><a id="__codelineno-6-155" name="__codelineno-6-155" href="#__codelineno-6-155"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-3_part-mag_bold.nii.gz
</span><span id="__span-6-156"><a id="__codelineno-6-156" name="__codelineno-6-156" href="#__codelineno-6-156"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-3_part-phase_bold.json
</span><span id="__span-6-157"><a id="__codelineno-6-157" name="__codelineno-6-157" href="#__codelineno-6-157"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-3_part-phase_bold.nii.gz
</span><span id="__span-6-158"><a id="__codelineno-6-158" name="__codelineno-6-158" href="#__codelineno-6-158"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-4_part-mag_bold.json
</span><span id="__span-6-159"><a id="__codelineno-6-159" name="__codelineno-6-159" href="#__codelineno-6-159"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-4_part-mag_bold.nii.gz
</span><span id="__span-6-160"><a id="__codelineno-6-160" name="__codelineno-6-160" href="#__codelineno-6-160"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-4_part-phase_bold.json
</span><span id="__span-6-161"><a id="__codelineno-6-161" name="__codelineno-6-161" href="#__codelineno-6-161"></a>    │   ├── sub-001_ses-pilot016_task-qct_echo-4_part-phase_bold.nii.gz
</span><span id="__span-6-162"><a id="__codelineno-6-162" name="__codelineno-6-162" href="#__codelineno-6-162"></a>    │   ├── sub-001_ses-pilot016_task-qct_part-mag_events.tsv
</span><span id="__span-6-163"><a id="__codelineno-6-163" name="__codelineno-6-163" href="#__codelineno-6-163"></a>    │   ├── sub-001_ses-pilot016_task-qct_part-phase_events.tsv
</span><span id="__span-6-164"><a id="__codelineno-6-164" name="__codelineno-6-164" href="#__codelineno-6-164"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-1_part-mag_bold.json
</span><span id="__span-6-165"><a id="__codelineno-6-165" name="__codelineno-6-165" href="#__codelineno-6-165"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-1_part-mag_bold.nii.gz
</span><span id="__span-6-166"><a id="__codelineno-6-166" name="__codelineno-6-166" href="#__codelineno-6-166"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-1_part-phase_bold.json
</span><span id="__span-6-167"><a id="__codelineno-6-167" name="__codelineno-6-167" href="#__codelineno-6-167"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-1_part-phase_bold.nii.gz
</span><span id="__span-6-168"><a id="__codelineno-6-168" name="__codelineno-6-168" href="#__codelineno-6-168"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-2_part-mag_bold.json
</span><span id="__span-6-169"><a id="__codelineno-6-169" name="__codelineno-6-169" href="#__codelineno-6-169"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-2_part-mag_bold.nii.gz
</span><span id="__span-6-170"><a id="__codelineno-6-170" name="__codelineno-6-170" href="#__codelineno-6-170"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-2_part-phase_bold.json
</span><span id="__span-6-171"><a id="__codelineno-6-171" name="__codelineno-6-171" href="#__codelineno-6-171"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-2_part-phase_bold.nii.gz
</span><span id="__span-6-172"><a id="__codelineno-6-172" name="__codelineno-6-172" href="#__codelineno-6-172"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-3_part-mag_bold.json
</span><span id="__span-6-173"><a id="__codelineno-6-173" name="__codelineno-6-173" href="#__codelineno-6-173"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-3_part-mag_bold.nii.gz
</span><span id="__span-6-174"><a id="__codelineno-6-174" name="__codelineno-6-174" href="#__codelineno-6-174"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-3_part-phase_bold.json
</span><span id="__span-6-175"><a id="__codelineno-6-175" name="__codelineno-6-175" href="#__codelineno-6-175"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-3_part-phase_bold.nii.gz
</span><span id="__span-6-176"><a id="__codelineno-6-176" name="__codelineno-6-176" href="#__codelineno-6-176"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-4_part-mag_bold.json
</span><span id="__span-6-177"><a id="__codelineno-6-177" name="__codelineno-6-177" href="#__codelineno-6-177"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-4_part-mag_bold.nii.gz
</span><span id="__span-6-178"><a id="__codelineno-6-178" name="__codelineno-6-178" href="#__codelineno-6-178"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-4_part-phase_bold.json
</span><span id="__span-6-179"><a id="__codelineno-6-179" name="__codelineno-6-179" href="#__codelineno-6-179"></a>    │   ├── sub-001_ses-pilot016_task-rest_echo-4_part-phase_bold.nii.gz
</span><span id="__span-6-180"><a id="__codelineno-6-180" name="__codelineno-6-180" href="#__codelineno-6-180"></a>    │   ├── sub-001_ses-pilot016_task-rest_part-mag_events.tsv
</span><span id="__span-6-181"><a id="__codelineno-6-181" name="__codelineno-6-181" href="#__codelineno-6-181"></a>    │   └── sub-001_ses-pilot016_task-rest_part-phase_events.tsv
</span><span id="__span-6-182"><a id="__codelineno-6-182" name="__codelineno-6-182" href="#__codelineno-6-182"></a>    └── sub-001_ses-pilot016_scans.tsv
</span></code></pre></div>
</details>
<details class="warning">
<summary>We started to generate phase and magnitude only after session 15</summary>
<p>As a result, the piloting data up to session 14 will look more like:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>├── ses-pilot014
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>│   ├── anat
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>│   │   ├── sub-001_ses-pilot014_acq-original_T1w.json
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>│   │   ├── sub-001_ses-pilot014_acq-original_T1w.nii.gz
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>│   │   ├── sub-001_ses-pilot014_acq-undistorted_T1w.json
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>│   │   ├── sub-001_ses-pilot014_acq-undistorted_T1w.nii.gz
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>│   │   ├── sub-001_ses-pilot014_T2w.json
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>│   │   └── sub-001_ses-pilot014_T2w.nii.gz
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>│   ├── dwi
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>│   │   ├── sub-001_ses-pilot014_acq-highres_dir-PA_dwi.bval
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>│   │   ├── sub-001_ses-pilot014_acq-highres_dir-PA_dwi.bvec
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>│   │   ├── sub-001_ses-pilot014_acq-highres_dir-PA_dwi.json
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>│   │   └── sub-001_ses-pilot014_acq-highres_dir-PA_dwi.nii.gz
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>│   ├── fmap
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>│   │   ├── sub-001_ses-pilot014_acq-b0_dir-AP_epi.json
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>│   │   ├── sub-001_ses-pilot014_acq-b0_dir-AP_epi.nii.gz
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>│   │   ├── sub-001_ses-pilot014_acq-bold_dir-PA_run-1_epi.json
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>│   │   ├── sub-001_ses-pilot014_acq-bold_dir-PA_run-1_epi.nii.gz
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>│   │   ├── sub-001_ses-pilot014_acq-bold_dir-PA_run-2_epi.json
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>│   │   ├── sub-001_ses-pilot014_acq-bold_dir-PA_run-2_epi.nii.gz
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>│   │   ├── sub-001_ses-pilot014_magnitude1.json
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>│   │   ├── sub-001_ses-pilot014_magnitude1.nii.gz
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>│   │   ├── sub-001_ses-pilot014_magnitude2.json
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>│   │   ├── sub-001_ses-pilot014_magnitude2.nii.gz
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>│   │   ├── sub-001_ses-pilot014_phasediff.json
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a>│   │   └── sub-001_ses-pilot014_phasediff.nii.gz
</span><span id="__span-7-27"><a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>│   ├── func
</span><span id="__span-7-28"><a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>│   │   ├── sub-001_ses-pilot014_task-bht_echo-1_bold.json
</span><span id="__span-7-29"><a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>│   │   ├── sub-001_ses-pilot014_task-bht_echo-1_bold.nii.gz
</span><span id="__span-7-30"><a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a>│   │   ├── sub-001_ses-pilot014_task-bht_echo-2_bold.json
</span><span id="__span-7-31"><a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a>│   │   ├── sub-001_ses-pilot014_task-bht_echo-2_bold.nii.gz
</span><span id="__span-7-32"><a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a>│   │   ├── sub-001_ses-pilot014_task-bht_echo-3_bold.json
</span><span id="__span-7-33"><a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a>│   │   ├── sub-001_ses-pilot014_task-bht_echo-3_bold.nii.gz
</span><span id="__span-7-34"><a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a>│   │   ├── sub-001_ses-pilot014_task-bht_echo-4_bold.json
</span><span id="__span-7-35"><a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a>│   │   ├── sub-001_ses-pilot014_task-bht_echo-4_bold.nii.gz
</span><span id="__span-7-36"><a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a>│   │   ├── sub-001_ses-pilot014_task-bht_events.tsv
</span><span id="__span-7-37"><a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-1_echo-1_bold.json
</span><span id="__span-7-38"><a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-1_echo-1_bold.nii.gz
</span><span id="__span-7-39"><a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-1_echo-2_bold.json
</span><span id="__span-7-40"><a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-1_echo-2_bold.nii.gz
</span><span id="__span-7-41"><a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-1_echo-3_bold.json
</span><span id="__span-7-42"><a id="__codelineno-7-42" name="__codelineno-7-42" href="#__codelineno-7-42"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-1_echo-3_bold.nii.gz
</span><span id="__span-7-43"><a id="__codelineno-7-43" name="__codelineno-7-43" href="#__codelineno-7-43"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-1_echo-4_bold.json
</span><span id="__span-7-44"><a id="__codelineno-7-44" name="__codelineno-7-44" href="#__codelineno-7-44"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-1_echo-4_bold.nii.gz
</span><span id="__span-7-45"><a id="__codelineno-7-45" name="__codelineno-7-45" href="#__codelineno-7-45"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-1_events.tsv
</span><span id="__span-7-46"><a id="__codelineno-7-46" name="__codelineno-7-46" href="#__codelineno-7-46"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-2_echo-1_bold.json
</span><span id="__span-7-47"><a id="__codelineno-7-47" name="__codelineno-7-47" href="#__codelineno-7-47"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-2_echo-1_bold.nii.gz
</span><span id="__span-7-48"><a id="__codelineno-7-48" name="__codelineno-7-48" href="#__codelineno-7-48"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-2_echo-2_bold.json
</span><span id="__span-7-49"><a id="__codelineno-7-49" name="__codelineno-7-49" href="#__codelineno-7-49"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-2_echo-2_bold.nii.gz
</span><span id="__span-7-50"><a id="__codelineno-7-50" name="__codelineno-7-50" href="#__codelineno-7-50"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-2_echo-3_bold.json
</span><span id="__span-7-51"><a id="__codelineno-7-51" name="__codelineno-7-51" href="#__codelineno-7-51"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-2_echo-3_bold.nii.gz
</span><span id="__span-7-52"><a id="__codelineno-7-52" name="__codelineno-7-52" href="#__codelineno-7-52"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-2_echo-4_bold.json
</span><span id="__span-7-53"><a id="__codelineno-7-53" name="__codelineno-7-53" href="#__codelineno-7-53"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-2_echo-4_bold.nii.gz
</span><span id="__span-7-54"><a id="__codelineno-7-54" name="__codelineno-7-54" href="#__codelineno-7-54"></a>│   │   ├── sub-001_ses-pilot014_task-bht_run-2_events.tsv
</span><span id="__span-7-55"><a id="__codelineno-7-55" name="__codelineno-7-55" href="#__codelineno-7-55"></a>│   │   ├── sub-001_ses-pilot014_task-qct_echo-1_bold.json
</span><span id="__span-7-56"><a id="__codelineno-7-56" name="__codelineno-7-56" href="#__codelineno-7-56"></a>│   │   ├── sub-001_ses-pilot014_task-qct_echo-1_bold.nii.gz
</span><span id="__span-7-57"><a id="__codelineno-7-57" name="__codelineno-7-57" href="#__codelineno-7-57"></a>│   │   ├── sub-001_ses-pilot014_task-qct_echo-2_bold.json
</span><span id="__span-7-58"><a id="__codelineno-7-58" name="__codelineno-7-58" href="#__codelineno-7-58"></a>│   │   ├── sub-001_ses-pilot014_task-qct_echo-2_bold.nii.gz
</span><span id="__span-7-59"><a id="__codelineno-7-59" name="__codelineno-7-59" href="#__codelineno-7-59"></a>│   │   ├── sub-001_ses-pilot014_task-qct_echo-3_bold.json
</span><span id="__span-7-60"><a id="__codelineno-7-60" name="__codelineno-7-60" href="#__codelineno-7-60"></a>│   │   ├── sub-001_ses-pilot014_task-qct_echo-3_bold.nii.gz
</span><span id="__span-7-61"><a id="__codelineno-7-61" name="__codelineno-7-61" href="#__codelineno-7-61"></a>│   │   ├── sub-001_ses-pilot014_task-qct_echo-4_bold.json
</span><span id="__span-7-62"><a id="__codelineno-7-62" name="__codelineno-7-62" href="#__codelineno-7-62"></a>│   │   ├── sub-001_ses-pilot014_task-qct_echo-4_bold.nii.gz
</span><span id="__span-7-63"><a id="__codelineno-7-63" name="__codelineno-7-63" href="#__codelineno-7-63"></a>│   │   ├── sub-001_ses-pilot014_task-qct_events.tsv
</span><span id="__span-7-64"><a id="__codelineno-7-64" name="__codelineno-7-64" href="#__codelineno-7-64"></a>│   │   ├── sub-001_ses-pilot014_task-rest_echo-1_bold.json
</span><span id="__span-7-65"><a id="__codelineno-7-65" name="__codelineno-7-65" href="#__codelineno-7-65"></a>│   │   ├── sub-001_ses-pilot014_task-rest_echo-1_bold.nii.gz
</span><span id="__span-7-66"><a id="__codelineno-7-66" name="__codelineno-7-66" href="#__codelineno-7-66"></a>│   │   ├── sub-001_ses-pilot014_task-rest_echo-2_bold.json
</span><span id="__span-7-67"><a id="__codelineno-7-67" name="__codelineno-7-67" href="#__codelineno-7-67"></a>│   │   ├── sub-001_ses-pilot014_task-rest_echo-2_bold.nii.gz
</span><span id="__span-7-68"><a id="__codelineno-7-68" name="__codelineno-7-68" href="#__codelineno-7-68"></a>│   │   ├── sub-001_ses-pilot014_task-rest_echo-3_bold.json
</span><span id="__span-7-69"><a id="__codelineno-7-69" name="__codelineno-7-69" href="#__codelineno-7-69"></a>│   │   ├── sub-001_ses-pilot014_task-rest_echo-3_bold.nii.gz
</span><span id="__span-7-70"><a id="__codelineno-7-70" name="__codelineno-7-70" href="#__codelineno-7-70"></a>│   │   ├── sub-001_ses-pilot014_task-rest_echo-4_bold.json
</span><span id="__span-7-71"><a id="__codelineno-7-71" name="__codelineno-7-71" href="#__codelineno-7-71"></a>│   │   ├── sub-001_ses-pilot014_task-rest_echo-4_bold.nii.gz
</span><span id="__span-7-72"><a id="__codelineno-7-72" name="__codelineno-7-72" href="#__codelineno-7-72"></a>│   │   └── sub-001_ses-pilot014_task-rest_events.tsv
</span><span id="__span-7-73"><a id="__codelineno-7-73" name="__codelineno-7-73" href="#__codelineno-7-73"></a>│   └── sub-001_ses-pilot014_scans.tsv
</span></code></pre></div>
</details>
</li>
</ul>
<h3 id="clean-up-after-bids-conversion-and-preparation-for-archival">Clean-up after <abbr title="Brain Imaging Data Structure">BIDS</abbr> conversion and preparation for archival<a class="headerlink" href="#clean-up-after-bids-conversion-and-preparation-for-archival" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Delete incorrect files generated by <em>HeuDiConv</em>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>find<span class="w"> </span>sub-001/<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*_part-mag_events.tsv&quot;</span><span class="w"> </span>-or<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*_part-phase_events.tsv&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>rm
</span></code></pre></div>
</li>
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Compact <abbr title="Digital Imaging and Communications in Medicine">DICOM</abbr> session folder and remove it if successful</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>tar<span class="w"> </span>vczf<span class="w"> </span>ses-18950702.tar.gz<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">         </span>/data/datasets/hcph-sourcedata/<span class="se">\</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">         </span>sub-01/<span class="se">\</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">         </span>ses-18950702<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>rm<span class="w"> </span>-rf<span class="w"> </span>/data/datasets/hcph-sourcedata/<span class="se">\</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">       </span>sub-01/<span class="se">\</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">       </span>ses-18950702
</span></code></pre></div>
</li>
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Remove write permissions on the newly downloaded data:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>chmod<span class="w"> </span>-R<span class="w"> </span>a-w<span class="w"> </span>/data/datasets/hcph-sourcedata/sub-01/
</span></code></pre></div>
</li>
</ul>
<h3 id="generate-bids-events-files">Generate <abbr title="Brain Imaging Data Structure">BIDS</abbr>' <em>events</em> files<a class="headerlink" href="#generate-bids-events-files" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Execute conversion with <code>code/events/psychopy2events</code>:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>python<span class="w"> </span>psychopy2events.py<span class="w"> </span>--path<span class="w"> </span>./outputdir/sub-001/ses-pilot016/func/
</span></code></pre></div>
</li>
</ul>
<details class="abstract">
<summary>Example of a session with <em>events</em> files</summary>
<p>The corresponding <em>events</em> files are highlighted below:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>ses-024
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>├──<span class="w"> </span>anat
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>├──<span class="w"> </span>dwi
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_dwi.bval
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_dwi.bvec
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_dwi.json
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_dwi.nii.gz
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_recording-cardiac_physio.json
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_recording-cardiac_physio.tsv.gz
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_recording-respiratory_physio.json
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_recording-respiratory_physio.tsv.gz
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_stim.json
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>│<span class="w">   </span>└──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_stim.tsv.gz
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>├──<span class="w"> </span>fmap
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>├──<span class="w"> </span>func
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-1_part-mag_bold.json
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-1_part-mag_bold.nii.gz
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-1_part-phase_bold.json
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-1_part-phase_bold.nii.gz
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-2_part-mag_bold.json
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-2_part-mag_bold.nii.gz
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-2_part-phase_bold.json
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-2_part-phase_bold.nii.gz
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-3_part-mag_bold.json
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-3_part-mag_bold.nii.gz
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-3_part-phase_bold.json
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-3_part-phase_bold.nii.gz
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-4_part-mag_bold.json
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-4_part-mag_bold.nii.gz
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-4_part-phase_bold.json
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-4_part-phase_bold.nii.gz
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_dwi.bval
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_dwi.bvec
</span><span id="__span-12-34"><a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_dwi.json
</span><span id="__span-12-35"><a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_dwi.nii.gz
</span><span id="__span-12-36"><a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_recording-cardiac_physio.json
</span><span id="__span-12-37"><a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_recording-cardiac_physio.tsv.gz
</span><span id="__span-12-38"><a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_recording-respiratory_physio.json
</span><span id="__span-12-39"><a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_recording-respiratory_physio.tsv.gz
</span><span id="__span-12-40"><a id="__codelineno-12-40" name="__codelineno-12-40" href="#__codelineno-12-40"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_stim.json
</span><span id="__span-12-41"><a id="__codelineno-12-41" name="__codelineno-12-41" href="#__codelineno-12-41"></a>│<span class="w">   </span>└──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_stim.tsv.gz
</span><span id="__span-12-42"><a id="__codelineno-12-42" name="__codelineno-12-42" href="#__codelineno-12-42"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_events.tsv
</span></span><span id="__span-12-43"><a id="__codelineno-12-43" name="__codelineno-12-43" href="#__codelineno-12-43"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-1_part-mag_bold.json
</span></span><span id="__span-12-44"><a id="__codelineno-12-44" name="__codelineno-12-44" href="#__codelineno-12-44"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-1_part-mag_bold.nii.gz
</span><span id="__span-12-45"><a id="__codelineno-12-45" name="__codelineno-12-45" href="#__codelineno-12-45"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-1_part-phase_bold.json
</span><span id="__span-12-46"><a id="__codelineno-12-46" name="__codelineno-12-46" href="#__codelineno-12-46"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-1_part-phase_bold.nii.gz
</span><span id="__span-12-47"><a id="__codelineno-12-47" name="__codelineno-12-47" href="#__codelineno-12-47"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-2_part-mag_bold.json
</span><span id="__span-12-48"><a id="__codelineno-12-48" name="__codelineno-12-48" href="#__codelineno-12-48"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-2_part-mag_bold.nii.gz
</span><span id="__span-12-49"><a id="__codelineno-12-49" name="__codelineno-12-49" href="#__codelineno-12-49"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-2_part-phase_bold.json
</span><span id="__span-12-50"><a id="__codelineno-12-50" name="__codelineno-12-50" href="#__codelineno-12-50"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-2_part-phase_bold.nii.gz
</span><span id="__span-12-51"><a id="__codelineno-12-51" name="__codelineno-12-51" href="#__codelineno-12-51"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-3_part-mag_bold.json
</span><span id="__span-12-52"><a id="__codelineno-12-52" name="__codelineno-12-52" href="#__codelineno-12-52"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-3_part-mag_bold.nii.gz
</span><span id="__span-12-53"><a id="__codelineno-12-53" name="__codelineno-12-53" href="#__codelineno-12-53"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-3_part-phase_bold.json
</span><span id="__span-12-54"><a id="__codelineno-12-54" name="__codelineno-12-54" href="#__codelineno-12-54"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-3_part-phase_bold.nii.gz
</span><span id="__span-12-55"><a id="__codelineno-12-55" name="__codelineno-12-55" href="#__codelineno-12-55"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-4_part-mag_bold.json
</span><span id="__span-12-56"><a id="__codelineno-12-56" name="__codelineno-12-56" href="#__codelineno-12-56"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-4_part-mag_bold.nii.gz
</span><span id="__span-12-57"><a id="__codelineno-12-57" name="__codelineno-12-57" href="#__codelineno-12-57"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-4_part-phase_bold.json
</span><span id="__span-12-58"><a id="__codelineno-12-58" name="__codelineno-12-58" href="#__codelineno-12-58"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-4_part-phase_bold.nii.gz
</span><span id="__span-12-59"><a id="__codelineno-12-59" name="__codelineno-12-59" href="#__codelineno-12-59"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_recording-cardiac_physio.json
</span><span id="__span-12-60"><a id="__codelineno-12-60" name="__codelineno-12-60" href="#__codelineno-12-60"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_recording-cardiac_physio.tsv.gz
</span><span id="__span-12-61"><a id="__codelineno-12-61" name="__codelineno-12-61" href="#__codelineno-12-61"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_recording-respiratory_physio.json
</span><span id="__span-12-62"><a id="__codelineno-12-62" name="__codelineno-12-62" href="#__codelineno-12-62"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_recording-respiratory_physio.tsv.gz
</span><span id="__span-12-63"><a id="__codelineno-12-63" name="__codelineno-12-63" href="#__codelineno-12-63"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_stim.json
</span><span id="__span-12-64"><a id="__codelineno-12-64" name="__codelineno-12-64" href="#__codelineno-12-64"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_stim.tsv.gz
</span><span id="__span-12-65"><a id="__codelineno-12-65" name="__codelineno-12-65" href="#__codelineno-12-65"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_events.tsv
</span><span id="__span-12-66"><a id="__codelineno-12-66" name="__codelineno-12-66" href="#__codelineno-12-66"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-1_part-mag_bold.json
</span></span><span id="__span-12-67"><a id="__codelineno-12-67" name="__codelineno-12-67" href="#__codelineno-12-67"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-1_part-mag_bold.nii.gz
</span></span><span id="__span-12-68"><a id="__codelineno-12-68" name="__codelineno-12-68" href="#__codelineno-12-68"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-1_part-phase_bold.json
</span><span id="__span-12-69"><a id="__codelineno-12-69" name="__codelineno-12-69" href="#__codelineno-12-69"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-1_part-phase_bold.nii.gz
</span><span id="__span-12-70"><a id="__codelineno-12-70" name="__codelineno-12-70" href="#__codelineno-12-70"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-2_part-mag_bold.json
</span><span id="__span-12-71"><a id="__codelineno-12-71" name="__codelineno-12-71" href="#__codelineno-12-71"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-2_part-mag_bold.nii.gz
</span><span id="__span-12-72"><a id="__codelineno-12-72" name="__codelineno-12-72" href="#__codelineno-12-72"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-2_part-phase_bold.json
</span><span id="__span-12-73"><a id="__codelineno-12-73" name="__codelineno-12-73" href="#__codelineno-12-73"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-2_part-phase_bold.nii.gz
</span><span id="__span-12-74"><a id="__codelineno-12-74" name="__codelineno-12-74" href="#__codelineno-12-74"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-3_part-mag_bold.json
</span><span id="__span-12-75"><a id="__codelineno-12-75" name="__codelineno-12-75" href="#__codelineno-12-75"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-3_part-mag_bold.nii.gz
</span><span id="__span-12-76"><a id="__codelineno-12-76" name="__codelineno-12-76" href="#__codelineno-12-76"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-3_part-phase_bold.json
</span><span id="__span-12-77"><a id="__codelineno-12-77" name="__codelineno-12-77" href="#__codelineno-12-77"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-3_part-phase_bold.nii.gz
</span><span id="__span-12-78"><a id="__codelineno-12-78" name="__codelineno-12-78" href="#__codelineno-12-78"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-4_part-mag_bold.json
</span><span id="__span-12-79"><a id="__codelineno-12-79" name="__codelineno-12-79" href="#__codelineno-12-79"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-4_part-mag_bold.nii.gz
</span><span id="__span-12-80"><a id="__codelineno-12-80" name="__codelineno-12-80" href="#__codelineno-12-80"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-4_part-phase_bold.json
</span><span id="__span-12-81"><a id="__codelineno-12-81" name="__codelineno-12-81" href="#__codelineno-12-81"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-4_part-phase_bold.nii.gz
</span><span id="__span-12-82"><a id="__codelineno-12-82" name="__codelineno-12-82" href="#__codelineno-12-82"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_recording-cardiac_physio.json
</span><span id="__span-12-83"><a id="__codelineno-12-83" name="__codelineno-12-83" href="#__codelineno-12-83"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_recording-cardiac_physio.tsv.gz
</span><span id="__span-12-84"><a id="__codelineno-12-84" name="__codelineno-12-84" href="#__codelineno-12-84"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_recording-respiratory_physio.json
</span><span id="__span-12-85"><a id="__codelineno-12-85" name="__codelineno-12-85" href="#__codelineno-12-85"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_recording-respiratory_physio.tsv.gz
</span><span id="__span-12-86"><a id="__codelineno-12-86" name="__codelineno-12-86" href="#__codelineno-12-86"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_stim.json
</span><span id="__span-12-87"><a id="__codelineno-12-87" name="__codelineno-12-87" href="#__codelineno-12-87"></a>│<span class="w">   </span>└──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_stim.tsv.gz
</span><span id="__span-12-88"><a id="__codelineno-12-88" name="__codelineno-12-88" href="#__codelineno-12-88"></a>│<span class="w">   </span>└──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_events.tsv
</span><span id="__span-12-89"><a id="__codelineno-12-89" name="__codelineno-12-89" href="#__codelineno-12-89"></a>└──<span class="w"> </span>sub-001_ses-024_scans.tsv
</span></code></pre></div>
</details>
<h3 id="convert-physiological-recordings-into-bids-in-house">Convert physiological recordings into <abbr title="Brain Imaging Data Structure">BIDS</abbr> (in-house)<a class="headerlink" href="#convert-physiological-recordings-into-bids-in-house" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Install the necessary packages.
    <div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>python -m pip install bioread pandas matplotlib numpy pathlib scipy
</span></code></pre></div></p>
</li>
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Update the appropriate session number within cell 3 in <a href="../physio-to-bids/">the conversion <em>Jupyter</em> notebook</a>.</p>
</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Execute the notebook.</li>
</ul>
<details class="abstract">
<summary>Example of a session with physiological recordings</summary>
<p>The execution of the notebook on session 24 yields the following new outputs (highlighted):</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>ses-024
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>├──<span class="w"> </span>anat
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>├──<span class="w"> </span>dwi
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_dwi.bval
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_dwi.bvec
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_dwi.json
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_dwi.nii.gz
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_recording-cardiac_physio.json
</span></span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_recording-cardiac_physio.tsv.gz
</span></span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_recording-respiratory_physio.json
</span></span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_recording-respiratory_physio.tsv.gz
</span></span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_stim.json
</span></span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="hll">│<span class="w">   </span>└──<span class="w"> </span>sub-001_ses-024_acq-highres_dir-AP_stim.tsv.gz
</span></span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>├──<span class="w"> </span>fmap
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>├──<span class="w"> </span>func
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-1_part-mag_bold.json
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-1_part-mag_bold.nii.gz
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-1_part-phase_bold.json
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-1_part-phase_bold.nii.gz
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-2_part-mag_bold.json
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-2_part-mag_bold.nii.gz
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-2_part-phase_bold.json
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-2_part-phase_bold.nii.gz
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-3_part-mag_bold.json
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-3_part-mag_bold.nii.gz
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-3_part-phase_bold.json
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-3_part-phase_bold.nii.gz
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-4_part-mag_bold.json
</span><span id="__span-14-29"><a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-4_part-mag_bold.nii.gz
</span><span id="__span-14-30"><a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-4_part-phase_bold.json
</span><span id="__span-14-31"><a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-4_part-phase_bold.nii.gz
</span><span id="__span-14-32"><a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_recording-cardiac_physio.json
</span></span><span id="__span-14-33"><a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_recording-cardiac_physio.tsv.gz
</span></span><span id="__span-14-34"><a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_recording-respiratory_physio.json
</span></span><span id="__span-14-35"><a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_recording-respiratory_physio.tsv.gz
</span></span><span id="__span-14-36"><a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_stim.json
</span></span><span id="__span-14-37"><a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_stim.tsv.gz
</span></span><span id="__span-14-38"><a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-1_part-mag_bold.json
</span><span id="__span-14-39"><a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-1_part-mag_bold.nii.gz
</span><span id="__span-14-40"><a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-1_part-phase_bold.json
</span><span id="__span-14-41"><a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-1_part-phase_bold.nii.gz
</span><span id="__span-14-42"><a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-2_part-mag_bold.json
</span><span id="__span-14-43"><a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-2_part-mag_bold.nii.gz
</span><span id="__span-14-44"><a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-2_part-phase_bold.json
</span><span id="__span-14-45"><a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-2_part-phase_bold.nii.gz
</span><span id="__span-14-46"><a id="__codelineno-14-46" name="__codelineno-14-46" href="#__codelineno-14-46"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-3_part-mag_bold.json
</span><span id="__span-14-47"><a id="__codelineno-14-47" name="__codelineno-14-47" href="#__codelineno-14-47"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-3_part-mag_bold.nii.gz
</span><span id="__span-14-48"><a id="__codelineno-14-48" name="__codelineno-14-48" href="#__codelineno-14-48"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-3_part-phase_bold.json
</span><span id="__span-14-49"><a id="__codelineno-14-49" name="__codelineno-14-49" href="#__codelineno-14-49"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-3_part-phase_bold.nii.gz
</span><span id="__span-14-50"><a id="__codelineno-14-50" name="__codelineno-14-50" href="#__codelineno-14-50"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-4_part-mag_bold.json
</span><span id="__span-14-51"><a id="__codelineno-14-51" name="__codelineno-14-51" href="#__codelineno-14-51"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-4_part-mag_bold.nii.gz
</span><span id="__span-14-52"><a id="__codelineno-14-52" name="__codelineno-14-52" href="#__codelineno-14-52"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-4_part-phase_bold.json
</span><span id="__span-14-53"><a id="__codelineno-14-53" name="__codelineno-14-53" href="#__codelineno-14-53"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-4_part-phase_bold.nii.gz
</span><span id="__span-14-54"><a id="__codelineno-14-54" name="__codelineno-14-54" href="#__codelineno-14-54"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_recording-cardiac_physio.json
</span></span><span id="__span-14-55"><a id="__codelineno-14-55" name="__codelineno-14-55" href="#__codelineno-14-55"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_recording-cardiac_physio.tsv.gz
</span></span><span id="__span-14-56"><a id="__codelineno-14-56" name="__codelineno-14-56" href="#__codelineno-14-56"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_recording-respiratory_physio.json
</span></span><span id="__span-14-57"><a id="__codelineno-14-57" name="__codelineno-14-57" href="#__codelineno-14-57"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_recording-respiratory_physio.tsv.gz
</span></span><span id="__span-14-58"><a id="__codelineno-14-58" name="__codelineno-14-58" href="#__codelineno-14-58"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_stim.json
</span></span><span id="__span-14-59"><a id="__codelineno-14-59" name="__codelineno-14-59" href="#__codelineno-14-59"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_stim.tsv.gz
</span></span><span id="__span-14-60"><a id="__codelineno-14-60" name="__codelineno-14-60" href="#__codelineno-14-60"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-1_part-mag_bold.json
</span><span id="__span-14-61"><a id="__codelineno-14-61" name="__codelineno-14-61" href="#__codelineno-14-61"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-1_part-mag_bold.nii.gz
</span><span id="__span-14-62"><a id="__codelineno-14-62" name="__codelineno-14-62" href="#__codelineno-14-62"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-1_part-phase_bold.json
</span><span id="__span-14-63"><a id="__codelineno-14-63" name="__codelineno-14-63" href="#__codelineno-14-63"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-1_part-phase_bold.nii.gz
</span><span id="__span-14-64"><a id="__codelineno-14-64" name="__codelineno-14-64" href="#__codelineno-14-64"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-2_part-mag_bold.json
</span><span id="__span-14-65"><a id="__codelineno-14-65" name="__codelineno-14-65" href="#__codelineno-14-65"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-2_part-mag_bold.nii.gz
</span><span id="__span-14-66"><a id="__codelineno-14-66" name="__codelineno-14-66" href="#__codelineno-14-66"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-2_part-phase_bold.json
</span><span id="__span-14-67"><a id="__codelineno-14-67" name="__codelineno-14-67" href="#__codelineno-14-67"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-2_part-phase_bold.nii.gz
</span><span id="__span-14-68"><a id="__codelineno-14-68" name="__codelineno-14-68" href="#__codelineno-14-68"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-3_part-mag_bold.json
</span><span id="__span-14-69"><a id="__codelineno-14-69" name="__codelineno-14-69" href="#__codelineno-14-69"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-3_part-mag_bold.nii.gz
</span><span id="__span-14-70"><a id="__codelineno-14-70" name="__codelineno-14-70" href="#__codelineno-14-70"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-3_part-phase_bold.json
</span><span id="__span-14-71"><a id="__codelineno-14-71" name="__codelineno-14-71" href="#__codelineno-14-71"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-3_part-phase_bold.nii.gz
</span><span id="__span-14-72"><a id="__codelineno-14-72" name="__codelineno-14-72" href="#__codelineno-14-72"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-4_part-mag_bold.json
</span><span id="__span-14-73"><a id="__codelineno-14-73" name="__codelineno-14-73" href="#__codelineno-14-73"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-4_part-mag_bold.nii.gz
</span><span id="__span-14-74"><a id="__codelineno-14-74" name="__codelineno-14-74" href="#__codelineno-14-74"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-4_part-phase_bold.json
</span><span id="__span-14-75"><a id="__codelineno-14-75" name="__codelineno-14-75" href="#__codelineno-14-75"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-4_part-phase_bold.nii.gz
</span><span id="__span-14-76"><a id="__codelineno-14-76" name="__codelineno-14-76" href="#__codelineno-14-76"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_recording-cardiac_physio.json
</span></span><span id="__span-14-77"><a id="__codelineno-14-77" name="__codelineno-14-77" href="#__codelineno-14-77"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_recording-cardiac_physio.tsv.gz
</span></span><span id="__span-14-78"><a id="__codelineno-14-78" name="__codelineno-14-78" href="#__codelineno-14-78"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_recording-respiratory_physio.json
</span></span><span id="__span-14-79"><a id="__codelineno-14-79" name="__codelineno-14-79" href="#__codelineno-14-79"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_recording-respiratory_physio.tsv.gz
</span></span><span id="__span-14-80"><a id="__codelineno-14-80" name="__codelineno-14-80" href="#__codelineno-14-80"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_stim.json
</span></span><span id="__span-14-81"><a id="__codelineno-14-81" name="__codelineno-14-81" href="#__codelineno-14-81"></a><span class="hll">│<span class="w">   </span>└──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_stim.tsv.gz
</span></span><span id="__span-14-82"><a id="__codelineno-14-82" name="__codelineno-14-82" href="#__codelineno-14-82"></a>└──<span class="w"> </span>sub-001_ses-024_scans.tsv
</span></code></pre></div>
</details>
<h3 id="convert-eye-tracking-into-bids-in-house">Convert eye-tracking into <abbr title="Brain Imaging Data Structure">BIDS</abbr> (in-house)<a class="headerlink" href="#convert-eye-tracking-into-bids-in-house" title="Permanent link">&para;</a></h3>
<div class="admonition warning">
<p class="admonition-title">Instead of the current specifications, we are using <a href="https://bids-specification--1128.org.readthedocs.build/en/1128/modality-specific-files/eye-tracking.html">the following <abbr title="BIDS Extension Proposal">BEP</abbr></a></p>
</div>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Check that <em>PyEDFRead</em> is installed as described in <a href="../../data-collection/notes-software/#conversion-of-et-recordings-into-bids">the software annex</a>.</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Employ our <em>in-house</em> conversion code, whose functioning is described in <a href="../edf-to-bids/">our <abbr title="EyeLink Data Format">EDF</abbr> to <abbr title="Brain Imaging Data Structure">BIDS</abbr> conversion how-to</a>.</li>
</ul>
<details class="abstract">
<summary>Example of a session with eye-tracking recordings</summary>
<p>The files corresponding to eye-tracking are highlighted below:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>ses-024
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>├──<span class="w"> </span>anat
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>├──<span class="w"> </span>dwi
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>├──<span class="w"> </span>fmap
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>├──<span class="w"> </span>func
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-1_part-mag_bold.json
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-1_part-mag_bold.nii.gz
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-1_part-phase_bold.json
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-1_part-phase_bold.nii.gz
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-2_part-mag_bold.json
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-2_part-mag_bold.nii.gz
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-2_part-phase_bold.json
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-2_part-phase_bold.nii.gz
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-3_part-mag_bold.json
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-3_part-mag_bold.nii.gz
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-3_part-phase_bold.json
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-3_part-phase_bold.nii.gz
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-4_part-mag_bold.json
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-4_part-mag_bold.nii.gz
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-4_part-phase_bold.json
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_echo-4_part-phase_bold.nii.gz
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_eyetrack.json
</span></span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-bht_dir-AP_eyetrack.tsv.gz
</span></span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-1_part-mag_bold.json
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-1_part-mag_bold.nii.gz
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-1_part-phase_bold.json
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-1_part-phase_bold.nii.gz
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-2_part-mag_bold.json
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-2_part-mag_bold.nii.gz
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-2_part-phase_bold.json
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-2_part-phase_bold.nii.gz
</span><span id="__span-15-32"><a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-3_part-mag_bold.json
</span><span id="__span-15-33"><a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-3_part-mag_bold.nii.gz
</span><span id="__span-15-34"><a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-3_part-phase_bold.json
</span><span id="__span-15-35"><a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-3_part-phase_bold.nii.gz
</span><span id="__span-15-36"><a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-4_part-mag_bold.json
</span><span id="__span-15-37"><a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-4_part-mag_bold.nii.gz
</span><span id="__span-15-38"><a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-4_part-phase_bold.json
</span><span id="__span-15-39"><a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_echo-4_part-phase_bold.nii.gz
</span><span id="__span-15-40"><a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_eyetrack.json
</span></span><span id="__span-15-41"><a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-qct_dir-AP_eyetrack.tsv.gz
</span></span><span id="__span-15-42"><a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-1_part-mag_bold.json
</span><span id="__span-15-43"><a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-1_part-mag_bold.nii.gz
</span><span id="__span-15-44"><a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-1_part-phase_bold.json
</span><span id="__span-15-45"><a id="__codelineno-15-45" name="__codelineno-15-45" href="#__codelineno-15-45"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-1_part-phase_bold.nii.gz
</span><span id="__span-15-46"><a id="__codelineno-15-46" name="__codelineno-15-46" href="#__codelineno-15-46"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-2_part-mag_bold.json
</span><span id="__span-15-47"><a id="__codelineno-15-47" name="__codelineno-15-47" href="#__codelineno-15-47"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-2_part-mag_bold.nii.gz
</span><span id="__span-15-48"><a id="__codelineno-15-48" name="__codelineno-15-48" href="#__codelineno-15-48"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-2_part-phase_bold.json
</span><span id="__span-15-49"><a id="__codelineno-15-49" name="__codelineno-15-49" href="#__codelineno-15-49"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-2_part-phase_bold.nii.gz
</span><span id="__span-15-50"><a id="__codelineno-15-50" name="__codelineno-15-50" href="#__codelineno-15-50"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-3_part-mag_bold.json
</span><span id="__span-15-51"><a id="__codelineno-15-51" name="__codelineno-15-51" href="#__codelineno-15-51"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-3_part-mag_bold.nii.gz
</span><span id="__span-15-52"><a id="__codelineno-15-52" name="__codelineno-15-52" href="#__codelineno-15-52"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-3_part-phase_bold.json
</span><span id="__span-15-53"><a id="__codelineno-15-53" name="__codelineno-15-53" href="#__codelineno-15-53"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-3_part-phase_bold.nii.gz
</span><span id="__span-15-54"><a id="__codelineno-15-54" name="__codelineno-15-54" href="#__codelineno-15-54"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-4_part-mag_bold.json
</span><span id="__span-15-55"><a id="__codelineno-15-55" name="__codelineno-15-55" href="#__codelineno-15-55"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-4_part-mag_bold.nii.gz
</span><span id="__span-15-56"><a id="__codelineno-15-56" name="__codelineno-15-56" href="#__codelineno-15-56"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-4_part-phase_bold.json
</span><span id="__span-15-57"><a id="__codelineno-15-57" name="__codelineno-15-57" href="#__codelineno-15-57"></a>│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_echo-4_part-phase_bold.nii.gz
</span><span id="__span-15-58"><a id="__codelineno-15-58" name="__codelineno-15-58" href="#__codelineno-15-58"></a><span class="hll">│<span class="w">   </span>├──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_eyetrack.json
</span></span><span id="__span-15-59"><a id="__codelineno-15-59" name="__codelineno-15-59" href="#__codelineno-15-59"></a><span class="hll">│<span class="w">   </span>└──<span class="w"> </span>sub-001_ses-024_task-rest_dir-AP_eyetrack.tsv.gz
</span></span><span id="__span-15-60"><a id="__codelineno-15-60" name="__codelineno-15-60" href="#__codelineno-15-60"></a>└──<span class="w"> </span>sub-001_ses-024_scans.tsv
</span></code></pre></div>
</details>
<h3 id="add-new-data-to-the-datalad-dataset">Add new data to the <em>DataLad</em> dataset<a class="headerlink" href="#add-new-data-to-the-datalad-dataset" title="Permanent link">&para;</a></h3>
<p>As new sessions are collected, the corresponding <abbr title="Brain Imaging Data Structure">BIDS</abbr> structures MUST be saved within the <em>DataLad</em> dataset and pushed to remote storage systems:</p>
<ul class="task-list">
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Save the files in the dataset history using the command below.
    Replace <code>&lt;session_id&gt;</code> below with the number of the session (e.g., <code>pilot017</code>):</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>datalad<span class="w"> </span>save<span class="w"> </span>-r<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;add: session &lt;session_id&gt;&quot;</span><span class="w"> </span>sub-001/ses-&lt;session_id&gt;
</span></code></pre></div>
<div class="admonition danger">
<p class="admonition-title">Always double-check that data are annexed and the metadata committed to git</p>
<p>Although the <a href="../preliminary/#creating-a-datalad-dataset">creation of a procedure</a> should ensure data and metadata are added to the appropriate version control (Git or Git-Annex), it is possible that some metadata or data formats are not anticipated, or do not follow the general rules.</p>
<p>A generally good strategy is to avoid recursion (i.e., do not use the <code>-r</code> flag), and leverage Bash's <code>find</code> and <code>xargs</code> tools.
For example, the following command line selects metadata files that should be committed to Git within one session (<code>pilot020</code>) and saves them:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>find<span class="w"> </span>sub-001/ses-pilot020<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.tsv&quot;</span><span class="w"> </span>-or<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.json&quot;</span><span class="w"> </span>-or<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.bvec&quot;</span><span class="w"> </span>-or<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.bval&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>datalad<span class="w"> </span>save<span class="w"> </span>--to-git<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;&quot;add(pilot020): new session metadata&quot;&#39;</span>
</span></code></pre></div>
<p>Correspondingly, we can store <abbr title="Neuroimaging Informatics Technology Initiative">NIfTI</abbr> data and physiological information:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>find<span class="w"> </span>sub-001/ses-pilot020<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.nii.gz&quot;</span><span class="w"> </span>-or<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*_eyetrack.tsv.gz&quot;</span><span class="w"> </span>-or<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*_physio.tsv.gz&quot;</span><span class="w"> </span>-or<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*_stim.tsv.gz&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>datalad<span class="w"> </span>save<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;&quot;add(pilot020): new session NIfTI data, eye tracking and physio&quot;&#39;</span>
</span></code></pre></div>
<p>Please read <a href="http://docs.datalad.org/en/stable/generated/man/datalad-save.html"><em>DataLad</em>'s <code>save</code> documentation</a></p>
</div>
<div class="admonition important">
<p class="admonition-title">If you overeagerly <em>datalad-saved</em> too many files</p>
<p>You can <a href="https://handbook.datalad.org/en/latest/basics/101-137-history.html"><em>revert</em> the <code>datalad save</code> operation</a> without deleting changes with:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>git<span class="w"> </span>reset<span class="w"> </span>--mixed<span class="w"> </span>COMMIT
</span></code></pre></div>
<p>where <code>COMMIT</code> is the hash of the last commit you want to keep (all the later commits will be dropped).</p>
<p>To check the commit hash where you can roll history back to, you may want to use:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>git<span class="w"> </span>log<span class="w"> </span>-50<span class="w"> </span>--oneline
</span></code></pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Saving batches of sessions</p>
<p>It is possible to save several sessions with the following <em>Bash</em> script by enumerating them in the array defined in the first line here:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nv">SESSIONS</span><span class="o">=(</span><span class="w"> </span><span class="m">001</span><span class="w"> </span><span class="m">003</span><span class="w"> </span>pilot21<span class="w"> </span><span class="o">)</span><span class="p">;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="k">for</span><span class="w"> </span>SESSION<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="si">${</span><span class="nv">SESSIONS</span><span class="p">[@]</span><span class="si">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">    </span>find<span class="w"> </span>sub-001/ses-<span class="nv">$SESSION</span><span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.tsv&quot;</span><span class="w"> </span>-or<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.json&quot;</span><span class="w"> </span>-or<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.bvec&quot;</span><span class="w"> </span>-or<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.bval&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>datalad<span class="w"> </span>save<span class="w"> </span>--to-git<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;&quot;add(&#39;</span><span class="s2">&quot;</span><span class="nv">$SESSION</span><span class="s2">&quot;</span><span class="s1">&#39;): new session metadata&quot;&#39;</span><span class="p">;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">    </span>find<span class="w"> </span>sub-001/ses-<span class="nv">$SESSION</span><span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.nii.gz&quot;</span><span class="w"> </span>-or<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*_eyetrack.tsv.gz&quot;</span><span class="w"> </span>-or<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*_physio.tsv.gz&quot;</span><span class="w"> </span>-or<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*_stim.tsv.gz&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>datalad<span class="w"> </span>save<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;&quot;add(&#39;</span><span class="s2">&quot;</span><span class="nv">$SESSION</span><span class="s2">&quot;</span><span class="s1">&#39;): new session NIfTI data, eye tracking and physio&quot;&#39;</span><span class="p">;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="k">done</span>
</span></code></pre></div>
</div>
</li>
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Push the new data to the remote storage (if your git containing <em>DataLad</em> and the Git annex is different from <code>origin</code>, e.g., <code>github</code>, replace the name below):</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>datalad<span class="w"> </span>push<span class="w"> </span>--to<span class="w"> </span>ria-storage
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>datalad<span class="w"> </span>push<span class="w"> </span>--to<span class="w"> </span>origin
</span></code></pre></div>
<div class="admonition danger">
<p class="admonition-title">Always double-check that data in the annex are uploaded to the <abbr title="Remote Indexed Archives">RIA</abbr> store</p>
</div>
</li>
</ul>
<h3 id="formal-qc">Formal <abbr title="quality control">QC</abbr><a class="headerlink" href="#formal-qc" title="Permanent link">&para;</a></h3>
<ul class="task-list">
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Consult the <a href="../../data-collection/tear-up/#start-a-new-session-log-form">session logs</a> to anticipate session peculiarities (e.g the session was aborted prematurely) and potential quality issues (e.g the participan fell asleep).
    Those are saved in <a href="https://github.com/TheAxonLab/hcph-sops/issues">the issues of our repository</a> with the label <span class="consolebutton brown">scan</span>.
    Keep note of the peculiar events, associated with their session index, and keep it close to you during quality control.</p>
</li>
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Run the <em><abbr title="Brain Imaging Data Structure">BIDS</abbr> Validator</em> to check the <em>formal</em> quality of the dataset (filenames, homogeneity of modalities and parameters across sessions, etc.)</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-ti<span class="w"> </span>--rm<span class="w"> </span>-v<span class="w"> </span>/path/to/data//hcph/:/data:ro<span class="w"> </span>bids/validator<span class="w"> </span>/data
</span></code></pre></div>
</li>
</ul>
<details class="bug">
<summary><abbr title="Brain Imaging Data Structure">BIDS</abbr> non-compliance: WARNINGS and ERRORS</summary>
<p>We do not fully comply with current <abbr title="Brain Imaging Data Structure">BIDS</abbr> specifications, so some ERRORS and WARNINGS will emerge.
If errors and warnings are not listed here, please reach out to decide on a solution.</p>
<ol>
<li>
<p><strong>ERRORS</strong>: Because we follow <a href="https://bids-specification--1128.org.readthedocs.build/en/1128/modality-specific-files/eye-tracking.html"><abbr title="BIDS Extension Proposal">BEP</abbr> 020</a> and it is not official yet, <abbr title="eye tracker">ET</abbr>-related files will source ERRORS:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>[ERR] Files with such naming scheme are not part of BIDS specification.
</span></code></pre></div>
</li>
<li>
<p><strong>WARNINGS</strong>: some warnings are expected.
    Warnings that are not among this list should be addressed and <abbr title="Brain Imaging Data Structure">BIDS</abbr> conversion should be re-run on the affected files:</p>
<ul>
<li>
<p>During the piloting phase of the study, we tried out different sequence parameters and sequence type. As such, the following warning is expected:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>[WARN] Not all subjects/sessions/runs have the same scanning parameters. (code: 39 - INCONSISTENT_PARAMETERS)
</span></code></pre></div>
</li>
<li>
<p>The <code>_magnitude{1,2}.nii.gz</code> files corresponding to some pilot sessions are missing:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>[WARN] Each _phasediff.nii[.gz] file should be associated with a _magnitude1.nii[.gz] file. (code: 92 MISSING_MAGNITUDE1_FILE)
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>./sub-001/ses-pilot001/fmap/sub-001_ses-pilot001_phasediff.nii.gz
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>./sub-001/ses-pilot004/fmap/sub-001_ses-pilot004_phasediff.nii.gz
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>./sub-001/ses-pilot006/fmap/sub-001_ses-pilot006_phasediff.nii.gz
</span></code></pre></div>
</li>
</ul>
</li>
</ol>
</details>
<h3 id="visual-assessment-of-unprocessed-data-with-mriqc">Visual assessment of unprocessed data with <em>MRIQC</em><a class="headerlink" href="#visual-assessment-of-unprocessed-data-with-mriqc" title="Permanent link">&para;</a></h3>
<p>Checking the data quality shortly after they are acquired increases the likelihood of catching systematic artifacts early enough to avert spreading throughout the whole dataset.
It also modulates the burden of visual inspection over time, such that we avoid overwhelming raters with outbursts of images to assess.
Better pacing in rating throughput also contributes to reducing raters' attrition and fatigue.</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Screen all the unprocessed data and assess them as described in the <a href="../mriqc/">next section</a>.</li>
</ul>
<h2 id="upon-updates-and-bugfixes-of-the-dataset">Upon updates and bugfixes of the dataset<a class="headerlink" href="#upon-updates-and-bugfixes-of-the-dataset" title="Permanent link">&para;</a></h2>
<h3 id="update-pybidss-database-index">Update <em>PyBIDS</em>'s database index<a class="headerlink" href="#update-pybidss-database-index" title="Permanent link">&para;</a></h3>
<details class="tip">
<summary>The <em>PyBIDS</em> index cache dramatically speeds up <em>MRIQC</em>, <em>fMRIPrep</em> and <em>dMRIPrep</em></summary>
<p>To speed up the tear-up time of <em>NiPreps</em> tools (<em>MRIQC</em>, <em>fMRIPrep</em>, and <em>dMRIPrep</em>) and other relevant code using <em>PyBIDS</em>, we have added a database cache under the <code>/data/datasets/hcph-dataset/.bids-index/</code> folder.
This cache can be leverage by adding the <code>--bids-database-dir /data/datasets/hcph-dataset/.bids-index/</code> to the corresponding command line.</p>
</details>
<ul class="task-list">
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Unlock the database file to enable update:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="nb">cd</span><span class="w"> </span>/data/datasets/hcph-dataset
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>datalad<span class="w"> </span>unlock<span class="w"> </span>.bids-index/layout_index.sqlite
</span></code></pre></div>
</li>
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Reset the database file:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span><span class="s2">&quot;pybids&gt;=0.16&quot;</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="k">$(</span><span class="w"> </span>dirname<span class="w"> </span><span class="k">$(</span><span class="w"> </span>which<span class="w"> </span>python<span class="w"> </span><span class="k">)</span><span class="w"> </span><span class="k">)</span>/pybids<span class="w"> </span>layout<span class="w"> </span>--reset-db<span class="w"> </span>--no-validate<span class="w"> </span>--index-metadata<span class="w"> </span>.<span class="w"> </span>.bids-index/
</span></code></pre></div>
<p>Successful execution will finalize with a message: <code>Successfully generated database index at /data/datasets/hcph-dataset/.bids-index</code>.</p>
</li>
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Save the dataset again:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>datalad<span class="w"> </span>save<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;enh: updated PyBIDS&#39; database file&quot;</span><span class="w"> </span>/data/datasets/hcph-dataset/.bids-index
</span></code></pre></div>
</li>
<li class="task-list-item">
<p><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Push the changes back to the repos:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>datalad<span class="w"> </span>push<span class="w"> </span>--to<span class="o">=</span>github
</span></code></pre></div>
</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2023
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.expand", "navigation.top", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.07f07601.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.56dfad97.min.js"></script>
      
        <script src="../../js/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>